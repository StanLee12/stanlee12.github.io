<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>使用Docker Compose部署Java应用</title>
    <link href="/2026/01/15/docker-deploy-jar/"/>
    <url>/2026/01/15/docker-deploy-jar/</url>
    
    <content type="html"><![CDATA[<h2 id="MySql"><a href="#MySql" class="headerlink" title="MySql"></a>MySql</h2><p>项目依赖于mysql数据库，因此需要先部署mysql容器。</p><h3 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h3><p>新建目录以及<code>yml</code>文件:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p mysql/&#123;conf,data,logs,init&#125;<br>touch mysql/docker-compose.yml<br></code></pre></td></tr></table></figure><p>给予目录操作权限:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod -R 777 mysql<br></code></pre></td></tr></table></figure><h3 id="编写docker-compose-yml文件"><a href="#编写docker-compose-yml文件" class="headerlink" title="编写docker-compose.yml文件"></a>编写docker-compose.yml文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.8&#x27;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">mysql:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">mysql8</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">mysql8</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;3306:3306&quot;</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> &#123;<span class="hljs-string">your_password</span>&#125;<br>      <span class="hljs-attr">MYSQL_ROOT_HOST:</span> <span class="hljs-string">&quot;%&quot;</span><br>      <span class="hljs-attr">MYSQL_INITDB_CHARSET:</span> <span class="hljs-string">utf8mb4</span><br>      <span class="hljs-attr">MYSQL_INITDB_COLLATION:</span> <span class="hljs-string">utf8mb4_unicode_ci</span><br>      <span class="hljs-attr">TZ:</span> <span class="hljs-string">Asia/Shanghai</span><br>      <span class="hljs-attr">MYSQL_INITDB_SKIP_TZINFO:</span> <span class="hljs-number">1</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data:/var/lib/mysql</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./conf:/etc/mysql/conf.d</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./logs:/var/log/mysql</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./init:/docker-entrypoint-initdb.d</span><br>    <span class="hljs-attr">command:</span><br>      <span class="hljs-string">--character-set-server=utf8mb4</span><br>      <span class="hljs-string">--collation-server=utf8mb4_unicode_ci</span><br>      <span class="hljs-string">--lower_case_table_names=1</span><br>      <span class="hljs-string">--max_allowed_packet=128M</span><br>      <span class="hljs-string">--default-time_zone=&#x27;+8:00&#x27;</span><br>      <span class="hljs-string">--sql_mode=STRICT_TRANS_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">resources:</span><br>        <span class="hljs-attr">limits:</span><br>          <span class="hljs-attr">cpus:</span> <span class="hljs-string">&#x27;1&#x27;</span><br>          <span class="hljs-attr">memory:</span> <span class="hljs-string">2G</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql-network</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">mysql-network:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span><br></code></pre></td></tr></table></figure><ul><li>其中<code>init</code>文件下存放需要mysql启动时执行的<code>sql</code>文件，也就是导入数据库</li></ul><h3 id="启动mysql容器"><a href="#启动mysql容器" class="headerlink" title="启动mysql容器"></a>启动mysql容器</h3><p>在<code>docker-compose.yml</code>文件所在目录执行以下命令:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose up -d<br></code></pre></td></tr></table></figure><h3 id="测试mysql连接"><a href="#测试mysql连接" class="headerlink" title="测试mysql连接"></a>测试mysql连接</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose exec mysql -uroot -p&#123;your_password&#125;<br></code></pre></td></tr></table></figure><p>如果连接成功，会显示以下信息:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell">Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection id is 8<br>Server version: 8.0.33 MySQL Community Server - GPL<br><br>Copyright (c) 2000, 2023, Oracle and/or its affiliates.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type &#x27;help;&#x27; or &#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">mysql&gt;</span><br></code></pre></td></tr></table></figure><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><p>项目依赖于redis数据库，因此需要先部署redis容器。</p><h3 id="创建目录-1"><a href="#创建目录-1" class="headerlink" title="创建目录"></a>创建目录</h3><p>新建目录以及<code>yml</code>文件:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p redis/&#123;conf,data,logs&#125;<br>touch redis/docker-compose.yml<br></code></pre></td></tr></table></figure><p>给予目录操作权限:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod -R 777 redis<br></code></pre></td></tr></table></figure><h3 id="编写docker-compose-yml文件-1"><a href="#编写docker-compose-yml文件-1" class="headerlink" title="编写docker-compose.yml文件"></a>编写docker-compose.yml文件</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.8&#x27;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:7-alpine</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">redis-server</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;6379:6379&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data:/data</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./logs:/var/log/redis</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./conf/redis.conf:/usr/local/etc/redis/redis.conf</span><br>    <span class="hljs-attr">command:</span> <span class="hljs-string">redis-server</span> <span class="hljs-string">/usr/local/etc/redis/redis.conf</span><br>    <span class="hljs-attr">healthcheck:</span><br>      <span class="hljs-attr">test:</span> [<span class="hljs-string">&quot;CMD&quot;</span>, <span class="hljs-string">&quot;redis-cli&quot;</span>, <span class="hljs-string">&quot;ping&quot;</span>]<br>      <span class="hljs-attr">interval:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attr">timeout:</span> <span class="hljs-string">5s</span><br>      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">redis-network</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">redis-network:</span><br>    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span><br></code></pre></td></tr></table></figure><h3 id="Redis配置文件"><a href="#Redis配置文件" class="headerlink" title="Redis配置文件"></a>Redis配置文件</h3><p>redis启动还需要一个<code>redis.conf</code>文件, 在<code>conf</code>目录下新建文件:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">touch redis/redis.conf<br></code></pre></td></tr></table></figure><p>编写redis.conf文件:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs conf">bind 0.0.0.0<br># 端口<br>port 6379<br># 密码认证<br>requirepass &#123;your_password&#125;<br># 持久化<br>save 900 1<br>save 300 10<br>save 60 10000<br><br># 数据目录<br>dir /data<br><br># 最大内存<br>maxmemory 256mb<br>maxmemory-policy allkeys-lru<br><br># 启用AOF持久化<br>appendonly yes<br>appendfilename &quot;appendonly.aof&quot;<br></code></pre></td></tr></table></figure><h3 id="启动redis容器"><a href="#启动redis容器" class="headerlink" title="启动redis容器"></a>启动redis容器</h3><p>在<code>docker-compose.yml</code>文件所在目录执行以下命令:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose up -d<br></code></pre></td></tr></table></figure><h3 id="测试redis连接"><a href="#测试redis连接" class="headerlink" title="测试redis连接"></a>测试redis连接</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose exec redis redis-cli -a &#123;your_password&#125;<br></code></pre></td></tr></table></figure><p>如果连接成功，会显示以下信息:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">127.0.0.1:6379&gt; ping<br>PONG<br></code></pre></td></tr></table></figure><h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><p>打包前我们需要新增一个<code>application-docker.yml</code>文件，用于配置docker环境下的数据库连接信息。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 服务配置</span><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">18084</span><br><br><span class="hljs-comment"># 框架配置</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mvc:</span><br>    <span class="hljs-attr">static-path-pattern:</span> <span class="hljs-string">/api/static/**</span><br>    <span class="hljs-attr">throw-exception-if-no-handler-found:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">pathmatch:</span><br>      <span class="hljs-attr">matching-strategy:</span> <span class="hljs-string">ant_path_matcher</span><br>  <span class="hljs-comment"># 数据源配置</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://mysql8:3306/like_admin?useUnicode=true&amp;characterEncoding=UTF-8&amp;autoReconnect=true&amp;useSSL=false</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.zaxxer.hikari.HikariDataSource</span> <span class="hljs-comment"># 数据源类型</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span> <span class="hljs-comment"># MySql的驱动</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span> <span class="hljs-comment"># 数据库账号</span><br>    <span class="hljs-attr">password:</span> &#123;<span class="hljs-string">your_password</span>&#125; <span class="hljs-comment"># 数据库密码</span><br>    <span class="hljs-attr">hikari:</span><br>      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">30000</span>     <span class="hljs-comment"># 等待连接分配连接的最大时长(毫秒),超出时长还没可用连接则发送SQLException,默认30秒</span><br>      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">5</span>               <span class="hljs-comment"># 最小连接数</span><br>      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">20</span>         <span class="hljs-comment"># 最大连接数</span><br>      <span class="hljs-attr">auto-commit:</span> <span class="hljs-literal">true</span>             <span class="hljs-comment"># 自动提交</span><br>      <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">600000</span>          <span class="hljs-comment"># 连接超时的最大时长(毫秒),超时则被释放(retired),默认10分钟</span><br>      <span class="hljs-attr">pool-name:</span> <span class="hljs-string">DateSourceHikariCP</span> <span class="hljs-comment"># 连接池名称</span><br>      <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">1800000</span>         <span class="hljs-comment"># 连接的生命时长(毫秒),超时而且没被使用则被释放,默认30分钟(1800000ms)</span><br>      <span class="hljs-attr">connection-init-sql:</span> <span class="hljs-string">SELECT</span> <span class="hljs-number">1</span> <span class="hljs-comment"># 连接时发起SQL测试脚本</span><br>  <span class="hljs-comment"># 限制配置</span><br>  <span class="hljs-attr">servlet:</span><br>    <span class="hljs-attr">multipart:</span><br>      <span class="hljs-attr">max-file-size:</span> <span class="hljs-string">100MB</span>    <span class="hljs-comment"># 文件上传大小限制</span><br>      <span class="hljs-attr">max-request-size:</span> <span class="hljs-string">100MB</span> <span class="hljs-comment"># 文件最大请求限制</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-comment"># Redis配置</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">redis-server</span>   <span class="hljs-comment"># Redis服务地址</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>        <span class="hljs-comment"># Redis端口</span><br>    <span class="hljs-attr">password:</span> &#123;<span class="hljs-string">your_password</span>&#125; <span class="hljs-comment"># Redis密码</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span>       <span class="hljs-comment"># 数据库索引</span><br>    <span class="hljs-attr">timeout:</span> <span class="hljs-number">5000</span>     <span class="hljs-comment"># 连接超时</span><br>    <span class="hljs-attr">lettuce:</span><br>      <span class="hljs-attr">pool:</span><br>        <span class="hljs-attr">max-wait:</span> <span class="hljs-number">30000</span> <span class="hljs-comment"># 连接池最大阻塞等待时间(使用负数表示没有限制,默认-1)</span><br>        <span class="hljs-attr">max-active:</span> <span class="hljs-number">100</span> <span class="hljs-comment"># 连接池最大连接数(使用负数表示没有限制,默认8)</span><br>        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">20</span>    <span class="hljs-comment"># 连接池中的最大空闲连接(默认8)</span><br>        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span>     <span class="hljs-comment"># 连接池中的最小空闲连接(默认0)</span><br><br><span class="hljs-comment"># Mybatis-plus配置</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath*:/mapper/**Mapper.xml</span><br>  <span class="hljs-attr">typeAliasesPackage:</span> <span class="hljs-string">com.mdd.**.mapper</span><br>  <span class="hljs-attr">global-config:</span><br>    <span class="hljs-attr">banner:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-attr">db-config:</span><br>      <span class="hljs-attr">table-prefix:</span> <span class="hljs-string">la_</span><br>  <span class="hljs-attr">configuration-properties:</span><br>    <span class="hljs-attr">prefix:</span> <span class="hljs-string">la_</span><br><br></code></pre></td></tr></table></figure><p><code>2.0</code>版本以上的<code>spring-boot</code> 通过<code>application-docker.yml</code>找到对应<code>active</code>的配置文件。不需要再文件中再指定<code>spring.profiles.active=docker</code>。</p><h3 id="上传jar"><a href="#上传jar" class="headerlink" title="上传jar"></a>上传jar</h3><p>将打包好的jar文件上传到服务器上:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">scp &#123;your_project_version&#125;.jar root@&#123;your_ip&#125;:&#123;path/to/your/file&#125;<br></code></pre></td></tr></table></figure><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>在<code>jar</code>包同级目录下新建<code>Dockerfile</code>文件:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> eclipse-temurin:<span class="hljs-number">17</span>-jre<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> &#123;your_project_version&#125;.jar app.jar</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">18084</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;-jar&quot;</span>, <span class="hljs-string">&quot;app.jar&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>其中<code>ENTRYPOINT</code>没有指定运行的环境变量，是因为在<code>docker-compose.yml</code> 文件中进行了指定。<code>spring-boot</code>会优先使用系统环境变量。</p><h3 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h3><p>在<code>jar</code>包同级目录下新建<code>docker-compose.yml</code>文件:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.8&#x27;</span><br><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">java-app:</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">.</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">Dockerfile</span><br>    <span class="hljs-attr">image:</span> &#123;<span class="hljs-string">your_project_name</span>&#125;<span class="hljs-string">-java-app:1.0</span><br>    <span class="hljs-attr">container_name:</span> &#123;<span class="hljs-string">your_project_name</span>&#125;<span class="hljs-string">_java_app</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;18084:18084&quot;</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">SPRING_DATASOURCE_URL:</span> <span class="hljs-string">jdbc:mysql://mysql8:3306/like_admin?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true&amp;useSSL=false</span><br>      <span class="hljs-attr">SPRING_DATASOURCE_USERNAME:</span> <span class="hljs-string">root</span><br>      <span class="hljs-attr">SPRING_DATASOURCE_PASSWORD:</span> &#123;<span class="hljs-string">your_password</span>&#125;<br>      <span class="hljs-attr">SPRING_REDIS_HOST:</span> <span class="hljs-string">redis-server</span><br>      <span class="hljs-attr">SPRING_REDIS_PORT:</span> <span class="hljs-number">6379</span><br>      <span class="hljs-attr">SPRING_REDIS_PASSWORD:</span> &#123;<span class="hljs-string">your_password</span>&#125;<br>      <span class="hljs-attr">SPRING_PROFILES_ACTIVE:</span> <span class="hljs-string">docker</span><br>      <span class="hljs-attr">SERVER_PORT:</span> <span class="hljs-number">18084</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">mysql_mysql-network</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">redis_redis-network</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">mysql_mysql-network:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># 表明使用已存在的网络，不新建</span><br>  <span class="hljs-attr">redis_redis-network:</span><br>    <span class="hljs-attr">external:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><ul><li><code>build</code> 表明该服务需要根据<code>Dockerfile</code>进行构建。</li><li><code>environment</code> 表明该服务需要的环境变量。<code>spring-boot</code>会根据环境变量进行配置，<code>SPRING_DATASOURCE_URL</code>对应了<code>application-docker.yml</code>中的<code>spring.datasource.url</code>。其他配置同理。<code>spring-boot</code>会优先使用环境变量。</li><li><code>networks</code> 表明该服务需要连接的网络。<code>mysql_mysql-network</code>和<code>redis_redis-network</code>是已存在的网络，与之对应的是之前创建的<code>mysql</code>和<code>redis</code>容器。设置了对应的网络，才使得该容器可以通过<code>mysql8</code>和<code>redis-server</code>这两个容器的主机名进行通信。<br> 获取已存在的网络名称: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker network ls<br></code></pre></td></tr></table></figure> 可以看到<code>mysql_mysql-network</code>和<code>redis_redis-network</code>这两个网络。与在<code>docker-compose.yml</code>中指定的网络有些许不同，以从<code>docker network ls</code>中获取的<code>NAME</code>为准。</li></ul><h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><p>在<code>jar</code>包同级目录下执行:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose up -d<br></code></pre></td></tr></table></figure><ul><li><code>up</code> 表明启动服务。</li><li><code>-d</code> 表明在后台运行。</li></ul><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><h3 id="配置反向代理"><a href="#配置反向代理" class="headerlink" title="配置反向代理"></a>配置反向代理</h3><p>找到<code>nginx</code>的配置文件:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nginx -t<br></code></pre></td></tr></table></figure><p>进入到配置目录，新建<code>api.conf</code>文件:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">if</span> (<span class="hljs-variable">$host</span> = api.stanlee.top) &#123;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$host</span><span class="hljs-variable">$request_uri</span>;<br>    &#125; <span class="hljs-comment"># managed by Certbot</span><br><br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span> api.stanlee.top;<br><br>    <span class="hljs-comment">#access_log  /var/log/nginx/host.access.log  main;</span><br><br>    <span class="hljs-section">location</span> / &#123;<br><span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:18084;<br><span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br><span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>   <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br><span class="hljs-attribute">root</span>   /usr/share/nginx/html;<br><span class="hljs-attribute">index</span> index.html index.htm;<br>    &#125;<br><br>    <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;<br>    <span class="hljs-section">location</span> = /50x.html &#123;<br>        <span class="hljs-attribute">root</span>   /usr/share/nginx/html;<br>    &#125;<br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;<br>    <span class="hljs-attribute">server_name</span> api.stanlee.top;<br>    <span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/api.stanlee.top/fullchain.pem; <span class="hljs-comment"># managed by Certbot</span><br>    <span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/api.stanlee.top/privkey.pem; <span class="hljs-comment"># managed by Certbot</span><br><br>    <span class="hljs-attribute">ssl_protocols</span> TLSv1.<span class="hljs-number">2</span> TLSv1.<span class="hljs-number">3</span>;  <span class="hljs-comment"># 支持的协议版本</span><br>    <span class="hljs-attribute">ssl_ciphers</span> HIGH:!aNULL:!MD5;  <span class="hljs-comment"># 加密套件</span><br>    <span class="hljs-attribute">ssl_prefer_server_ciphers</span> <span class="hljs-literal">on</span>;  <span class="hljs-comment"># 优先使用服务器的加密套件</span><br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:18084;<br>        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Certbot生成对应的证书"><a href="#Certbot生成对应的证书" class="headerlink" title="Certbot生成对应的证书"></a>Certbot生成对应的证书</h3><p>在终端执行:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">certbot --nginx -d api.stanlee.top<br></code></pre></td></tr></table></figure><ul><li><code>--nginx</code> 表明使用<code>nginx</code>插件。</li><li><code>-d api.stanlee.top</code> 表明申请的域名是<code>api.stanlee.top</code>。</li></ul><p>证书生成之后，需要重启<code>nginx</code>服务:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nginx -s reload<br></code></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>在浏览器中访问<code>https://api.stanlee.top</code>，如果能正常访问，说明配置成功。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>使用<code>docker-compose</code>我们可以便捷的部署<code>MySql</code>、<code>Redis</code>、<code>Nginx</code>、<code>Java</code>服务。如果需要迁移到其他服务器，只需要将<code>docker-compose.yml</code>和<code>Dockerfile</code>文件复制到目标服务器上，执行<code>docker-compose up -d</code>即可。</p>]]></content>
    
    
    
    <tags>
      
      <tag>nginx</tag>
      
      <tag>docker</tag>
      
      <tag>mysql</tag>
      
      <tag>java</tag>
      
      <tag>redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring Cloud 学习笔记</title>
    <link href="/2026/01/07/spring-cloud/"/>
    <url>/2026/01/07/spring-cloud/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Spring Cloud 是一个基于 Spring Boot 的微服务框架，它提供了一整套的解决方案，帮助开发者快速构建和部署微服务。国内的阿里巴巴也提供了自己的微服务框架，即 Spring Cloud Alibaba。<br>所以我们在学习的时候可以使用Spring Cloud Alibaba，它提供了一整套的解决方案，帮助开发者快速构建和部署微服务，包括服务注册与发现、配置中心、负载均衡、断路器等。本章节的主要内容主要是介绍Spring Cloud Alibaba的主要组件，以及如何使用它们来构建和部署微服务。</p><ul><li>Spring-cloud-alibaba：基于 Spring Cloud 的微服务框架，提供了一整套的解决方案，帮助开发者快速构建和部署微服务。</li><li>Nacos：服务注册与发现、配置中心</li><li>Gateway：API 网关，用于路由、过滤、负载均衡等</li></ul><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shell">├── cloud-common<br>│   ├── HELP.md<br>│   ├── mvnw<br>│   ├── mvnw.cmd<br>│   ├── pom.xml<br>│   ├── src<br>│   └── target<br>├── cloud-gateway<br>│   ├── HELP.md<br>│   ├── mvnw<br>│   ├── mvnw.cmd<br>│   ├── pom.xml<br>│   ├── src<br>│   └── target<br>├── order-service<br>│   ├── HELP.md<br>│   ├── mvnw<br>│   ├── mvnw.cmd<br>│   ├── pom.xml<br>│   ├── src<br>│   └── target<br>├── pom.xml<br>└── user-service<br>    ├── HELP.md<br>    ├── mvnw<br>    ├── mvnw.cmd<br>    ├── pom.xml<br>    ├── src<br>    └── target<br></code></pre></td></tr></table></figure><ul><li>cloud-common：公共模块，包含一些公共的类、接口、枚举等</li><li>cloud-gateway：API 网关模块，用于路由、过滤、负载均衡等</li><li>order-service：订单服务模块，用于处理订单相关的业务逻辑</li><li>user-service：用户服务模块，用于处理用户相关的业务逻辑</li></ul><p> 其中项目的根目录有一个<code>pom.xml</code>文件，它是项目的父工程，用于管理子工程的依赖和插件。相当于是一个项目的总配置文件，进行依赖以及项目配置的总管理。<br> 文件内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0</span></span><br><span class="hljs-string"><span class="hljs-tag">         http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.demo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-demo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">spring.boot.version</span>&gt;</span>3.4.5<span class="hljs-tag">&lt;/<span class="hljs-name">spring.boot.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">spring.cloud.version</span>&gt;</span>2024.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">spring.cloud.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">spring.cloud.alibaba.version</span>&gt;</span>2023.0.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">spring.cloud.alibaba.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- Spring Boot --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.boot.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- Spring Cloud --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.cloud.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- Spring-cloud-alibaba --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.cloud.alibaba.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p> 其中 <code>packaging</code> 标签指定了项目的打包方式，这里是 <code>pom</code>，表示这是一个父工程，不包含可执行的代码，只是用于管理子工程的依赖和插件。<br> 其中的 <code>dependencyManagement</code> 标签用于管理子工程的依赖，这里指定了 Spring Boot、Spring Cloud、Spring Cloud Alibaba 等依赖的版本，以及它们的打包方式。<br> 在子模块中使用时，只需要在 <code>pom.xml</code> 文件中添加对应的依赖即可，不需要再指定版本号。<br> 例如，在 <code>order-service</code> 模块中使用 Nacos 作为服务注册与发现组件，只需要添加如下依赖即可：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>其中<code>spring-cloud-alibaba-dependencies</code> 其中已内置了 Nacos 相关的依赖，所以我们只需要添加 <code>spring-cloud-starter-alibaba-nacos-discovery</code> 依赖即可。</p><h2 id="子模块配置"><a href="#子模块配置" class="headerlink" title="子模块配置"></a>子模块配置</h2><p>在子模块的 <code>pom.xml</code> 文件中，需要添加如下配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.demo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-demo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span> /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br></code></pre></td></tr></table></figure><p>其中 <code>parent</code> 标签指定了父工程的坐标，这里是 <code>spring-cloud-demo</code> 项目的根目录下的 <code>pom.xml</code> 文件。<br>通过添加这个配置，子模块就可以继承父工程的依赖和插件，避免重复配置。<br>子模块<code>pom.xml</code>内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.demo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-demo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>user-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>user-service<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>user-service<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">licenses</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">license</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">licenses</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">developers</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">developer</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">developers</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scm</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">connection</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">developerConnection</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tag</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">scm</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>其中我们需要使用到spring-boot-starter-web依赖，用于提供RESTful API。<br>然后就是添加<code>spring-cloud-starter-alibaba-nacos-discovery</code>用于服务注册与发现。<br>同时，我们也需要添加<code>spring-cloud-starter-alibaba-nacos-config</code>用于配置中心。可以通过nacos中心进行项目配置的动态获取与更新。</p><h2 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h2><p>我是基于<code>Docker</code>部署的Nacos服务，所以仅需要一行命令即可启动Nacos服务。我是创建的3.0版本的Nacos服务。与以往的版本使用方式不太一致。</p><ol><li><p>拉取镜像:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull nacos/nacos-server:3.0.1<br></code></pre></td></tr></table></figure></li><li><p>生成密钥(启动Nacos服务时需要):</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">openssl rand -base64 32 | tr -d &#x27;/+=&#x27; | cut -c1-32<br>echo $TOKEN<br></code></pre></td></tr></table></figure><p>示例输出：OQCiofvklDg15KV4dJxqzxkL9BITbMYB。</p></li></ol><p>将其进行base64编码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo -n &quot;OQCiofvklDg15KV4dJxqzxkL9BITbMYB&quot; | base64 -w 0<br></code></pre></td></tr></table></figure><p>输出示例：T1FDaW9mdmtsRGcxNUtWNGRIeHF6eGtMOUJJVGJNWUI&#x3D;。</p><p>即可生成我们需要的NACOS_AUTH_TOKEN。</p><ol start="3"><li>启动Nacos服务:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run --name nacos \<br>    -e MODE=standalone \<br>    -e NACOS_AUTH_TOKEN=T1FDaW9mdmtsRGcxNUtWNGRIeHF6eGtMOUJJVGJNWUI= \<br>    -e NACOS_AUTH_IDENTITY_KEY=nacos \<br>    -e NACOS_AUTH_IDENTITY_VALUE=nacos \<br>    -p 8080:8080 \ # 新版本的nacos的控制台地址变成了 127.0.0.1:8080/index.html<br>    -p 8848:8848 \<br>    -p 9848:9848 \<br>    -d nacos/nacos-server:3.0.1<br></code></pre></td></tr></table></figure></li></ol><p>注: 启动完成后，即可通过 <code>http://localhost:8080/index.html</code> 访问 Nacos 控制台，默认账号密码均为 <code>nacos</code>。访问web控制台的端口是<code>8080</code>, 服务连接端口是<code>8848</code>。</p><h2 id="UserService"><a href="#UserService" class="headerlink" title="UserService"></a>UserService</h2><h3 id="项目依赖"><a href="#项目依赖" class="headerlink" title="项目依赖"></a>项目依赖</h3><p>在<code>UserService</code>模块的 <code>pom.xml</code> 文件中，需要添加如下依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.demo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-demo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>user-service<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>user-service<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>user-service<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">licenses</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">license</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">licenses</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">developers</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">developer</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">developers</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scm</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">connection</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">developerConnection</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tag</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">scm</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>在<code>UserService</code>模块的 <code>application.yaml</code> 文件中，需要添加如下配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">18080</span><br><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">user-service</span><br>  <span class="hljs-attr">profiles:</span><br>    <span class="hljs-attr">active:</span> <span class="hljs-string">dev</span><br>  <span class="hljs-attr">config:</span><br>    <span class="hljs-attr">import:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">optional:classpath:application.yaml</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">optional:nacos:$&#123;spring.application.name&#125;.yaml</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span><br>        <span class="hljs-attr">namespace:</span> <span class="hljs-string">ec9ee84f-9e35-400b-8c31-8ed8cca22316</span><br><span class="hljs-attr">logging:</span><br>  <span class="hljs-attr">level:</span><br>    <span class="hljs-attr">com.demo.userservice:</span> <span class="hljs-string">debug</span><br><br><br></code></pre></td></tr></table></figure><ul><li>其中<code>server.port</code>配置了服务的端口号为<code>18080</code>。</li><li><code>spring.application.name</code>配置了服务的名称为<code>user-service</code>。</li><li><code>spring.profiles.active</code>配置了当前环境为<code>dev</code>。</li><li><code>spring.config.import</code>配置了从本地的配置文件<code>classpath:application.yaml</code>和远程的<code>Nacos</code>服务中心<code>nacos:$&#123;spring.application.name&#125;.yaml</code>中导入配置。其中有先后顺序，后面的相同配置项会覆盖前面的配置。</li><li><code>spring.cloud.nacos.discovery.server-addr</code>配置了Nacos服务的连接地址为<code>127.0.0.1:8848</code>。</li><li><code>spring.cloud.nacos.discovery.namespace</code>配置了Nacos服务的命名空间为<code>ec9ee84f-9e35-400b-8c31-8ed8cca22316</code>。需要登录Nacos控制台，在命名空间列表中进行新建命名空间，即可获取到命名空间ID。</li><li><code>logging.level.com.demo.userservice</code>配置了<code>com.demo.userservice</code>包的日志级别为<code>debug</code>。</li></ul><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.demo.userservice.controller;<br><br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/api/users&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/hello&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">index</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello World&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/getUser&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Stan&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>因为是一个示例项目，所以就简单的创建一个<code>UserController</code>类，用于提供<code>/api/users/hello</code>和<code>/api/users/getUser</code>两个接口。通过访问这两个接口，即可验证服务是否正常运行。</p><ul><li><code>/api/users/hello</code>接口返回<code>Hello World</code>字符串。</li><li><code>/api/users/getUser</code>接口返回<code>Stan</code>字符串。</li></ul><h2 id="网关"><a href="#网关" class="headerlink" title="网关"></a>网关</h2><h3 id="项目依赖-1"><a href="#项目依赖-1" class="headerlink" title="项目依赖"></a>项目依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.demo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-demo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.demo<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>cloud-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>cloud-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>cloud-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">licenses</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">license</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">licenses</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">developers</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">developer</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">developers</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scm</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">connection</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">developerConnection</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tag</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">scm</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- Gateway 网关核心依赖 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- Nacos 服务发现 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 负载均衡 (Spring Cloud 2020 及以后版本需要显式引入) --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-loadbalancer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h3 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h3><p>在<code>Gateway</code>模块的 <code>application.yaml</code> 文件中，需要添加如下配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9090</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">cloud-gateway</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span><br>        <span class="hljs-attr">namespace:</span> <span class="hljs-string">ec9ee84f-9e35-400b-8c31-8ed8cca22316</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">locator:</span><br>          <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>          <span class="hljs-attr">lower-case-service-id:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">user-service</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://user-service</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/api/users/**</span><br></code></pre></td></tr></table></figure><ul><li><code>server.port</code>配置了网关的端口号为<code>9090</code>。</li><li><code>spring.application.name</code>配置了网关的名称为<code>cloud-gateway</code>。</li><li><code>spring.cloud.nacos.discovery.server-addr</code>配置了Nacos服务的连接地址为<code>localhost:8848</code>。</li><li><code>spring.cloud.nacos.discovery.namespace</code>配置了Nacos服务的命名空间为<code>ec9ee84f-9e35-400b-8c31-8ed8cca22316</code>。</li><li><code>spring.cloud.gateway.discovery.locator.enabled</code>配置了开启网关的服务发现功能。</li><li><code>spring.cloud.gateway.discovery.locator.lower-case-service-id</code>配置了将服务ID转换为小写。</li><li><code>routes</code>配置了网关的路由规则。<ul><li><code>id</code>配置了路由的ID为<code>user-service</code>。</li><li><code>uri</code>配置了路由的目标服务为<code>lb://user-service</code>，其中<code>lb</code>表示负载均衡。</li></ul></li><li><code>predicates</code>配置了路由的断言规则。<ul><li><code>Path=/api/users/**</code>配置了路由的路径为<code>/api/users/**</code>，表示所有以<code>/api/users/</code>开头的请求都将被路由到<code>user-service</code>服务。</li></ul></li></ul><h3 id="网关说明"><a href="#网关说明" class="headerlink" title="网关说明"></a>网关说明</h3><p>网关是微服务架构中的一个重要组件，它负责接收外部请求并将其路由到相应的微服务。网管模块中不应该编写业务逻辑，而应该专注于路由、过滤、负载均衡等功能。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过以上配置，我们成功地创建了一个基于Spring Cloud的微服务架构，包括服务注册与发现、配置中心、API网关等组件。每个微服务模块都有自己的业务逻辑，而网关模块则负责将外部请求路由到相应的微服务。</p><ol><li>启动<code>UserService</code>模块。</li><li>启动<code>Gateway</code>模块。</li></ol><p>访问<code>Nacos</code>控制台, 即可发现服务列表中会有两个服务: <code>user-service</code>和<code>cloud-gateway</code>。状态为运行时。</p><p>通过访问<code>http://localhost:9090/api/users/hello</code>，即可返回<code>Hello World</code>字符串。这首先是访问到的<code>cloud-gateway</code>网关，网关再将请求路由到<code>user-service</code>服务。<br>至此，我们成功地实现了基于Spring Cloud的微服务架构，包括服务注册与发现、配置中心、API网关等组件。</p>]]></content>
    
    
    
    <tags>
      
      <tag>Spring Cloud</tag>
      
      <tag>Java</tag>
      
      <tag>微服务</tag>
      
      <tag>Nacos</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习记录(11) - SpringBoot</title>
    <link href="/2025/12/19/java-study-11/"/>
    <url>/2025/12/19/java-study-11/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><code>Spring boot</code> 是在基于 <code>Spring MVC</code> 框架的基础上进行封装，简化了 <code>Spring</code> 应用的配置过程。它通过自动配置和约定大于配置的原则，减少了开发人员的工作量。<br>但是想要掌握<code>Spring boot</code>, 学习 <code>Spring MVC</code> 是必不可少的。能使我们更好地理解 <code>Spring</code> 框架的工作原理，同时也能帮助我们更好地配置和管理 <code>Spring boot</code> 应用。</p><h2 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h2><p>基于<code>Idea</code> 我们可以方便快捷的新建一个 <code>Spring boot</code> 项目。通过以下步骤进行新建：</p><ol><li>打开 <code>Idea</code>，点击 <code>File</code> -&gt; <code>New</code> -&gt; <code>Project</code>。</li><li>在 <code>New Project</code> 对话框中，选择 <code>Spring Boot</code>。</li><li>填写项目的基本信息，如项目名称、项目路径等。</li><li>选择 <code>Spring Boot</code> 版本和依赖项。</li><li>点击 <code>Finish</code> 完成项目的新建。</li></ol><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>新建完成后，项目的目录结构如下：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs stylus">├── HELP<span class="hljs-selector-class">.md</span><br>├── compose<span class="hljs-selector-class">.yaml</span><br>├── mvnw<br>├── mvnw<span class="hljs-selector-class">.cmd</span><br>├── pom<span class="hljs-selector-class">.xml</span><br>└── <span class="hljs-attribute">src</span><br>    ├── <span class="hljs-selector-tag">main</span><br>    │   ├── java<br>    │   │   └── org<br>    │   │       └── example<br>    │   │           └── springbootexample<br>    │   │               ├── SpringBootExampleApplication<span class="hljs-selector-class">.java</span><br>    │   │               ├── controller<br>    │   │               │   └── UserController<span class="hljs-selector-class">.java</span><br>    │   │               ├── entity<br>    │   │               │   ├── Result<span class="hljs-selector-class">.java</span><br>    │   │               │   └── User<span class="hljs-selector-class">.java</span><br>    │   │               ├── mapper<br>    │   │               │   └── UserMapper<span class="hljs-selector-class">.java</span><br>    │   │               └── service<br>    │   │                   └── UserService<span class="hljs-selector-class">.java</span><br>    │   └── resources<br>    │       ├── application<span class="hljs-selector-class">.yaml</span><br>    │       └── mapper<br>    │           └── user<span class="hljs-selector-class">.xml</span><br>    └── test<br>        └── java<br>            └── org<br>                └── example<br>                    └── springbootexample<br>                        └── SpringBootExampleApplicationTests.java<br></code></pre></td></tr></table></figure><h2 id="依赖项"><a href="#依赖项" class="headerlink" title="依赖项"></a>依赖项</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-devtools<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-docker-compose<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>annotationProcessor<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 集成JMS的监控插件，获取服务运行状态的, 仅生产环境可查看到 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 集成openapi, 可在线查看api文档 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springdoc<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springdoc-openapi-starter-webmvc-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>除了<code>Spring boot</code>开发所需的必要依赖项，还添加了<code>JMS - Actuator</code>查看运行状态以及<code>OpenAPI</code> 在线查看api文档。<br>可以看到<code>mybatis-spring-boot-starter</code> 依赖项，它是<code>Mybatis</code> 与 <code>Spring boot</code> 集成的依赖项。与普通的<code>Mybatis</code> 不同， 它提供了基于<code>Spring boot</code> 自动配置的功能，会自动配置项目用到的<code>Mybatis</code> 相关的组件，如<code>SqlSessionFactory</code>、<code>MapperScannerConfigurer</code> 等。其他的<code>starter</code> 依赖项，如<code>spring-boot-starter-webmvc</code>、<code>spring-boot-starter-actuator</code>、<code>springdoc-openapi-starter-webmvc-ui</code> 等，都是<code>Spring boot</code> 提供的<code>starter</code> 依赖项，用于简化<code>Spring boot</code> 应用的配置过程。</p><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><br><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/spring_example?useSSL=false&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">hikari:</span><br>      <span class="hljs-attr">maximum-pool-size:</span> <span class="hljs-number">20</span><br>      <span class="hljs-attr">minimum-idle:</span> <span class="hljs-number">10</span><br>      <span class="hljs-attr">connection-timeout:</span> <span class="hljs-number">30000</span><br>      <span class="hljs-attr">idle-timeout:</span> <span class="hljs-number">600000</span><br>      <span class="hljs-attr">max-lifetime:</span> <span class="hljs-number">1800000</span><br><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath*:mapper/**/*.xml</span>  <span class="hljs-comment">## 配置Mybatis映射器的扫描路径</span><br>  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">org.example.springbootexample.entity</span>  <span class="hljs-comment">## 配置Mybatis实体类的扫描路径</span><br>  <span class="hljs-attr">configuration:</span> <br>    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment">## 配置Mybatis驼峰命名映射</span><br>    <span class="hljs-attr">cache-enabled:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment">## 配置Mybatis缓存</span><br>    <span class="hljs-attr">use-generated-keys:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment">## 配置Mybatis使用生成的主键</span><br>    <span class="hljs-attr">lazy-loading-enabled:</span> <span class="hljs-literal">true</span>  <span class="hljs-comment">## 配置Mybatis懒加载</span><br><br></code></pre></td></tr></table></figure><p>与之前的<code>application.properties</code>不同，<code>application.yaml</code> 是基于<code>YAML</code> 格式的配置文件，它的语法更加简洁和易读。同时，<code>YAML</code> 格式的配置文件还支持注释和多行字符串等特性，使得配置文件的维护更加方便。<br>同时，这也是<code>Spring boot</code>启动的默认配置文件，当项目启动时，<code>Spring boot</code> 会自动加载<code>application.yaml</code> 配置文件。根据文件内的相关配置，自动创建数据库连接池以及配置<code>Mybatis</code> 相关的组件。</p><h2 id="入口文件"><a href="#入口文件" class="headerlink" title="入口文件"></a>入口文件</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.springbootexample;<br><br><span class="hljs-keyword">import</span> org.mybatis.spring.annotation.MapperScan;<br><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<br><span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@MapperScan(basePackages = &quot;org.example.springbootexample.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringBootExampleApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(SpringBootExampleApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>在项目的根目录下有一个入口文件，该文件就是 <code>Spring Boot</code> 应用的入口文件。<code>@SpringBootApplication</code> 注解相当于默认的<code>@Configuration</code>、<code>@EnableAutoConfiguration</code> 和 <code>@ComponentScan</code> 注解的组合。<br>如果要使用到<code>Mybatis</code> 相关的组件，需要在入口文件上添加<code>@MapperScan</code> 注解，指定<code>Mybatis</code> 映射器的扫描路径。</p><h2 id="MyBatis-XML-映射器"><a href="#MyBatis-XML-映射器" class="headerlink" title="MyBatis XML 映射器"></a>MyBatis XML 映射器</h2><p>在<code>src/main/resources/mapper</code> 目录下有一个<code>UserMapper.xml</code> 文件，它是<code>Mybatis</code> 映射器的 XML 配置文件。该文件定义了<code>UserMapper</code> 接口的 SQL 映射关系，包括查询、插入、更新、删除等操作。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span></span><br><span class="hljs-meta">        <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="hljs-meta">        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;org.example.springbootexample.mapper.UserMapper&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;selectAll&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;User&quot;</span>&gt;</span><br>        SELECT * FROM user<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure><p>因为在<code>application.yaml</code> 配置文件中，已经配置了<code>Mybatis</code> 映射器的扫描路径为<code>classpath*:mapper/**/*.xml</code>，所以<code>UserMapper.xml</code> 文件会被自动扫描到。<br>以及在<code>application.yaml</code> 配置文件中，已经配置了<code>Mybatis</code> 实体类的扫描路径为<code>org.example.springbootexample.entity</code>，所以<code>User</code> 实体类会被自动扫描到。<code>resultType</code>指向的<code>User</code> 实体类，会自动映射查询结果到<code>User</code> 对象中。</p><h2 id="项目打包"><a href="#项目打包" class="headerlink" title="项目打包"></a>项目打包</h2><p>在 <code>Idea</code> 中， 在界面右侧选择 <code>Maven</code> 项目， 点击 <code>Lifecycle</code> 下的 <code>package</code> 选项，即可打包项目。<br>打包完成后，会在项目的<code>target</code> 目录下生成一个<code>jar</code> 文件，该文件就是可执行的<code>Spring Boot</code> 应用。</p><p>在终端窗口中运行 <code>java -jar target/spring-boot-example-0.0.1-SNAPSHOT.jar</code> 即可启动应用。</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习记录(10) - SpringMVC(实现api接口请求)</title>
    <link href="/2025/12/18/java-study-10/"/>
    <url>/2025/12/18/java-study-10/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><ul><li>通过学习<code>Spring</code> 以及 <code>Servlet</code> 相关知识, 我们已经可以进行开发 <code>api</code> 接口了。通过<code>Spring</code>实现<code>IoC</code> 以及 <code>AOP</code> 可以帮助我们更好的管理<code>Bean</code>以及创建实例、连接数据库等操作。</li><li>通过<code>HikariCP</code> 可以更方便的管理数据库连接池, 避免了手动创建连接池的繁琐过程。</li><li>通过<code>MyBatis</code> 可以更轻易的实现数据库的增删改查操作, 我们只需要定义好<code>Mapper</code> 接口, 并在<code>xml</code> 文件中实现对应的<code>sql</code> 语句即可。</li><li>通过<code>lombok</code> 可以减少我们的代码量, 避免了手动编写<code>getter</code> 、 <code>setter</code> 等方法， 通过注解的形式可以自动生成相应的方法。</li><li>通过 <code>jackson-databind</code> 可以更方便的实现<code>json</code> 与 <code>java</code> 对象的转换, 我们只需要在<code>Controller</code> 中添加<code>@RequestBody</code> 注解即可将<code>json</code> 字符串转换为<code>java</code> 对象。</li></ul><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs sh">├── pom.xml<br>└── src<br>    ├── main<br>    │   ├── java<br>    │   │   └── org<br>    │   │       └── example<br>    │   │           ├── AppConfig.java<br>    │   │           ├── entity<br>    │   │           │   └── User.java<br>    │   │           ├── mapper<br>    │   │           │   └── UserMapper.java<br>    │   │           ├── service<br>    │   │           │   └── UserService.java<br>    │   │           ├── util<br>    │   │           │   └── Result.java<br>    │   │           └── controller<br>    │   │               ├── TestController.java<br>    │   │               └── UserController.java<br>    │   ├── resources<br>    │   │   ├── jdbc.properties<br>    │   │   └── logback.xml<br>    │   └── webapp<br>    │       ├── WEB-INF<br>    │       │   ├── templates<br>    │       │   └── web.xml<br>    │       └── static<br>    ├── mian<br>    │   └── webapp<br>    │       └── WEB-INF<br>    └── <span class="hljs-built_in">test</span><br>        └── java<br><br></code></pre></td></tr></table></figure><h2 id="项目依赖"><a href="#项目依赖" class="headerlink" title="项目依赖"></a>项目依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- aop 相关依赖 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jakarta.annotation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jakarta.annotation-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 日志系统 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.4.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 数据库连接池 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 数据库驱动 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- MySQL 驱动 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- lombok --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.30<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- 建议使用最新稳定版本 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- MyBatis --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5.11<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- jackson-databind --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.14.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aspects<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h2><p><code>web-xml</code> 配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcher<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextClass<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>org.springframework.web.context.support.AnnotationConfigWebApplicationContext<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>org.example.AppConfig<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>dispatcher<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>该配置文件的作用是将<code>Spring</code>的<code>AnnotationConfigWebApplicationContext</code>与<code>DispatcherServlet</code>关联起来，<br>并指定<code>AppConfig</code>类作为配置类。也就是在<code>Servlet</code>初始化时实现<code>Spring</code>的<code>ApplicationContext</code>的初始化。</p><p><code>jdbc.properties</code> 配置文件</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">jdbc.driverClassName</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br><span class="hljs-attr">jdbc.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/test?useSSL=false&amp;serverTimezone=UTC</span><br><span class="hljs-attr">jdbc.username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">jdbc.password</span>=<span class="hljs-string">123456</span><br></code></pre></td></tr></table></figure><p>数据库的连接配置</p><p><code>logback.xml</code> 配置文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;STDOUT&quot;</span></span><br><span class="hljs-tag">              <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">Pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-5level %logger&#123;36&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">Pattern</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;org.example&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure><p>日志配置</p><h2 id="IDEA配置"><a href="#IDEA配置" class="headerlink" title="IDEA配置"></a>IDEA配置</h2><p>如果项目不是基于<code>JavaEE</code>项目创建的，则需要手动配置项目结构。在<code>IDEA</code>中，点击<code>File</code> -&gt; <code>Project Structure</code>，选择<code>Facet</code>与<code>Artifact(工件)</code>。</p><p><img src="/images/java/spring-mvc-01.png" alt="Facet"></p><p><img src="/images/java/spring-mvc-02.png" alt="Artifact"></p><p>配置好了以后，才可以配置<code>Tomcat</code>服务器进行启动。</p><h2 id="AppConfig-Spring-配置类"><a href="#AppConfig-Spring-配置类" class="headerlink" title="AppConfig Spring 配置类"></a>AppConfig Spring 配置类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> com.zaxxer.hikari.HikariConfig;<br><span class="hljs-keyword">import</span> com.zaxxer.hikari.HikariDataSource;<br><span class="hljs-keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;<br><span class="hljs-keyword">import</span> org.mybatis.spring.annotation.MapperScan;<br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.*;<br><span class="hljs-keyword">import</span> org.springframework.jdbc.datasource.DataSourceTransactionManager;<br><span class="hljs-keyword">import</span> org.springframework.transaction.PlatformTransactionManager;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc;<br><br><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><br><span class="hljs-meta">@ComponentScan</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@PropertySource(&quot;classpath:/jdbc.properties&quot;)</span><br><span class="hljs-meta">@EnableAspectJAutoProxy</span><br><span class="hljs-meta">@EnableWebMvc</span><br><span class="hljs-meta">@EnableTransactionManagement</span><br><span class="hljs-meta">@MapperScan(&quot;org.example.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(AppConfig.class);<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String url;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String password;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">getDataSource</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">HikariConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HikariConfig</span>();<br>        config.setJdbcUrl(url);<br>        config.setUsername(username);<br>        config.setPassword(password);<br>        config.setDriverClassName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>        config.setMaximumPoolSize(<span class="hljs-number">5</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HikariDataSource</span>(config);<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> PlatformTransactionManager <span class="hljs-title function_">getTransactionManager</span><span class="hljs-params">(<span class="hljs-meta">@Autowired</span> DataSource dataSource)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceTransactionManager</span>(dataSource);<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> SqlSessionFactoryBean <span class="hljs-title function_">getSqlSessionFactoryBean</span><span class="hljs-params">(<span class="hljs-meta">@Autowired</span> DataSource dataSource)</span> &#123;<br>        <span class="hljs-type">SqlSessionFactoryBean</span> <span class="hljs-variable">sqlSessionFactoryBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SqlSessionFactoryBean</span>();<br>        sqlSessionFactoryBean.setDataSource(dataSource);<br>        <span class="hljs-keyword">return</span> sqlSessionFactoryBean;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>该类主要作用是配置注解,开启<code>Spring</code>的<code>AOP</code>功能,开启<code>事务管理</code>功能,开启<code>MyBatis</code>的<code>Mapper</code>扫描功能， 以及开启<code>WebMvc</code>的配置。<br>以及创建数据库连接池<code>HikariDataSource</code>， 创建事务管理器<code>DataSourceTransactionManager</code>， 以及创建<code>MyBatis</code>的<code>SqlSessionFactoryBean</code>。</p><h2 id="数据返回工具类"><a href="#数据返回工具类" class="headerlink" title="数据返回工具类"></a>数据返回工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.util;<br><br><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;<br><span class="hljs-keyword">import</span> lombok.Data;<br><span class="hljs-keyword">import</span> lombok.NoArgsConstructor;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">private</span> Integer code;<br>    <span class="hljs-keyword">private</span> String message;<br>    <span class="hljs-keyword">private</span> T data;<br><br>    <span class="hljs-comment">// 成功响应方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">success</span><span class="hljs-params">(T data)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;&gt;(<span class="hljs-number">200</span>, <span class="hljs-string">&quot;success&quot;</span>, data);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">success</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> success(<span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 失败响应方法</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">fail</span><span class="hljs-params">(Integer code, String message)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;&gt;(code, message, <span class="hljs-literal">null</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>该类的作用是封装数据返回结果，包括状态码、消息和数据。</p><h2 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.entity;<br><br><span class="hljs-keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;<br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-meta">@JsonProperty(access = JsonProperty.Access.WRITE_ONLY)</span><br>    <span class="hljs-keyword">private</span> String password;<br>    <span class="hljs-keyword">private</span> String email;<br>&#125;<br></code></pre></td></tr></table></figure><p>该类的作用是定义用户实体类，包括用户ID、用户名、密码和邮箱。使用了<code>Lombok</code>的<code>@Data</code>注解，自动生成了<code>getter</code>、<code>setter</code>、<code>toString</code>、<code>equals</code>和<code>hashCode</code>方法。<br>以及<code>@JsonProperty(access = JsonProperty.Access.WRITE_ONLY)</code>注解，用于在序列化时忽略<code>password</code>字段。表明该字段在序列化时只可写入不可读取。</p><h2 id="Mapper接口"><a href="#Mapper接口" class="headerlink" title="Mapper接口"></a>Mapper接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.mapper;<br><br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.*;<br><span class="hljs-keyword">import</span> org.example.entity.User;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> &#123;<br>    <span class="hljs-meta">@Select(&quot;SELECT * from users WHERE id = #&#123;id&#125;&quot;)</span><br>    User <span class="hljs-title function_">getUserById</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;id&quot;)</span> <span class="hljs-type">long</span> id)</span>;<br><br>    <span class="hljs-meta">@Select(&quot;SELECT * from users WHERE username = #&#123;username&#125; and password = #&#123;password&#125;&quot;)</span><br>    User <span class="hljs-title function_">getUserByUsernameAndPassword</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;username&quot;)</span> String username, <span class="hljs-meta">@Param(&quot;password&quot;)</span> String password)</span>;<br><br>    <span class="hljs-meta">@Update(&quot;UPDATE users SET username = #&#123;user.username&#125; WHERE id = #&#123;user.id&#125;&quot;)</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;user&quot;)</span> User user)</span>;<br><br>    <span class="hljs-meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;, keyColumn = &quot;id&quot;)</span><br>    <span class="hljs-meta">@Insert(&quot;INSERT INTO users (email, username, password) VALUES(#&#123;user.email&#125;, #&#123;user.username&#125;, #&#123;user.password&#125;)&quot;)</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">insertUser</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;user&quot;)</span> User user)</span>;<br><br>    <span class="hljs-meta">@Select(&quot;SELECT * from users&quot;)</span><br>    List&lt;User&gt; <span class="hljs-title function_">getUsers</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>该接口的作用是定义用户的数据库操作方法，包括根据ID查询用户、根据用户名和密码查询用户、更新用户、插入用户和查询所有用户。<br>使用了<code>MyBatis</code>的注解，包括<code>@Select</code>、<code>@Update</code>、<code>@Insert</code>和<code>@Options</code>。</p><h2 id="服务层"><a href="#服务层" class="headerlink" title="服务层"></a>服务层</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.service;<br><br><span class="hljs-keyword">import</span> org.example.entity.User;<br><span class="hljs-keyword">import</span> org.example.mapper.UserMapper;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">signIn</span><span class="hljs-params">(String username, String password)</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.getUserByUsernameAndPassword(username, password);<br>        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;账号不存在&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">register</span><span class="hljs-params">(User user)</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> userMapper.getUserByUsernameAndPassword(user.getUsername(), user.getPassword());<br>        <span class="hljs-keyword">if</span> (user1 != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;账号已存在&quot;</span>);<br>        &#125;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userMapper.insertUser(user);<br>        <span class="hljs-keyword">if</span> (result &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;注册失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">updateUsername</span><span class="hljs-params">(User user)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userMapper.updateUser(user);<br>        <span class="hljs-keyword">if</span> (result &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;修改用户名失败&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title function_">listUser</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> userMapper.getUsers();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>该类的作用是定义用户的服务层方法，包括登录、注册、修改用户名和查询所有用户。<br>使用了<code>Spring</code>的<code>@Service</code>注解，表明该类是一个服务层组件。<br>以及<code>@Transactional</code>注解，开启了事务管理。</p><h2 id="控制层"><a href="#控制层" class="headerlink" title="控制层"></a>控制层</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.controller;<br><br><span class="hljs-keyword">import</span> org.example.entity.User;<br><span class="hljs-keyword">import</span> org.example.service.UserService;<br><span class="hljs-keyword">import</span> org.example.util.Result;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/api&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/users&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;User&gt;&gt; <span class="hljs-title function_">getUsers</span><span class="hljs-params">()</span> &#123;<br>        List&lt;User&gt; users = userService.listUser();<br>        <span class="hljs-keyword">return</span> Result.success(users);<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/signin&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;User&gt; <span class="hljs-title function_">signin</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> RequestSignIn request)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.signIn(request.username, request.password);<br>            <span class="hljs-keyword">return</span> Result.success(user);<br>        &#125; <span class="hljs-keyword">catch</span> (RuntimeException e) &#123;<br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-number">500</span>, <span class="hljs-string">&quot;登录失败&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/register&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;User&gt; <span class="hljs-title function_">register</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> RequestSignUp request)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>            user1.setUsername(request.username);<br>            user1.setPassword(request.password);<br>            user1.setEmail(request.email);<br>            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.register(user1);<br>            <span class="hljs-keyword">return</span> Result.success(user);<br>        &#125; <span class="hljs-keyword">catch</span> (RuntimeException e) &#123;<br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-number">500</span>, <span class="hljs-string">&quot;注册失败&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestSignIn</span> &#123;<br>        <span class="hljs-keyword">public</span> String username;<br>        <span class="hljs-keyword">public</span> String password;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestSignUp</span> &#123;<br>        <span class="hljs-keyword">public</span> String username;<br>        <span class="hljs-keyword">public</span> String password;<br>        <span class="hljs-keyword">public</span> String email;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>该类的作用是定义用户的控制层方法，包括查询所有用户、登录和注册。<br>使用了<code>Spring</code>的<code>@RestController</code>注解，表明该类是一个<code>RESTful</code>控制器。<br>以及<code>@RequestMapping</code>注解，指定了该控制器的基础路径为<code>/api</code>。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>至此，我们即可使用<code>SpringMVC</code>框架来构建一个简单的用户管理系统，  当启动服务之后，我们可以通过<code>POST</code>请求<code>/api/register</code>来注册一个新用户，通过<code>POST</code>请求<code>/api/signin</code>来登录该用户，通过<code>GET</code>请求<code>/api/users</code>来查询所有用户。<br>还有需要注意的一个点是, 在<code>Spring</code>项目中连接数据库时, <code>url</code>可以是<code>jdbc:mysql://localhost:3306/spring_example</code>这种不带任何参数的地址，<code>Spring</code>在编译时会自动的添加上数据库连接所需要的一些额外参数,但是在<code>Servlet</code>中, 必须使用完整的<code>url</code>路径，比如<code>jdbc:mysql://localhost:3306/spring_example?useSSL=false&amp;characterEncoding=utf8&amp;allowPublicKeyRetrieval=true</code>, 需要设定<code>useSSl</code>等参数，因为<code>Servlet</code>不会帮你添加上这些，会导致数据库无法正确连接。</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>Spring</tag>
      
      <tag>MVC</tag>
      
      <tag>Servlet</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习记录(9) - Spring之AOP编程</title>
    <link href="/2025/12/10/java-study-9/"/>
    <url>/2025/12/10/java-study-9/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>AOP（Aspect-Oriented Programming）是与OOP（Object-Oriented Programming）不同的编程范式。它允许开发者将横切关注点（如日志记录、性能监控、事务管理等）从业务逻辑中分离出来，从而提高代码的可维护性和可重用性。更通俗的讲其实就是动态代理，Spring中使用的是 AspectJ 实现的 AOP。相当于为<code>@Aspect</code>注解的类动态生成代理类，生成的代理类会继承于该类，代理类会持有该类需要执行的Aspect实例与该类的实例，通过重写该类的方法获取该类实例获取到的属性值。</p><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- 请使用最新版本 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- MySQL 驱动 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.16.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- 请使用最新稳定版本 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jakarta.annotation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jakarta.annotation-api <span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-aspects<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h2 id="装配AOP"><a href="#装配AOP" class="headerlink" title="装配AOP"></a>装配AOP</h2><p><code>LoggingAspect</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">package</span> org.example.utils;<br><br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Around;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Before;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingAspect</span> &#123;<br>    <span class="hljs-meta">@Before(&quot;execution(public * org.example.service.UserService.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAccessCheck</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;doAccessCheck !!!&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Around(&quot;execution(public * org.example.service.MailService.*(..))&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">doLogging</span><span class="hljs-params">(ProceedingJoinPoint pjp)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        System.out.println(<span class="hljs-string">&quot;doLogging start!!&quot;</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> pjp.proceed();<br>        System.out.println(<span class="hljs-string">&quot;doLogging end!!&quot;</span>);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>通过<code>@Aspect</code>注解将<code>LoggingAspect</code>类标记为切面类，通过<code>@Component</code>注解将<code>LoggingAspect</code>类标记为组件类，Spring会自动扫描到该类并将其注册为Bean。<br>然后在具体方法上添加<code>@Before</code>或<code>@Around</code>注解，即可将该方法标记为切面方法。符合<code>execution(public * org.example.service.UserService.*(..))</code>表达式的方法会在调用前执行<code>doAccessCheck</code>方法，符合<code>execution(public * org.example.service.MailService.*(..))</code>表达式的方法会在调用前执行<code>doLogging</code>方法。</p><p>入口类需要添加 <code>@EnableAspectJAutoProxy</code> 注解开启 AOP 功能。</p><h2 id="使用注解装配AOP"><a href="#使用注解装配AOP" class="headerlink" title="使用注解装配AOP"></a>使用注解装配AOP</h2><p><code>注解类</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.annotation;<br><br><span class="hljs-keyword">import</span> java.lang.annotation.ElementType;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><br><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MetricTime &#123;<br>    String <span class="hljs-title function_">value</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><code>切面实现类</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.utils;<br><br><span class="hljs-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Around;<br><span class="hljs-keyword">import</span> org.aspectj.lang.annotation.Aspect;<br><span class="hljs-keyword">import</span> org.example.annotation.MetricTime;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MetricAspect</span> &#123;<br>    <span class="hljs-comment">// @annotation(xxx)  其中xxx取决于 metric方法中的第二个参数名</span><br>    <span class="hljs-meta">@Around(&quot;@annotation(metricTime)&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">metric</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, MetricTime metricTime)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> metricTime.value();<br>        <span class="hljs-type">long</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">return</span> joinPoint.proceed();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>            <span class="hljs-type">long</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> end - start;<br>            System.out.println(name + <span class="hljs-string">&quot;总计用时&quot;</span> + t + <span class="hljs-string">&quot;ms&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>使用注解</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.service;<br><br><span class="hljs-keyword">import</span> org.example.annotation.MetricTime;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-meta">@MetricTime(&quot;addUser&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addUser</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;addUser&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>metric</code> 会在执行<code>addUser</code>方法前后分别记录时间，并输出<code>addUser</code>总计用时xxxms。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>AOP是一个非常实用且好用的功能，它可以在不改变原有代码的情况下，为应用添加新的功能。基本的原理是通过动态代理，在目标方法执行前后插入切面代码。<br>但是使用AOP也有一个注意事项，就是如果目标方法是一个final方法，那么就无法使用AOP了。因为final方法是不能被重写的，所以无法在其执行前后插入切面代码。<br>还有就是通过AOP的学习，更深切认识到java编译时做的相关操作。一个类中定义的属性，会默认在类的构造方法中初始化，并且构造函数会默认调用super()方法。这些都是java编译时做的操作，所以在使用AOP时，需要注意这些细节。<br>因为AOP的原理是动态生成子类的实现，生成的动态类并不会调用父类的super()以及初始化父类的属性。所以我们要通过重写Get方法通过父类的实例获取对应的属性.<br>在使用AOP时我们应该通过方法获取属性值，并且需要被代理的类不要使用final方法</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>Spring</tag>
      
      <tag>AOP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习记录(8) - Spring之IoC容器</title>
    <link href="/2025/12/08/java-study-8/"/>
    <url>/2025/12/08/java-study-8/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>IoC（Inversion of Control）容器是一种设计模式，用于管理应用程序的对象生命周期和依赖关系。 通俗易懂的讲就是当一个类内需要依赖其他类时，而不是自己创建或查找这些依赖，而是将这些依赖的创建和查找的责任交给统一的控制中心，在调用时由控制中心负责提供这些依赖。而Spring框架就是一种实现了IoC容器的框架，它通过依赖注入（Dependency Injection）来实现IoC容器的功能。</p><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <span class="hljs-comment">&lt;!-- Spring 框架--&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- 数据库连接池 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- MySQL 驱动 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <span class="hljs-comment">&lt;!-- JSON 处理 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.16.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jakarta.annotation<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jakarta.annotation-api <span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span> <span class="hljs-comment">&lt;!-- 注解处理 --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h2 id="XML配置"><a href="#XML配置" class="headerlink" title="XML配置"></a>XML配置</h2><p>使用xml配置文件的形式实现IoC容器的功能，需要在xml文件中定义bean的配置信息，包括bean的id、class、构造函数参数、属性等。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.service.UserService&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mailService&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;mailService&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;mailService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.example.service.MailService&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.zaxxer.hikari.HikariDataSource&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbcUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/spring_example&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;stanlee1226&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maximumPoolSize&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;10&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;autoCommit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>在Spring中, 需要组装的组件称之为Bean, 所以组装组件就是组装Bean。 而IoC容器就是负责管理这些Bean的生命周期和依赖关系的容器。如上所示，我们定义了3个Bean：userService、mailService、dataSource。其中userService依赖于dataSource和mailService。</p><p><code>UserService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.service;<br><br><span class="hljs-keyword">import</span> org.example.bean.User;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<br><br><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><span class="hljs-keyword">import</span> java.sql.PreparedStatement;<br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-keyword">private</span> MailService mailService;<br><br>    <span class="hljs-keyword">private</span> DataSource dataSource;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMailService</span><span class="hljs-params">(MailService mailService)</span> &#123;<br>        <span class="hljs-built_in">this</span>.mailService = mailService;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">constructor</span><span class="hljs-params">(DataSource dataSource)</span> &#123;<br>        <span class="hljs-built_in">this</span>.dataSource = dataSource;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> User <span class="hljs-title function_">login</span><span class="hljs-params">(String username, String password)</span> &#123;<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.dataSource.getConnection()) &#123;<br>            <span class="hljs-keyword">try</span> (<span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">statement</span> <span class="hljs-operator">=</span> conn.prepareStatement(<span class="hljs-string">&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;</span>)) &#123;<br>                statement.setString(<span class="hljs-number">1</span>, username);<br>                statement.setString(<span class="hljs-number">2</span>, password);<br>                <span class="hljs-keyword">try</span> (<span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> statement.executeQuery()) &#123;<br>                    <span class="hljs-keyword">if</span> (rs.next()) &#123;<br>                        <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span>  rs.getInt(<span class="hljs-string">&quot;id&quot;</span>);<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">email</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;email&quot;</span>);<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">_username</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;username&quot;</span>);<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">_password</span> <span class="hljs-operator">=</span> rs.getString(<span class="hljs-string">&quot;password&quot;</span>);<br>                        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(id, _username, _password, email);<br>                        <span class="hljs-built_in">this</span>.mailService.sendLoginMail(user);<br>                        <span class="hljs-keyword">return</span> user;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>需要注意的是，绑定Bean的方式有两种：构造函数绑定和属性绑定。</p><ul><li>constructor-arg: 通过构造函数参数绑定Bean的依赖关系。所以我们需要添加一个 UserService 的构造函数, 参数为DataSource.</li><li>property: 通过setter方法绑定Bean的依赖关系。所以我们需要添加一个 setMailService 方法, 参数为MailService.注意, 这里的setter方法名必须与xml配置文件中property的name属性值一致. 如setMailService</li></ul><p>通过 <code>ClassPathXmlApplicationContext</code> 加载xml配置文件，创建IoC容器，然后通过 <code>getBean</code> 方法获取Bean实例。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;application.xml&quot;</span>);<br>        <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> context.getBean(UserService.class);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.login(<span class="hljs-string">&quot;bob@example.com&quot;</span>, <span class="hljs-string">&quot;password&quot;</span>);<br>        System.out.println(user.getName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="注解-Annotation-配置"><a href="#注解-Annotation-配置" class="headerlink" title="注解(Annotation)配置"></a>注解(Annotation)配置</h2><p>使用注解配置Bean的依赖关系, 可以减少xml配置文件的数量, 使配置更加简洁. 常用的注解有@Component, @Autowired, @Qualifier, @Value等.<br>我们在需要作为Bean的类上添加@Component注解, 表示将该类作为Bean进行管理. 如UserService类.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MailService mailService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> DataSource dataSource;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>其中 <code>@Autowired</code> 注解表示自动装配, 即自动注入依赖的Bean. 如mailService和dataSource.<code>mailService</code>作为Bean当然也需要加上@Component注解.<br>但是<code>dataSource</code>是一个第三方库提供的类, 我们不能在它的类上添加@Component注解. 所以我们需要为其添加一个<code>@Bean</code>注解, 表示将其作为Bean进行管理.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">dataSource</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">HikariDataSource</span> <span class="hljs-variable">dataSource</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HikariDataSource</span>();<br>    dataSource.setJdbcUrl(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/spring_example&quot;</span>);<br>    dataSource.setUsername(<span class="hljs-string">&quot;root&quot;</span>);<br>    dataSource.setPassword(<span class="hljs-string">&quot;********&quot;</span>);<br>    dataSource.setMaximumPoolSize(<span class="hljs-number">10</span>);<br>    dataSource.setAutoCommit(<span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">return</span> dataSource;<br>&#125;<br></code></pre></td></tr></table></figure><p>将这段代码放置在程序入口, 也就是标记为 @ComponentScan 的类上</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ComponentScan</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">applicationContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);<br>        <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> applicationContext.getBean(UserService.class);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.login(<span class="hljs-string">&quot;Stan&quot;</span>, <span class="hljs-string">&quot;stan12&quot;</span>);<br>        System.out.println(user.getUsername() + <span class="hljs-string">&quot;&gt;&quot;</span> + user.getPassword() + <span class="hljs-string">&quot;&gt;&quot;</span> + user.getEmail() + <span class="hljs-string">&quot;&gt;&quot;</span> + user.getId());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>注解<code>@Configuration</code> 表示这是一个IoC配置类，其中被 <code>@Bean</code>注解的方法会向 Spring IoC 容器提供 Bean 的定义信息, 使得三方库可以被定位以Bean组件进行调用。<br>其中<code>AnnotationConfigApplicationContext</code> 是一个基于注解的IoC容器, 它可以扫描指定的包, 并将其中标记为@Component的类作为Bean进行管理.<br>通过运行<code>@ComponentScan</code> 类， Spring会自动扫描目录内的Bean组件，并装载至容器内等待被调用.</p><h2 id="加载配置"><a href="#加载配置" class="headerlink" title="加载配置"></a>加载配置</h2><p>首先需要在<code>resources</code>目录下创建一个以<code>properties</code>结尾的文件</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/spring_example</span><br><span class="hljs-attr">username</span>=<span class="hljs-string">root</span><br><span class="hljs-attr">password</span>=<span class="hljs-string">********</span><br></code></pre></td></tr></table></figure><p>然后在启动类中使用注解<code>@PropertySource(&quot;db.properties&quot;)</code> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan</span><br><span class="hljs-meta">@PropertySource(&quot;db.properties&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>使用<code>@PropertySource</code>注解加载配置文件, 并将其中的属性绑定到Bean的属性上. 如url, username, password.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan</span><br><span class="hljs-meta">@PropertySource(&quot;db.properties&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span> &#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;url&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String url;<br>    <span class="hljs-meta">@Value(&quot;$&#123;username&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-meta">@Value(&quot;$&#123;password&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String password;<br>&#125;<br></code></pre></td></tr></table></figure><p>其中<code>@Value(&quot;$&#123;url&#125;&quot;)</code> 表示将配置文件中<code>url</code>属性的值绑定到<code>url</code>属性上. 其他属性同理.</p><p>使用<code>@Value(&quot;#&#123;appConfig.url&#125;&quot;)</code> 表示将从<code>AppConfig</code>类中获取<code>url</code>属性的值. 其他属性同理.</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li><code>@ComponentScan</code> 注解表示扫描指定的包, 并将其中标记为@Component的类作为Bean进行管理.</li><li><code>@Configuration</code> 注解表示这是一个IoC配置类，其中被 <code>@Bean</code>注解的方法会向 Spring IoC 容器提供 Bean 的定义信息, 使得三方库可以被定位以Bean组件进行调用。</li><li><code>@PropertySource</code> 注解表示加载配置文件, 并将其中的属性绑定到Bean的属性上.</li><li><code>@Value</code> 注解表示将配置文件中属性的值绑定到Bean的属性上. 可以使用<code>$&#123;&#125;</code>表示从配置文件中获取属性值, 也可以使用<code>#&#123;&#125;</code>表示从Bean中获取属性值.</li><li><code>@Autowired</code> 注解表示自动装配, 即自动注入依赖的Bean. 如mailService和dataSource.<code>mailService</code>作为Bean当然也需要加上@Component注解.</li><li><code>@Qualifier</code> 注解表示指定装配的Bean的名称. 如<code>@Autowired @Qualifier(&quot;mailService&quot;) private MailService mailService;</code> 表示装配名称为<code>mailService</code>的Bean.</li><li><code>@Conditional</code> 注解表示根据条件来判断是否装配Bean. 如根据是否存在某个类来判断是否装配Bean.</li><li><code>@ConditionalOnClass</code> 注解表示根据是否存在某个类来判断是否装配Bean. 如根据是否存在<code>DataSource</code>类来判断是否装配<code>dataSource</code> Bean.</li><li><code>@ConditionalOnMissingClass</code> 注解表示根据是否不存在某个类来判断是否装配Bean. 如根据是否不存在<code>DataSource</code>类来判断是否装配<code>dataSource</code> Bean.</li><li><code>@ConditionalOnProperty</code> 注解表示根据是否存在某个属性来判断是否装配Bean. 如根据是否存在<code>url</code>属性来判断是否装配<code>dataSource</code> Bean.</li><li><code>@ConditionalOnMissingProperty</code> 注解表示根据是否不存在某个属性来判断是否装配Bean. 如根据是否不存在<code>url</code>属性来判断是否装配<code>dataSource</code> Bean.</li><li><code>@ConditionalOnBean</code> 注解表示根据是否存在某个Bean来判断是否装配Bean. 如根据是否存在<code>mailService</code> Bean来判断是否装配<code>userService</code> Bean.</li><li><code>@ConditionalOnMissingBean</code> 注解表示根据是否不存在某个Bean来判断是否装配Bean. 如根据是否不存在<code>mailService</code> Bean来判断是否装配<code>userService</code> Bean.</li></ul><p>以前总以为java的反射和注解是什么复杂的知识，以为很难啃，但是通过学习<code>Spring IoC</code>容器, 深刻认识到反射以及注解在java中的使用方式及原理。当清楚了理论基础学习什么都不再是困难的事情了。</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>Spring</tag>
      
      <tag>IoC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习记录(7) - Servlet与Jsp</title>
    <link href="/2025/12/04/java-study-7/"/>
    <url>/2025/12/04/java-study-7/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>虽然JSP已经是属于淘汰的java框架了，但学习jsp对于java网络编程以及MVC架构的理解还是有一定的帮助的。</p><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>JspWebExample<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jakarta.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jakarta.servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.zaxxer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>HikariCP<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- 请使用最新版本 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>8.0.27<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- MySQL 驱动 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.16.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span> <span class="hljs-comment">&lt;!-- 请使用最新稳定版本 --&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>需要添加的依赖主要有 <code>jakarta.servlet-api</code>提供了servlet的api, <code>HikariCP</code>提供了数据库连接池, <code>mysql-connector-java</code>提供了mysql的驱动, <code>jackson-databind</code>提供了json的序列化和反序列化。</p><p>需要注意的是 <code>&lt;packaging&gt;war&lt;/packaging&gt;</code> 是必须的, 因为jsp是运行在servlet容器中的, 而servlet容器是war格式的。</p><p>以及Servlet项目需要跑在Tomcat容器中, 所以我们还需要下载Tomcat。目前我使用的是java17, 所以我下载的是Tomcat 11.0.14。</p><p>下载解压之后需要将Tomcat服务配置在idea中, 具体步骤如下:</p><p>点击 <code>Add Configuration</code> -&gt; 点击 <code>+</code> -&gt; 选择 <code>Tomcat Server</code> -&gt; 配置 <code>Tomcat</code> 路径。</p><p><img src="/images/java/tomcat-01.png" alt="1"></p><p><img src="/images/java/tomcat-02.png" alt="2"></p><p>添加部署项目, 选择 exploded， 表示展开项目目录，方便开发调试。</p><p><img src="/images/java/tomcat-03.png" alt="3"></p><p>修改项目启动访问地址，默认的启动地址是包含你的项目名称的，如果需要根据 <code>/</code> 根节点访问可以修改:</p><p><img src="/images/java/tomcat-04.png" alt="4"></p><p>配置完成之后点击运行即可启动Servlet项目。</p><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs stylus">JspWebExample<br>├── <span class="hljs-attribute">src</span><br>│   ├── <span class="hljs-selector-tag">main</span><br>│   │   ├── java<br>│   │   │   ├── com<br>│   │   │   │   ├── example<br>│   │   │   │   │   ├── db<br>│   │   │   │   │   ├── model<br>│   │   │   │   │   ├── service<br>│   │   │   │   │   ├── servlet<br>│   │   │   │   │   ├── Main<span class="hljs-selector-class">.java</span><br>│   │   ├── resources<br>│   │   │   ├── db<span class="hljs-selector-class">.properties</span><br>│   │   │   ├── log4j2<span class="hljs-selector-class">.xml</span><br>│   │   ├── webapp<br>│   │   │   ├── index.jsp<br></code></pre></td></tr></table></figure><p>Jsp需要添加一webapp文件夹, 用来存放jsp文件。Servlet会自动解析该目录下的jsp文件进行渲染。</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="数据库连接"><a href="#数据库连接" class="headerlink" title="数据库连接"></a>数据库连接</h3><p>数据库连接的代码在 <code>db</code> 包中, 主要是使用 <code>HikariCP</code> 连接池来连接数据库。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.db;<br><br><br><span class="hljs-keyword">import</span> com.zaxxer.hikari.HikariConfig;<br><span class="hljs-keyword">import</span> com.zaxxer.hikari.HikariDataSource;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceServer</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">HikariDataSource</span> <span class="hljs-variable">dataSource</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> HikariDataSource <span class="hljs-title function_">getDataSource</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (dataSource == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-type">HikariConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HikariConfig</span>();<br>            config.setDriverClassName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>            config.setJdbcUrl(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/learnjdbc?useSSL=false&amp;characterEncoding=utf8&amp;allowPublicKeyRetrieval=true&quot;</span>);<br>            config.setUsername(<span class="hljs-string">&quot;root&quot;</span>);<br>            config.setPassword(<span class="hljs-string">&quot;****************&quot;</span>);<br><br>            <span class="hljs-comment">// 配置连接池参数</span><br>            config.setMaximumPoolSize(<span class="hljs-number">20</span>);           <span class="hljs-comment">// 最大连接数</span><br>            config.setMinimumIdle(<span class="hljs-number">10</span>);               <span class="hljs-comment">// 最小空闲连接数</span><br>            config.setConnectionTimeout(<span class="hljs-number">30000</span>);      <span class="hljs-comment">// 获取连接超时时间（30秒）</span><br>            config.setIdleTimeout(<span class="hljs-number">600000</span>);           <span class="hljs-comment">// 空闲连接超时时间（10分钟）</span><br>            config.setMaxLifetime(<span class="hljs-number">1800000</span>);          <span class="hljs-comment">// 连接最大生命周期（30分钟）</span><br><br>            <span class="hljs-comment">// MySQL 性能优化配置</span><br>            config.addDataSourceProperty(<span class="hljs-string">&quot;cachePrepStmts&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>            config.addDataSourceProperty(<span class="hljs-string">&quot;prepStmtCacheSize&quot;</span>, <span class="hljs-string">&quot;250&quot;</span>);<br>            config.addDataSourceProperty(<span class="hljs-string">&quot;prepStmtCacheSqlLimit&quot;</span>, <span class="hljs-string">&quot;2048&quot;</span>);<br><br>            dataSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HikariDataSource</span>(config);<br>        &#125;<br>        <span class="hljs-keyword">return</span> dataSource;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>使用<code>Hikari</code>创建一个数据库连接池, 并返回一个<code>HikariDataSource</code>对象。避免频繁创建数据库连接, 提高性能。并使用单例模式, 确保只有一个连接池实例。</p><h3 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.service;<br><br><span class="hljs-keyword">import</span> org.example.bean.Student;<br><span class="hljs-keyword">import</span> org.example.db.DataSourceServer;<br><br><span class="hljs-keyword">import</span> java.sql.Connection;<br><span class="hljs-keyword">import</span> java.sql.PreparedStatement;<br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentService</span> &#123;<br>    <span class="hljs-keyword">public</span> List&lt;Student&gt; <span class="hljs-title function_">listAll</span><span class="hljs-params">()</span> &#123;<br>        List&lt;Student&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> DataSourceServer.getDataSource().getConnection()) &#123;<br>            <span class="hljs-keyword">try</span> (<span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">statement</span> <span class="hljs-operator">=</span> connection.prepareStatement(<span class="hljs-string">&quot;SELECT * FROM students&quot;</span>)) &#123;<br>                <span class="hljs-keyword">try</span> (<span class="hljs-type">ResultSet</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span> statement.executeQuery()) &#123;<br>                    <span class="hljs-keyword">while</span> (resultSet.next()) &#123;<br>                        <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>                        student.setId(resultSet.getInt(<span class="hljs-string">&quot;id&quot;</span>));<br>                        student.setName(resultSet.getString(<span class="hljs-string">&quot;name&quot;</span>));<br>                        student.setGender(resultSet.getInt(<span class="hljs-string">&quot;gender&quot;</span>));<br>                        student.setGrade(resultSet.getInt(<span class="hljs-string">&quot;grade&quot;</span>));<br>                        student.setScore(resultSet.getDouble(<span class="hljs-string">&quot;score&quot;</span>));<br>                        list.add(student);<br>                    &#125;<br>                    <span class="hljs-keyword">return</span> list;<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Student <span class="hljs-title function_">getByName</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>();<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> DataSourceServer.getDataSource().getConnection()) &#123;<br>            <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span>  connection.prepareStatement(<span class="hljs-string">&quot;SELECT * FROM students WHERE name = ? LIMIT 1&quot;</span>);<br>            ps.setString(<span class="hljs-number">1</span>, name);<br>            <span class="hljs-keyword">try</span> (<span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> ps.executeQuery()) &#123;<br>                <span class="hljs-keyword">while</span> (rs.next()) &#123;<br>                    student.setId(rs.getInt(<span class="hljs-string">&quot;id&quot;</span>));<br>                    student.setName(rs.getString(<span class="hljs-string">&quot;name&quot;</span>));<br>                    student.setGender(rs.getInt(<span class="hljs-string">&quot;gender&quot;</span>));<br>                    student.setGrade(rs.getInt(<span class="hljs-string">&quot;grade&quot;</span>));<br>                    student.setScore(rs.getDouble(<span class="hljs-string">&quot;score&quot;</span>));<br>                &#125;<br>                System.out.println(student);<br>                <span class="hljs-keyword">return</span> student;<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>实现两个查询<code>students</code>表的方法, 一个是查询所有学生, 一个是根据姓名查询学生。</p><h3 id="处理查询结果"><a href="#处理查询结果" class="headerlink" title="处理查询结果"></a>处理查询结果</h3><p>查询结果的处理在 <code>service</code> 包中, 主要是将数据库查询结果转换为 <code>Student</code> 对象。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example.servlet;<br><br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> jakarta.servlet.ServletException;<br><span class="hljs-keyword">import</span> jakarta.servlet.annotation.WebServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServlet;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletRequest;<br><span class="hljs-keyword">import</span> jakarta.servlet.http.HttpServletResponse;<br><span class="hljs-keyword">import</span> org.example.bean.Student;<br><span class="hljs-keyword">import</span> org.example.service.StudentService;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><br><span class="hljs-meta">@WebServlet(urlPatterns = &quot;/SearchStudent&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HttpServlet</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        req.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        resp.setCharacterEncoding(<span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        resp.setContentType(<span class="hljs-string">&quot;application/json;charset=UTF-8&quot;</span>);<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> req.getParameter(<span class="hljs-string">&quot;name&quot;</span>);<br><br>        <span class="hljs-type">StudentService</span> <span class="hljs-variable">studentService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StudentService</span>();<br>        <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> studentService.getByName(name);<br>        <span class="hljs-keyword">if</span> (student.getId() != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>            resp.getWriter().write(mapper.writeValueAsString(student));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            resp.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);<br>            resp.getWriter().write(<span class="hljs-string">&quot;&#123;\&quot;error\&quot;: \&quot;服务器处理请求时发生错误\&quot;&#125;&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="渲染Jsp页面"><a href="#渲染Jsp页面" class="headerlink" title="渲染Jsp页面"></a>渲染Jsp页面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs html">&lt;%--<br>  Created by IntelliJ IDEA.<br>  User: stanlee<br>  Date: 2025/12/4<br>--%&gt;<br>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;<br>&lt;%@ page import=&quot;org.example.service.StudentService&quot; %&gt;<br>&lt;%@ page import=&quot;org.example.bean.Student&quot; %&gt;`<br>&lt;%@ page import=&quot;java.util.List&quot; %&gt;<br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span><br>        Hello<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>你好<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>编号<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>姓名<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>性别<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>年级<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>分数<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        &lt;%<br>            StudentService ss = new StudentService();<br>            List<span class="hljs-tag">&lt;<span class="hljs-name">Student</span>&gt;</span> list = ss.listAll();<br>            for (Student s : list) &#123;<br>        %&gt;<br>            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;%= s.getId()%&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;%= s.getName()%&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;%= s.getGender()%&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;%= s.getGrade()%&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&lt;%= s.getScore()%&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br>        &lt;%<br>            &#125;<br>        %&gt;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;nameInput&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;submitBtn&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-left: 10px;&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;search()&quot;</span>&gt;</span>搜索<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;resultArea&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://code.jquery.com/jquery-3.6.0.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">search</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">    <span class="hljs-keyword">const</span> name = $(<span class="hljs-string">&quot;#nameInput&quot;</span>).<span class="hljs-title function_">val</span>();</span><br><span class="language-javascript">    $.<span class="hljs-title function_">ajax</span>(&#123;</span><br><span class="language-javascript">        <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;GET&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;SearchStudent?name=&quot;</span> + name,</span><br><span class="language-javascript">        <span class="hljs-attr">dataType</span>: <span class="hljs-string">&quot;json&quot;</span>,</span><br><span class="language-javascript">        <span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">const</span> content = <span class="hljs-string">`&lt;span&gt;<span class="hljs-subst">$&#123;<span class="hljs-string">&quot;$&#123;res.name&#125;&quot;</span>&#125;</span>的分数是<span class="hljs-subst">$&#123;<span class="hljs-string">&quot;$&#123;res.score&#125;&quot;</span>&#125;</span>&lt;/span&gt;`</span></span><br><span class="language-javascript">            $(<span class="hljs-string">&quot;#resultArea&quot;</span>).<span class="hljs-title function_">html</span>(content)</span><br><span class="language-javascript">        &#125;,</span><br><span class="language-javascript">        <span class="hljs-attr">error</span>: <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;)</span><br><span class="language-javascript">&#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>需要注意的是Jsp中没法正常使用es6的模板字符串, Jsp会将${}解析为El标签,所以需要添加””，</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>$&#123;&quot;$&#123;res.name&#125;&quot;&#125;的分数是$&#123;&quot;$&#123;res.score&#125;&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br></code></pre></td></tr></table></figure><p>类似这样.</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过重新实现Jsp以及Servlet的远程请求, 对于Java的MVC架构有了更深一步的认识和了解, 也更加熟悉了Java的Web开发流程，了解了其工作运行的原理。</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>servlet</tag>
      
      <tag>jsp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习记录(6) - 数据库连接</title>
    <link href="/2025/11/27/java-study-6/"/>
    <url>/2025/11/27/java-study-6/</url>
    
    <content type="html"><![CDATA[<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.47<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><code>指定mysql的连接器jar包的范围在运行时，因为在编译时不需要使用到mysql的连接器jar包。</code></p><h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><span class="hljs-keyword">import</span> java.sql.*;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataBaseConnect</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">JDBC_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/learnjdbc?useSSL=false&amp;characterEncoding=utf8&amp;allowPublicKeyRetrieval=true&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">USER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;username&quot;</span>; <span class="hljs-comment">// 数据库用户名</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">PASSWORD</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;*******&quot;</span>; <span class="hljs-comment">// 数据库用户密码</span><br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">Connection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> DriverManager.getConnection(JDBC_URL, USER, PASSWORD)) &#123;<br>            <span class="hljs-keyword">try</span> (<span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">preparedStatement</span> <span class="hljs-operator">=</span> connection.prepareStatement(<span class="hljs-string">&quot;select id, name, grade from students where gender = ? and grade = ?&quot;</span>)) &#123;<br>                preparedStatement.setObject(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>                preparedStatement.setObject(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br>                <span class="hljs-keyword">try</span> (<span class="hljs-type">ResultSet</span> <span class="hljs-variable">resultSet</span> <span class="hljs-operator">=</span> preparedStatement.executeQuery()) &#123;<br>                    <span class="hljs-keyword">while</span> (resultSet.next()) &#123;<br>                        <span class="hljs-type">long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> resultSet.getLong(<span class="hljs-string">&quot;id&quot;</span>);<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> resultSet.getString(<span class="hljs-string">&quot;name&quot;</span>);<br>                        <span class="hljs-type">int</span> <span class="hljs-variable">grade</span> <span class="hljs-operator">=</span> resultSet.getInt(<span class="hljs-string">&quot;grade&quot;</span>);<br>                        System.out.println(id + <span class="hljs-string">&quot; &quot;</span> + name + <span class="hljs-string">&quot; &quot;</span> + grade);<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">try</span> (<span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps2</span> <span class="hljs-operator">=</span> connection.prepareStatement(<span class="hljs-string">&quot;insert into students (name, grade, gender, score) values (?, ?, ?, ?)&quot;</span>)) &#123;<br>                ps2.setObject(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Stan&quot;</span>);<br>                ps2.setObject(<span class="hljs-number">2</span>, <span class="hljs-number">99</span>);<br>                ps2.setObject(<span class="hljs-number">3</span>, <span class="hljs-number">1</span>);<br>                ps2.setObject(<span class="hljs-number">4</span>, <span class="hljs-number">199</span>);<br>                ps2.executeUpdate();<br>            &#125;<br><br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul><li>数据库连接的URL格式为：<code>jdbc:mysql://主机名:端口号/数据库名?参数1=值1&amp;参数2=值2&amp;...</code></li><li>连接数据库时需要提供用户名和密码，用户名和密码在数据库中配置。</li><li>连接数据库后，需要使用<code>PreparedStatement</code>对象执行SQL语句，<code>ResultSet</code>对象接收查询结果。</li><li>执行完SQL语句后，需要关闭<code>PreparedStatement</code>和<code>ResultSet</code>对象，以及<code>Connection</code>对象。</li></ul><p><code>需要特别注意的是，Statement对象也是执行Sql语句的，但是存在sql注入的风险，所以在实际开发中，应该使用PreparedStatement对象来执行Sql语句。PreparedStatement对象可以防止sql注入攻击，因为它会自动对参数进行转义。</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>mysql</tag>
      
      <tag>java</tag>
      
      <tag>jdbc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习记录(5) -  Http编程</title>
    <link href="/2025/11/26/java-study-5/"/>
    <url>/2025/11/26/java-study-5/</url>
    
    <content type="html"><![CDATA[<h3 id="通过学习Http编程，更清晰的了解Java实现网络通信的底层逻辑与实现。"><a href="#通过学习Http编程，更清晰的了解Java实现网络通信的底层逻辑与实现。" class="headerlink" title="通过学习Http编程，更清晰的了解Java实现网络通信的底层逻辑与实现。"></a>通过学习Http编程，更清晰的了解Java实现网络通信的底层逻辑与实现。</h3><h3 id="Server端"><a href="#Server端" class="headerlink" title="Server端"></a>Server端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.net.ServerSocket;<br><span class="hljs-keyword">import</span> java.net.Socket;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServerCase</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ServerCase.class);<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">ServerSocket</span> <span class="hljs-variable">serverSocket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerSocket</span>(<span class="hljs-number">6666</span>)) &#123;<br>            log.info(<span class="hljs-string">&quot;服务已启动&quot;</span>);<br>            <span class="hljs-keyword">for</span> (;;) &#123;<br>                <span class="hljs-type">Socket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> serverSocket.accept();<br>                log.info(<span class="hljs-string">&quot;connect from =&quot;</span>+socket.getRemoteSocketAddress());<br>                <span class="hljs-type">Thread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(socket);<br>                thread.start();<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Handler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(Handler.class);<br><br>    <span class="hljs-keyword">private</span> Socket socket;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Handler</span><span class="hljs-params">(Socket socket)</span> &#123;<br>        <span class="hljs-built_in">this</span>.socket = socket;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.socket.getInputStream()) &#123;<br>            <span class="hljs-keyword">try</span> (<span class="hljs-type">OutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.socket.getOutputStream()) &#123;<br>                handle(inputStream, outputStream);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-built_in">this</span>.socket.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException ex) &#123;<br><br>            &#125;<br>            log.error(<span class="hljs-string">&quot;client disconnected&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span> <span class="hljs-params">(InputStream inputStream, OutputStream outputStream)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">var</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedWriter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OutputStreamWriter</span>(outputStream, StandardCharsets.UTF_8));<br>        <span class="hljs-type">var</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream, StandardCharsets.UTF_8));<br>        writer.write(<span class="hljs-string">&quot;Hello\n&quot;</span>);<br>        writer.flush();<br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">line</span> <span class="hljs-operator">=</span> reader.readLine();<br>            log.info(<span class="hljs-string">&quot;client say:&quot;</span> + line);<br>            <span class="hljs-keyword">if</span> (line.equals(<span class="hljs-string">&quot;bye&quot;</span>)) &#123;<br>                writer.write(<span class="hljs-string">&quot;bye\n&quot;</span>);<br>                writer.flush();<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            writer.write(<span class="hljs-string">&quot;yes\n&quot;</span>);<br>            writer.flush();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="Client端"><a href="#Client端" class="headerlink" title="Client端"></a>Client端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><br><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.net.Socket;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.util.Scanner;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClientCase</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ClientCase.class);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">Socket</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Socket</span>(<span class="hljs-string">&quot;localhost&quot;</span>, <span class="hljs-number">6666</span>)) &#123;<br>            log.info(<span class="hljs-string">&quot;connect from =&quot;</span> + socket.getRemoteSocketAddress());<br>            <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> socket.getInputStream();<br>                 <span class="hljs-type">OutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> socket.getOutputStream()) &#123;<br>                handle(inputStream, outputStream);<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123; <span class="hljs-comment">// Socket的异常在这里捕获</span><br>            log.error(<span class="hljs-string">&quot;Error during communication&quot;</span>, e);<br>        &#125;<br>        log.info(<span class="hljs-string">&quot;socket closed&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">(InputStream inputStream, OutputStream outputStream)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">var</span> <span class="hljs-variable">writer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedWriter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OutputStreamWriter</span>(outputStream, StandardCharsets.UTF_8));<br>        <span class="hljs-type">var</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(inputStream, StandardCharsets.UTF_8));<br>        log.info(<span class="hljs-string">&quot;server say=&quot;</span> + reader.readLine());<br>        <span class="hljs-type">Scanner</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scanner</span>(System.in);<br>        <span class="hljs-keyword">for</span>  (;;) &#123;<br>            log.info(<span class="hljs-string">&quot;&gt;&gt;&gt;&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> scanner.nextLine();<br>            writer.write(s);<br>            writer.newLine();<br>            writer.flush();<br><br>            <span class="hljs-type">var</span> <span class="hljs-variable">line</span> <span class="hljs-operator">=</span> reader.readLine();<br>            log.info(<span class="hljs-string">&quot;&lt;&lt;&lt;&quot;</span> + line);<br>            <span class="hljs-keyword">if</span> (line.equals(<span class="hljs-string">&quot;bye&quot;</span>)) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>总得来说，Java的网络通信通过Socket实现，Server端监听指定端口，Client端连接到Server端的端口，双方通过输入输出流进行通信。<br>需要特别注意的是，当利用<code>BufferedWriter</code>进行写入操作时，写完之后一定要跟上换行符 <code>\n</code>, 否则输入输出流会一直等待，这个小问题卡了我不少时间ORZ。</p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>http</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习记录(4) - 邮件发送以及查看</title>
    <link href="/2025/11/25/java-study-4/"/>
    <url>/2025/11/25/java-study-4/</url>
    
    <content type="html"><![CDATA[<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>jakarta.mail<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jakarta.mail-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.sun.mail<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jakarta.mail<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p><code>通过添加这两个Maven依赖，就可以在Java项目中使用Jakarta Mail API来发送和接收邮件了。</code></p><h3 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> jakarta.mail.*;<br><span class="hljs-keyword">import</span> jakarta.mail.internet.InternetAddress;<br><span class="hljs-keyword">import</span> jakarta.mail.internet.MimeMessage;<br><br><span class="hljs-keyword">import</span> java.util.Properties;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MailSender</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">smtp</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;smtp.qq.com&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;542762411@qq.com&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;***************&quot;</span>; <span class="hljs-comment">// 在qq邮箱安全设置处获取到的授权码</span><br>        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>        props.put(<span class="hljs-string">&quot;mail.transport.protocol&quot;</span>, <span class="hljs-string">&quot;smtp&quot;</span>);<br>        props.put(<span class="hljs-string">&quot;mail.smtp.host&quot;</span>, smtp);<br>        props.put(<span class="hljs-string">&quot;mail.smtp.port&quot;</span>, <span class="hljs-number">465</span>);<br>        props.put(<span class="hljs-string">&quot;mail.smtp.auth&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>        props.put(<span class="hljs-string">&quot;mail.smtp.starttls.enable&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>        props.put(<span class="hljs-string">&quot;mail.smtp.ssl.enable&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>);<br>        props.put(<span class="hljs-string">&quot;mail.smtp.ssl.protocols&quot;</span>, <span class="hljs-string">&quot;TLSv1.2&quot;</span>); <span class="hljs-comment">// 指定SSL版本</span><br>        props.put(<span class="hljs-string">&quot;mail.smtp.socketFactory.class&quot;</span>, <span class="hljs-string">&quot;javax.net.ssl.SSLSocketFactory&quot;</span>);<br>        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> Session.getInstance(props, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Authenticator</span>() &#123;<br>           <span class="hljs-keyword">protected</span> PasswordAuthentication <span class="hljs-title function_">getPasswordAuthentication</span><span class="hljs-params">()</span> &#123;<br>               <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PasswordAuthentication</span>(username, password);<br>           &#125;<br>        &#125;);<br>        session.setDebug(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">MimeMessage</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MimeMessage</span>(session);<br>        <span class="hljs-keyword">try</span> &#123;<br>            message.setFrom(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InternetAddress</span>(username));<br>            message.setRecipients(Message.RecipientType.TO, InternetAddress.parse(<span class="hljs-string">&quot;stanlee1226@gmail.com&quot;</span>));<br>            message.setSubject(<span class="hljs-string">&quot;Hello，this is stan‘s qq&quot;</span>);<br>            message.setText(<span class="hljs-string">&quot;我是Stan lee的qq&quot;</span>, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>            Transport.send(message);<br>        &#125; <span class="hljs-keyword">catch</span> (MessagingException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="查看邮箱"><a href="#查看邮箱" class="headerlink" title="查看邮箱"></a>查看邮箱</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> com.sun.mail.pop3.POP3SSLStore;<br><span class="hljs-keyword">import</span> jakarta.mail.*;<br><span class="hljs-keyword">import</span> org.slf4j.Logger;<br><span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<br><br><span class="hljs-keyword">import</span> java.util.Properties;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MailReader</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(MailReader.class);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">host</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;imap.qq.com&quot;</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">port</span> <span class="hljs-operator">=</span> <span class="hljs-number">993</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;542762411@qq.com&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;***************&quot;</span>; <span class="hljs-comment">// 在qq邮箱安全设置处获取到的授权码</span><br><br>        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>        props.setProperty(<span class="hljs-string">&quot;mail.store.protocol&quot;</span>, <span class="hljs-string">&quot;imap&quot;</span>); <span class="hljs-comment">// 使用IMAP协议</span><br>        props.setProperty(<span class="hljs-string">&quot;mail.imap.host&quot;</span>, host); <span class="hljs-comment">// QQ邮箱IMAP服务器地址</span><br>        props.setProperty(<span class="hljs-string">&quot;mail.imap.port&quot;</span>, port + <span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// SSL端口</span><br>        props.setProperty(<span class="hljs-string">&quot;mail.imap.ssl.enable&quot;</span>, <span class="hljs-string">&quot;true&quot;</span>); <span class="hljs-comment">// 启用SSL加密</span><br>        props.setProperty(<span class="hljs-string">&quot;mail.imap.socketFactory.class&quot;</span>, <span class="hljs-string">&quot;javax.net.ssl.SSLSocketFactory&quot;</span>); <span class="hljs-comment">// SSL Socket工厂类</span><br><br>        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> Session.getInstance(props, <span class="hljs-literal">null</span>);<br>        session.setDebug(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">Store</span> <span class="hljs-variable">store</span> <span class="hljs-operator">=</span> session.getStore(<span class="hljs-string">&quot;imap&quot;</span>)) &#123;<br>            store.connect(<span class="hljs-string">&quot;imap.qq.com&quot;</span>, username, password);<br>            <span class="hljs-type">Folder</span> <span class="hljs-variable">folder</span> <span class="hljs-operator">=</span> store.getFolder(<span class="hljs-string">&quot;INBOX&quot;</span>);<br>            folder.open(Folder.READ_WRITE);<br><br>            log.info(<span class="hljs-string">&quot;Inbox opened:&quot;</span> + folder.getFullName());<br>            log.info(<span class="hljs-string">&quot;Inbox size: &quot;</span> + folder.getMessageCount());<br>            log.info(<span class="hljs-string">&quot;Unread:&quot;</span> + folder.getUnreadMessageCount());<br>            log.info(<span class="hljs-string">&quot;新邮件:&quot;</span> + folder.getNewMessageCount());<br>        &#125; <span class="hljs-keyword">catch</span> (MessagingException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>邮件</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习记录(3) - 文件流</title>
    <link href="/2025/11/24/java-study-3/"/>
    <url>/2025/11/24/java-study-3/</url>
    
    <content type="html"><![CDATA[<h3 id="InputStream与OutputStream"><a href="#InputStream与OutputStream" class="headerlink" title="InputStream与OutputStream"></a>InputStream与OutputStream</h3><p>Java是一种面向对象的编程语言，它提供了丰富的类库来处理文件流。文件流是指将文件中的数据读取到内存中或将内存中的数据写入到文件中的操作。</p><p>在Java中，文件流主要分为两种类型：输入流（InputStream）和输出流（OutputStream）。输入流用于从文件中读取数据，而输出流用于将数据写入到文件中。</p><p>Java提供了多个类来实现文件流的操作，例如FileInputStream、FileOutputStream、BufferedInputStream、BufferedOutputStream等。这些类都实现了InputStream和OutputStream接口，提供了不同的读写方式和缓冲区大小。</p><p>通过使用文件流，我们可以方便地读取和写入文件中的数据。例如，我们可以使用FileInputStream来读取文件中的字节数据，使用FileOutputStream来写入字节数据到文件中。</p><h3 id="示例-文件读取"><a href="#示例-文件读取" class="headerlink" title="示例 - 文件读取"></a>示例 - 文件读取</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test8</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">InputStream</span> <span class="hljs-variable">is</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;/Users/stanlee/work/chart.json&quot;</span>);<br>            <span class="hljs-type">InputStreamReader</span> <span class="hljs-variable">isr</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(is, <span class="hljs-string">&quot;utf-8&quot;</span>);<br>            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">br</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(isr);<br>        ) &#123;<br>            String line;<br>            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>            <span class="hljs-keyword">while</span> ((line = br.readLine()) != <span class="hljs-literal">null</span>) &#123;<br>                sb.append(line);<br>            &#125;<br>            log.info(sb.toString());<br>        &#125; <span class="hljs-keyword">catch</span> (FileNotFoundException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="示例-文件复制"><a href="#示例-文件复制" class="headerlink" title="示例 - 文件复制"></a>示例 - 文件复制</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test9</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span>(<span class="hljs-type">InputStream</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">&quot;/Users/stanlee/work/chart.json&quot;</span>);<br>            <span class="hljs-type">OutputStream</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;/Users/stanlee/work/chart-copy.json&quot;</span>);<br>        ) &#123;<br>            input.transferTo(output);<br>            output.flush();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>文件流</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习记录(2) - 注解、反射、泛型</title>
    <link href="/2025/11/22/java-study-2/"/>
    <url>/2025/11/22/java-study-2/</url>
    
    <content type="html"><![CDATA[<h3 id="我理解注解是Java的一种元数据，它可以在编译时或运行时被读取和处理。注解可以用于类、方法、字段等元素上，用于添加额外的信息或行为。简化代码，方便一些逻辑判断操作。"><a href="#我理解注解是Java的一种元数据，它可以在编译时或运行时被读取和处理。注解可以用于类、方法、字段等元素上，用于添加额外的信息或行为。简化代码，方便一些逻辑判断操作。" class="headerlink" title="我理解注解是Java的一种元数据，它可以在编译时或运行时被读取和处理。注解可以用于类、方法、字段等元素上，用于添加额外的信息或行为。简化代码，方便一些逻辑判断操作。"></a>我理解注解是Java的一种元数据，它可以在编译时或运行时被读取和处理。注解可以用于类、方法、字段等元素上，用于添加额外的信息或行为。简化代码，方便一些逻辑判断操作。</h3><h3 id="而写好注解的基础就在于Java反射与泛型的的机制，利用反射可以在运行时动态获取类的信息，包括注解。而泛型则可以在编译时检查类型错误，避免在运行时出现类型转换异常。"><a href="#而写好注解的基础就在于Java反射与泛型的的机制，利用反射可以在运行时动态获取类的信息，包括注解。而泛型则可以在编译时检查类型错误，避免在运行时出现类型转换异常。" class="headerlink" title="而写好注解的基础就在于Java反射与泛型的的机制，利用反射可以在运行时动态获取类的信息，包括注解。而泛型则可以在编译时检查类型错误，避免在运行时出现类型转换异常。"></a>而写好注解的基础就在于Java反射与泛型的的机制，利用反射可以在运行时动态获取类的信息，包括注解。而泛型则可以在编译时检查类型错误，避免在运行时出现类型转换异常。</h3><h3 id="贴上我的练习代码"><a href="#贴上我的练习代码" class="headerlink" title="贴上我的练习代码"></a>贴上我的练习代码</h3><h3 id="定义注解，注解本质上是一个interface"><a href="#定义注解，注解本质上是一个interface" class="headerlink" title="定义注解，注解本质上是一个interface"></a>定义注解，注解本质上是一个interface</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.FIELD)</span> <span class="hljs-comment">// 表示检测字段</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Range &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">min</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">max</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">255</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="定义一个类，使用注解"><a href="#定义一个类，使用注解" class="headerlink" title="定义一个类，使用注解"></a>定义一个类，使用注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestClass</span> &#123;<br>    <span class="hljs-meta">@Range(min = 10, max = 20)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="添加注解的处理逻辑"><a href="#添加注解的处理逻辑" class="headerlink" title="添加注解的处理逻辑"></a>添加注解的处理逻辑</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">check</span><span class="hljs-params">(Object o)</span> <span class="hljs-keyword">throws</span> IllegalAccessException &#123;<br>        <span class="hljs-keyword">for</span> (Field field : o.getClass().getDeclaredFields()) &#123;<br>            <span class="hljs-type">Range</span> <span class="hljs-variable">range</span> <span class="hljs-operator">=</span> field.getAnnotation(Range.class);<br>            <span class="hljs-keyword">if</span> (range != <span class="hljs-literal">null</span>) &#123;<br>                field.setAccessible(<span class="hljs-literal">true</span>);<br>                <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> field.get(o);<br>                <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> String) &#123;<br>                    <span class="hljs-keyword">if</span> (((String) value).length() &lt; range.min() || ((String) value).length() &gt; range.max()) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;参数长度不符:&quot;</span> + field.getName() + <span class="hljs-string">&quot;长度是:&quot;</span> + (((String) value).length()));<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> Integer) &#123;<br>                    <span class="hljs-keyword">if</span> ((Integer) value &lt; range.min() || (Integer) value &gt; range.max()) &#123;<br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;参数值不符:&quot;</span> + field.getName() + <span class="hljs-string">&quot;值大小为:&quot;</span> + ((Integer) value));<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure><h3 id="测试注解"><a href="#测试注解" class="headerlink" title="测试注解"></a>测试注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCheck</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IllegalAccessException &#123;<br>    <span class="hljs-type">TestClass</span> <span class="hljs-variable">testClass</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestClass</span>();<br>    testClass.setAge(<span class="hljs-number">15</span>);<br>    check(testClass);<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>反射</tag>
      
      <tag>泛型</tag>
      
      <tag>注解</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习记录(1) - 类与接口</title>
    <link href="/2025/11/20/java-study-1/"/>
    <url>/2025/11/20/java-study-1/</url>
    
    <content type="html"><![CDATA[<h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><p>类是Java中最基本的单位，它是一种用户自定义的数据类型，用于描述对象的属性和行为。类可以包含字段（属性）和方法（行为）。</p><h2 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h2><p>抽象类是一种不能被实例化的类，它只能被继承。抽象类可以包含抽象方法（没有实现的方法）和非抽象方法（有实现的方法）。</p><h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>接口是一种抽象类型，它定义了一组方法的签名，但没有提供实现。接口可以被类实现，从而实现多态。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><code>以前上学的时候对这三个一知半解，似懂非懂的，最近潜下心来学习了一番。总结一下自己的理解吧：</code><br><code>类是一种对事物的抽象, 有具体的属性以及实现的方法。而抽象类则是对类的抽象, 它不能被实例化, 只能被继承。而且方法不会被实现。而接口则是对行为的抽象, 它定义了一组方法的签名, 但没有提供实现。接口可以被类实现, 从而实现多态。</code><br><code>简单通俗的讲就是抽象类以及接口相当于是类的规范, 定义了类应该有的属性和方法, 而具体的实现则由子类或者实现类来完成。</code></p>]]></content>
    
    
    
    <tags>
      
      <tag>java</tag>
      
      <tag>class</tag>
      
      <tag>interface</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue3 中结合地图组件渲染InfoWindow</title>
    <link href="/2025/09/02/info-window/"/>
    <url>/2025/09/02/info-window/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前端开发使用到地图组件的时候，难免要使用到<code>InfoWindow</code>, 但是在使用的过程中，发现<code>InfoWindow</code>的内容不能直接渲染<code>vue</code>组件，所以就有了这篇文章。<br>只能通过原生的<code>html</code>文本进行渲染，而且事件绑定还有起的麻烦，在<code>vue2</code>中得将事件绑定到 <code>window</code> 的全局对象下，才得以调用。所以研究发现了 <code>vue3</code> 的一个特性，可以通过 <code>vnode</code> 来渲染<code>vue</code>组件。<br>话不多说，进入使用环节.</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><ol><li><p>先创建一个<code>vue</code>组件，用来渲染<code>InfoWindow</code>的内容。<br> <code>InfoWindow.vue</code></p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs javascript">&lt;template&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;w-300px bg-[#303133]&quot;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;flex flex-col p-x-20px&quot;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;font-bold text-20px color-#009e5c&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;handleClick(&#x27;info&#x27;)&quot;</span>&gt;</span></span><br><span class="language-xml">            这是InfoWindow</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>&lt;/template&gt;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;ts&quot;</span> <span class="hljs-attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>(&#123;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-attr">data</span>: &#123;</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,</span></span><br><span class="language-javascript"><span class="language-xml">    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> (&#123;&#125;)</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml">&#125;)</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> emit = <span class="hljs-title function_">defineEmits</span>([<span class="hljs-string">&#x27;click&#x27;</span>])</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params">type: string</span>) =&gt; &#123;</span></span><br><span class="language-javascript"><span class="language-xml"><span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;click&#x27;</span>, type)</span></span><br><span class="language-javascript"><span class="language-xml">&#125;</span></span><br><span class="language-javascript"><span class="language-xml"></span></span><br><span class="language-javascript"><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;scss&quot;</span> <span class="hljs-attr">scoped</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p> 可以看到，这是一个标准的<code>Vue3</code>组件，包含数据<code>data</code> 以及 回调事件 <code>click</code></p></li><li><p>在<code>InfoWindow</code>的<code>content</code>中，使用<code>vnode</code>来渲染<code>vue</code>组件。</p><p> <code>index.vue</code></p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createVNode, render &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">InfoWindow</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./InfoWindow.vue&#x27;</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">showInfoWindow</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> vnode = <span class="hljs-title function_">createVNode</span>(<span class="hljs-title class_">InfoWindow</span>, &#123; landData, <span class="hljs-attr">onClick</span>: handleClick &#125;)<br>    <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>);<br>    <span class="hljs-title function_">render</span>(vnode, container)<br>    mapRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">showInfoWindow</span>(vnode.<span class="hljs-property">el</span>, lnglat)<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params">type: string</span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(type)<br>&#125;<br></code></pre></td></tr></table></figure><p> 可以看到，我们使用 <code>Vue</code> 提供的 <code>createVNode</code> 方法以及 <code>render</code> 方法来渲染<code>vue</code>组件。<br> <code>createVNode</code> 方法用来创建<code>vnode</code>，第一个参数传入封装的组件，第二个参数传入组件的属性, 需要注意的是 回调事件前需要加 <code>on</code>。<br> <code>render</code> 方法用来渲染<code>vnode</code>，第一个参数传入<code>vnode</code>，第二个参数传入<code>dom</code>节点。<br> 可以看到，我们创建了一个<code>div</code>节点，用来作为<code>InfoWindow</code>的<code>content</code>，并将<code>vnode</code>渲染到这个<code>div</code>节点中。<br> 最后将这个<code>div</code>节点作为<code>InfoWindow</code>的<code>content</code>传入<code>mapRef.value.showInfoWindow</code>方法中。<br> 即可渲染成功。</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>vue3</tag>
      
      <tag>天地图</tag>
      
      <tag>infoWindow</tag>
      
      <tag>地图</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Let&#39;s Encrypt Certbot 自动申请免费 SSL 证书，并自动续费</title>
    <link href="/2025/06/30/certbot-ssl/"/>
    <url>/2025/06/30/certbot-ssl/</url>
    
    <content type="html"><![CDATA[<h2 id="1-环境以及版本"><a href="#1-环境以及版本" class="headerlink" title="1. 环境以及版本"></a>1. 环境以及版本</h2><table><thead><tr><th>配置</th><th>-版本-</th></tr></thead><tbody><tr><td>CentOS</td><td>7.9.2009</td></tr><tr><td>certbot</td><td>4.1.1</td></tr><tr><td>nginx</td><td>1.26.1</td></tr><tr><td>python</td><td>2.7.5</td></tr></tbody></table><h2 id="2-安装snap"><a href="#2-安装snap" class="headerlink" title="2. 安装snap"></a>2. 安装snap</h2><p>Let’s Encrypt 官方推荐的是使用snap进行安装，所以我们需要先安装snap</p><h3 id="2-1-先安装-EPEL"><a href="#2-1-先安装-EPEL" class="headerlink" title="2.1 先安装 EPEL"></a>2.1 先安装 <code>EPEL</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install -y epel-release<br></code></pre></td></tr></table></figure><h3 id="2-2-安装snap"><a href="#2-2-安装snap" class="headerlink" title="2.2 安装snap"></a>2.2 安装snap</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">yum install snapd<br></code></pre></td></tr></table></figure><h3 id="2-3-启动snap服务"><a href="#2-3-启动snap服务" class="headerlink" title="2.3 启动snap服务"></a>2.3 启动snap服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> --now snapd.socket<br><span class="hljs-built_in">ln</span> -s /var/lib/snapd/snap /snap<br></code></pre></td></tr></table></figure><h3 id="2-4-安装certbot-snap包"><a href="#2-4-安装certbot-snap包" class="headerlink" title="2.4 安装certbot snap包"></a>2.4 安装certbot snap包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">snap install core; snap refresh core<br>snap install --classic certbot<br></code></pre></td></tr></table></figure><h3 id="2-5-软链接certbot命令"><a href="#2-5-软链接certbot命令" class="headerlink" title="2.5 软链接certbot命令"></a>2.5 软链接certbot命令</h3><p>设置<code>certbot</code>命令软连接，确保<code>certbot</code>命令能够执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -s /snap/bin/certbot /usr/bin/certbot<br></code></pre></td></tr></table></figure><h2 id="3-申请证书"><a href="#3-申请证书" class="headerlink" title="3. 申请证书"></a>3. 申请证书</h2><p>certbot的自动化非常方便，只需要一行命令即可完成证书的申请和续签，非常的方便。<br>我们这里只考虑使用<code>nginx</code>作为web代理的情况</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">certbot --nginx<br></code></pre></td></tr></table></figure><p>执行上述命令之后，会提示输入邮箱，邮箱用于接收证书过期的通知。<br>然后<code>certbot</code>会自动扫描你的<code>nginx</code>配置文件，找到所有的<code>server</code>配置块，然后判断是否有<code>listen 80</code>或者<code>listen 443</code>的配置，如果有，就会自动申请证书。<br>同时，还会自动配置<code>nginx</code>的<code>ssl</code>证书，重启<code>nginx</code>服务即可生效。</p><p>等配置完成之后，可以打开<code>nginx</code>的配置文件查看<code>server</code>配置块内被certbot修改的内容,即已配置好<code>ssl</code></p><p><code>注意事项: 最开始我是使用的移动云服务器，certbot的自动化配置一直失败，卡在了请求本地部署的web服务的域名时一直超时，然后我在服务器上ping了一下本地部署的服务域名，发现并不能ping通，而通过其他的外部服务器是可以访问的</code><br><code>查询了下移动云的服务器因为一些默认配置导致本机是无法访问自己的你公网ip的，需要在云服务器控制台进行配置修改</code><br><code>之后我在自己的另外一台服务器上重试，是完全可行的，一套命令下来畅通无阻，顺利完成https配置</code></p><h2 id="4-自动续签"><a href="#4-自动续签" class="headerlink" title="4. 自动续签"></a>4. 自动续签</h2><p><code>certbot</code>默认有效期是三个月, 如果你想要啥它能自动续签，可以用到<code>linux</code>上的一个定时服务</p><h3 id="4-1-设置定时任务"><a href="#4-1-设置定时任务" class="headerlink" title="4.1 设置定时任务"></a>4.1 设置定时任务</h3><p>在<code>crontab</code>中添加定时任务，每天凌晨2点执行一次<code>certbot</code>的续签命令</p><p>执行<code>crontab</code>的编辑命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">crontab -e<br></code></pre></td></tr></table></figure><p>在打开的编辑器中添加定时任务, 如下:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">0 2 * * * certbot renew --quiet --nginx<br></code></pre></td></tr></table></figure><p>这段代码的意思是 每天凌晨2点执行一次<code>certbot renew</code>命令, 对<code>nginx</code>的配置进行续签, <code>--quiet</code>参数表示静默模式, 不会有任何输出, <code>--nginx</code>参数表示对<code>nginx</code>的配置进行操作</p>]]></content>
    
    
    
    <tags>
      
      <tag>ssl</tag>
      
      <tag>certbot</tag>
      
      <tag>https</tag>
      
      <tag>centOS7</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker 部署 3.0.1 版本的nacos，并使用mysql作为数据库</title>
    <link href="/2025/06/20/docker-nacos/"/>
    <url>/2025/06/20/docker-nacos/</url>
    
    <content type="html"><![CDATA[<p>本文讲一下如何在docker中部署3.0.1版本的nacos，并使用mysql作为数据库。mysql是运行在主机中的，而nacos是运行在docker中的。所有操作均基于Mac OS。</p><h2 id="下载nacos"><a href="#下载nacos" class="headerlink" title="下载nacos"></a>下载nacos</h2><p>首先是拉取nocos的Docker镜像，运行 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull nacos/nacos-server:3.0.1<br></code></pre></td></tr></table></figure><h2 id="启动nacos"><a href="#启动nacos" class="headerlink" title="启动nacos"></a>启动nacos</h2><p>nacos 2.x 以上版本需要配置<code>NACOS_AUTH_TOKEN</code>，可以使用下面的命令生成<code>NACOS_AUTH_TOKEN</code>：<br>​​生成原始密钥​​（32+ 字符的随机字符串）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">openssl rand -base64 32 | tr -d &#x27;/+=&#x27; | cut -c1-32<br>echo $TOKEN<br></code></pre></td></tr></table></figure><p>示例输出：OQCiofvklDg15KV4dJxqzxkL9BITbMYB。</p><p>​​Base64 编码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo -n &quot;OQCiofvklDg15KV4dJxqzxkL9BITbMYB&quot; | base64 -w 0<br></code></pre></td></tr></table></figure><p>输出示例：T1FDaW9mdmtsRGcxNUtWNGRIeHF6eGtMOUJJVGJNWUI&#x3D;。</p><p>即可生成我们需要的<code>NACOS_AUTH_TOKEN</code>。</p><p>因为我们需要获取nacos的mysql脚本，所以我们需要先启动一个nacos的容器，然后从容器中获取脚本。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run --name nacos \<br>    -e MODE=standalone \<br>    -e NACOS_AUTH_TOKEN=T1FDaW9mdmtsRGcxNUtWNGRIeHF6eGtMOUJJVGJNWUI= \<br>    -e NACOS_AUTH_IDENTITY_KEY=nacos \<br>    -e NACOS_AUTH_IDENTITY_VALUE=nacos \<br>    -p 8080:8080 \ # 新版本的nacos的控制台地址变成了 127.0.0.1:8080/index.html<br>    -p 8848:8848 \<br>    -p 9848:9848 \<br>    -d nacos/nacos-server:latest<br></code></pre></td></tr></table></figure><h2 id="从nacos容器中获取mysql脚本"><a href="#从nacos容器中获取mysql脚本" class="headerlink" title="从nacos容器中获取mysql脚本"></a>从nacos容器中获取mysql脚本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker cp nacos:/home/nacos/conf/mysql-schema.sql .<br></code></pre></td></tr></table></figure><h2 id="创建nacos数据库"><a href="#创建nacos数据库" class="headerlink" title="创建nacos数据库"></a>创建nacos数据库</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mysql -h 127.0.0.1 -P 3306 -u root -p<br></code></pre></td></tr></table></figure><p>输入密码后，回车。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE DATABASE IF NOT EXISTS `nacos_test` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;<br></code></pre></td></tr></table></figure><h2 id="导入mysql脚本"><a href="#导入mysql脚本" class="headerlink" title="导入mysql脚本"></a>导入mysql脚本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mysql -h 127.0.0.1 -P 3306 -u root -p nacos_test &lt; mysql-schema.sql<br></code></pre></td></tr></table></figure><p>然后将之前启动的nacos docker服务停止并删除</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker stop nacos<br>docker rm nacos<br></code></pre></td></tr></table></figure><h2 id="重新启动nacos-并添加mysql参数"><a href="#重新启动nacos-并添加mysql参数" class="headerlink" title="重新启动nacos 并添加mysql参数"></a>重新启动nacos 并添加mysql参数</h2><p>修改docker启动命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -d \<br>  --name nacos \<br>  -p 8080:8080 \<br>  -p 8848:8848 \<br>  -p 9848:9848 \<br>  -e MODE=standalone \<br>  -e NACOS_AUTH_ENABLE=true \<br>  -e NACOS_AUTH_TOKEN=T1FDaW9mdmtsRGcxNUtWNGRIeHF6eGtMOUJJVGJNWUI= \<br>  -e NACOS_AUTH_IDENTITY_KEY=nacos \<br>  -e NACOS_AUTH_IDENTITY_VALUE=nacos \<br>-e SPRING_DATASOURCE_PLATFORM=mysql \<br>-e MYSQL_SERVICE_HOST=host.docker.internal \ # host.docker.internal表示主机的ip地址, 不用修改<br>-e MYSQL_SERVICE_PORT=3306 \<br>-e MYSQL_SERVICE_DB_NAME=nacos_test \<br>-e MYSQL_SERVICE_USER=root \<br>-e MYSQL_SERVICE_PASSWORD=$&#123;MYSQL_PASSWORD&#125; \<br>-e MYSQL_SERVICE_DB_PARAM=&quot;useSSL=false&amp;allowPublicKeyRetrieval=true&quot; \ # 连接mysql的参数，8.0以上不能通过密码直连，所以需要追加参数取消限制<br>  nacos/nacos-server:latest<br></code></pre></td></tr></table></figure><p>启动成功之后访问 <code>127.0.0.1:8080/index.html</code> 即可访问nacos</p><p>参考：</p><ul><li><a href="https://nacos.io/en/docs/latest/quickstart/quick-start-docker/">Nacos 3.0.1 版本安装部署</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>nacos</tag>
      
      <tag>mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>开发一个查询IP信息的MCP服务, 并通过Docker部署</title>
    <link href="/2025/04/24/mcp-server/"/>
    <url>/2025/04/24/mcp-server/</url>
    
    <content type="html"><![CDATA[<p>自从<code>MCP</code>的出现, 全球各个大厂争先恐后的出了很多自家的MCP服务，让开发者可以进行调用，并且<code>MCP</code>的<code>SDK</code>也越来越完善，也支持大部分的开发语言。</p><p>我就来研究一下使用 <code>TypeScript</code> 来写一个 <code>MCP</code> 服务，并且使用 <code>Docker</code> 来部署。(顺便了解一下docker的自动部署)</p><h2 id="MCP脚手架"><a href="#MCP脚手架" class="headerlink" title="MCP脚手架"></a>MCP脚手架</h2><p>有一天在搜 <code>MCP</code> 服务的时候，看到了一个  <code>mcp-framework</code> 的项目，这个项目是一个 <code>MCP</code> 服务的脚手架，它提供了一个 <code>MCP</code> 服务的基本框架，支持<code>MCP</code>项目的创建以及类文件的生成。这是一个基于 <code>TypeScript</code> 的项目，所以我就来研究一下它怎么使用。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>首先这是一个脚手架 <code>cli</code> 命令, 我们需要将它安装在全局，通过 <code>npm</code> 安装</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install -g mcp-framework<br><br><span class="hljs-comment"># 创建你的新项目</span><br>mcp create my-mcp-server<br><br><span class="hljs-comment"># 进入到项目根目录下</span><br><span class="hljs-built_in">cd</span> my-mcp-server<br><br><span class="hljs-comment"># 安装依赖</span><br>npm install<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">my-mcp-server/<br>├── src/<br>│   ├── tools/         <span class="hljs-comment"># Tools文件夹</span><br>│   │   └── ExampleTool.ts<br>│   └── index.ts       <span class="hljs-comment"># 文件主入口</span><br>├── package.json<br>└── tsconfig.json<br></code></pre></td></tr></table></figure><h2 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h2><p>通过命令行可以新建一个新的 <code>MCP Tool</code>, 顺便说一下，<code>MCP</code> 主要功能分为三个部分，<code>Tools</code>、 <code>Prompts</code>、 <code>Resources</code>。<br><code>Tools</code> 是提供可供<code>AI</code>调用的方法, <code>Prompts</code> 是给予 <code>AI</code> 对于自己系统的提示, <code>Resources</code> 是可以提供给<code>AI</code>的系统内部的一些资源。如果想要更深入的了解，可以到 <code>MCP</code> 的 <code>Github</code>仓库进行了解</p><p>我们就先开发一个最能直观体现<code>MCP</code>作用的<code>Tools</code>来进行举例吧。</p><h3 id="创建Tool文件"><a href="#创建Tool文件" class="headerlink" title="创建Tool文件"></a>创建Tool文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mcp add tool get-ip <br></code></pre></td></tr></table></figure><blockquote><p>我们来实现一个通过<code>AI</code> 结合 <code>MCP</code> 查询 <code>IP</code>信息的功能</p></blockquote><p>通过上面的命令，可以看到<code>/src/tools</code>文件下新新生成了一个名为<code>GetIpTool.ts</code>的文件，我们具体的功能要在该文件内进行编写。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">MCPTool</span>, logger &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;mcp-framework&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; z &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;zod&quot;</span>;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">GetIpInput</span> &#123;<br>  <span class="hljs-attr">ip</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GetIpTool</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">MCPTool</span>&lt;<span class="hljs-title class_">GetIpInput</span>&gt; &#123;<br>  name = <span class="hljs-string">&quot;get-ip&quot;</span>;<br>  description = <span class="hljs-string">&quot;get ip information&quot;</span>;<br><br>  schema = &#123;<br>    <span class="hljs-attr">ip</span>: &#123;<br>      <span class="hljs-attr">type</span>: z.<span class="hljs-title function_">string</span>(),<br>      <span class="hljs-attr">description</span>: <span class="hljs-string">&quot;ip address&quot;</span>,<br>      <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,<br>    &#125;<br>  &#125;;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">input: GetIpInput</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">&quot;Starting execution&quot;</span>);<br>      <span class="hljs-keyword">const</span> <span class="hljs-attr">response</span>: <span class="hljs-built_in">any</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.vore.top/api/IPdata?ip=<span class="hljs-subst">$&#123;input.ip&#125;</span>`</span>);<br>      <span class="hljs-keyword">return</span> response;<br>    &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>      <span class="hljs-keyword">return</span> error; <br>    &#125;<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">GetIpTool</span>;<br></code></pre></td></tr></table></figure><blockquote><p>这是基于生成的模板进行修改后的，<code>schema</code>里的属性是需要调用ai时传递的参数, <code>execute</code>方法是执行该<code>tool</code>时执行的操作, 返回的结果<code>AI</code>会自己解析，所以直接返回就好。<br>需要注意的是，<code>description</code>的内容一定要准确和完善，这样子<code>AI</code>才能更好的理解<code>tool</code>的用法和字段的含义</p></blockquote><h2 id="设置服务"><a href="#设置服务" class="headerlink" title="设置服务"></a>设置服务</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">MCPServer</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;mcp-framework&quot;</span>;<br><br><span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MCPServer</span>(&#123;<br>    <span class="hljs-attr">transport</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;http-stream&quot;</span>, <span class="hljs-comment">// 设置连接方式为http stream</span><br>      <span class="hljs-attr">options</span>: &#123;<br>        <span class="hljs-attr">port</span>: <span class="hljs-number">1337</span>, <span class="hljs-comment">// 端口号为1337</span><br>        <span class="hljs-attr">cors</span>: &#123;<br>          <span class="hljs-attr">allowOrigin</span>: <span class="hljs-string">&quot;*&quot;</span><br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;);<br><br>server.<span class="hljs-title function_">start</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;Server error:&quot;</span>, error);<br>    process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);<br>&#125;);<br><br></code></pre></td></tr></table></figure><p>简单配置一下<code>MCP</code>服务的启动方式, 分为<code>stdio</code>、<code>sse</code>、<code>http-stream</code>，其中<code>sse</code>将要过期了。<code>stdio</code>主要是针对本地的服务，而<code>http-stream</code> <code>sse</code> 针对的是部署在云服务器上的服务</p><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm run build<br><br></code></pre></td></tr></table></figure><p>执行<code>build</code>命令，会在<code>dist</code>目录下生成对应的<code>js</code>文件, 然后执行:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">node dist/index.js <br></code></pre></td></tr></table></figure><p>这样，我们的<code>MCP</code>服务就运行在本机的<a href="http://localhostr:1337/mcp">http://localhostr:1337/mcp</a>地址上</p><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><blockquote><p>需要用到<code>mcp-debug</code>, 这个是 <code>MCP</code>团队开发的本地<code>web</code>应用，专用来测试<code>MCP</code>服务的</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npx mcp-debug<br></code></pre></td></tr></table></figure><p>如果没安装过会提示先安装该插件, 执行成功后打开<a href="http://127.0.0.1:5173/">http://127.0.0.1:5173</a>, 调试工具的默认地址</p><p><img src="/images/mcp/1.jpg" alt="1"></p><p>将自己本地的<code>MCP</code>服务地址输入到URL中，点击<code>Connect</code>,即可看到<code>MCP</code>服务中拥有的<code>Tools</code>，也就是可以进行调试了。</p><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>创建<code>Dockerfile</code></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Dockerfile"><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">18</span> as builder<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> package*.json ./</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> npm install</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> . .</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> npm run build</span><br><br><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">18</span>-alpine<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /app</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=builder /app .</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">1337</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;node&quot;</span>, <span class="hljs-string">&quot;dist/index.js&quot;</span>]</span><br></code></pre></td></tr></table></figure><blockquote><p><code>MCP</code>基于<code>nodejs 18+</code>， 所以先检查自己的<code>node</code>版本是否符合</p></blockquote><p>创建<code>docker-compose.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">app:</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">get-ip-mcp-server</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;1337:1337&quot;</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">NODE_ENV=production</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./logs:/app/logs</span><br></code></pre></td></tr></table></figure><p>创建完<code>Docker</code>配置文件之后将代码上传至自己的服务器存放项目的文件夹下</p><blockquote><p>注意 <code>dist</code> <code>node_module</code> 文件不要上传,<code>docker</code>部署的时候会重新安装构建的</p></blockquote><h2 id="运行-1"><a href="#运行-1" class="headerlink" title="运行"></a>运行</h2><p>到服务器的项目根目录下执行:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose up -d<br></code></pre></td></tr></table></figure><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>这里我们使用<code>cherry-studio</code>进行连接我们的<code>mcp</code>服务查看是否可用</p><p><img src="/images/mcp/2.jpg" alt="2"></p><p>新建<code>MCP</code>连接，并连接到我们自己的服务,这里我是做了<code>nginx</code>域名转发了，所以是通过域名访问的，如果没有配置<code>nginx</code>,则需要通过你的服务器地址加端口号进行访问了</p><blockquote><p>例如 <a href="http://192.168.0.3:1337/mcp">http://192.168.0.3:1337/mcp</a></p></blockquote><p>配置好之后，即可在<code>cherry-studio</code>对话框内选定我们刚配置的<code>MCP</code>服务, 输入<code>ip</code>地址，就会发现<code>AI</code>调用了我们的<code>MCP</code>服务，并返回了相应的结果</p><p><img src="/images/mcp/3.jpg" alt="3"></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://mcp-framework.com/">mcp-framework</a></li><li><a href="https://modelcontextprotocol.io/">mcp协议</a></li><li><a href="https://github.com/CherryHQ/cherry-studio">cherry studio</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>docker</tag>
      
      <tag>mcp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue3中v-for列表中使用Transition，设置delay延迟失效的bug</title>
    <link href="/2025/04/22/vue3-transition/"/>
    <url>/2025/04/22/vue3-transition/</url>
    
    <content type="html"><![CDATA[<p>当我们想在<code>v-for</code>下的每一列添加渐入效果的动画，然后根据index设置不同的延迟时间，就会发现设置的延迟时间失效了。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item, index) in 5&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Transition</span></span><br><span class="hljs-tag">        <span class="hljs-attr">appear</span></span><br><span class="hljs-tag">        <span class="hljs-attr">:enter-active-class</span>=<span class="hljs-string">&quot;`animate__animated animate__fadeInRight animate__delay-$&#123;index + 1&#125;s`&quot;</span></span><br><span class="hljs-tag">    &gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;item&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>            &#123;&#123; index &#125;&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">Transition</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>其中设置动画效果是通过的 <code>animate.css</code> 库实现的, 其中 <code>animate__delay-1s</code> 就是设置延迟时间的, 表示延迟 <code>1s</code> 后开始动画。</p><p>但是当通过 <code>index</code> 为 <code>enter-active-class</code> 设置延迟时间时，动态赋值 <code>animate__delay-$&#123;index + 1&#125;s</code> 时，发现设置的延迟时间失效了。<br>也不算是失效，而是有些列的延迟时间正常，但是有的列的延迟时间却没有生效。</p><p>我猜测是由于 <code>class</code> 动态绑定的原因，渲染延迟失效，导致 <code>class</code> 没有正确的被解析和转换。</p><p>所以，将其延迟属性通过 <code>style</code> 样式的方式进行设置，就可以解决这个问题。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item, index) in 5&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;item&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">Transition</span></span><br><span class="hljs-tag">        <span class="hljs-attr">appear</span></span><br><span class="hljs-tag">        <span class="hljs-attr">:enter-active-class</span>=<span class="hljs-string">&quot;`animate__animated animate__fadeInRight`&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">:style</span>=<span class="hljs-string">&quot;&#123; animationDelay: `$&#123;index + 1&#125;s` &#125;&quot;</span></span><br><span class="hljs-tag">    &gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">Transition</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><p>这样就可以解决这个问题了。</p>]]></content>
    
    
    
    <tags>
      
      <tag>Vue</tag>
      
      <tag>v-for</tag>
      
      <tag>Transition</tag>
      
      <tag>delay</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AI模型平台Cherry Studio 使用Github MCP服务</title>
    <link href="/2025/04/15/github-mcp/"/>
    <url>/2025/04/15/github-mcp/</url>
    
    <content type="html"><![CDATA[<h2 id="Github-MCP服务"><a href="#Github-MCP服务" class="headerlink" title="Github MCP服务"></a>Github MCP服务</h2><p>除了 <code>Cherry Studio</code>内置的MCP服务外，<a href="https://mcp.so/">https://mcp.so/</a> 上还提供了很多官方平台提供的mcp服务</p><p><img src="/images/github-mcp/1.jpg" alt="示例"></p><p>因为平时github使用的挺多的，所以就选择Github MCP服务进行一个对接</p><h2 id="获取Github-token"><a href="#获取Github-token" class="headerlink" title="获取Github token"></a>获取Github token</h2><p>首先我们需要获取一个Github token，用于通过mcp服务访问我们的仓库</p><p>在 <code>Settings</code> -&gt; <code>Developer settings</code> -&gt; <code>Personal access tokens</code> -&gt; <code>Tokens(classic)</code> 中创建一个token</p><p>为了安全起见我们新建一个 <code>Fine-grained personal access tokens</code><br><img src="/images/github-mcp/2.jpg" alt="示例"></p><p>注意，需要将你想要通过<code>ai</code>操作你仓库的权限勾选中，否则该<code>Token</code>也无法执行相应的操作<br><img src="/images/github-mcp/4.jpg" alt="示例"></p><p>这个 <code>Token</code> 我们需要保存下来，因为后面我们需要使用, 页面刷新就再也看不到了，所以记得找个记事本保存一下</p><h2 id="配置Github-MCP服务"><a href="#配置Github-MCP服务" class="headerlink" title="配置Github MCP服务"></a>配置Github MCP服务</h2><p>具体配置可以参考GitHub MCP服务的文档: <a href="https://github.com/github/github-mcp-server">https://github.com/github/github-mcp-server</a></p><p>其中有一段<code>Usage with Claude Desktop</code>的配置，我们可以参考一下:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;mcpServers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;github&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;docker&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;run&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;-i&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;--rm&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;-e&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;GITHUB_PERSONAL_ACCESS_TOKEN&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;ghcr.io/github/github-mcp-server&quot;</span><br>      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;env&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;GITHUB_PERSONAL_ACCESS_TOKEN&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&lt;YOUR_TOKEN&gt;&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>根据<code>Cherry Studio</code>开启MCP服务的配置项，我们不难发现是参考的<code>Claude</code>的配置，所以我们可以直接复制过来，然后将<code>GITHUB_PERSONAL_ACCESS_TOKEN</code>替换为我们自己的<code>Token</code></p><p>然后在 <code>Cherry Studio</code> 中点击 <code>MCP</code> 服务，点击 <code>+</code> 号添加一个服务<br>点击计入该空白服务，并进行如下配置:<br><img src="/images/github-mcp/3.jpg" alt="示例"></p><ol><li><p>名称, 我们就起一个方便我们识别的名称就好</p></li><li><p>类型, 选择 stdio 就好，因为我们的 <code>Github MCP</code>服务是启动在本地<code>docker</code>中的</p></li><li><p>命令, <code>Cherry Studio</code>默认推荐的命令是<code>uvx</code> 和 <code>npx</code>, 但是<code>Github MCP</code>是通过<code>docker</code>来启动的，所以我们事先需要安装<code>docker</code>, 然后此处手动输入 <code>docker</code> 即可</p></li><li><p>参数, 我们将 <code>json</code> 中的 <code>args</code> 部分复制过来即可, 注意要将引号以及逗号删除</p></li><li><p>环境变量, 配置的形式是<code>key=value</code>, 所以需要我们将 <code>GITHUB_PERSONAL_ACCESS_TOKEN=&lt;your token&gt;</code> 粘贴进去, <code>&lt;your token&gt;</code> 替换为Github账号中获取的Token</p></li></ol><p>配置完毕之后，我们点击保存并启用该服务</p><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>切换到对话窗口, 首先我们需要告知<code>ai</code> 模型一个基本信息，我们需要操作的是哪个仓库<br>例如:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 角色设定</span><br>你是一个智能机器人，拥有GitHub API操作权限，你的工作是帮我管理我的GitHub代码仓库，检查是否有我未处理的issue/pr，并给出合理的解决建议。<br><br><span class="hljs-comment"># 基本信息</span><br>我github的id是：StanLee12  <br>我自己的代码仓库是：https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/StanLee12/</span>stanlee12.github.io<br></code></pre></td></tr></table></figure><p>将这段话发给<code>模型</code>，然后我们就可以开始通过<code>Cherry Studio</code>来操作我们的<code>Github</code>仓库了</p><p><img src="/images/github-mcp/5.jpg" alt="示例"></p><p>可以看到<code>ai</code>通过<code>mcp</code>服务调用了 <code>list_pull_requests</code> 和 <code>list_code_scanning_alerts</code>方法， 但是第二个失败了，是因为我的<code>Token</code>没有给到相关的权限</p>]]></content>
    
    
    
    <tags>
      
      <tag>github</tag>
      
      <tag>cherry studio</tag>
      
      <tag>mcp</tag>
      
      <tag>ai</tag>
      
      <tag>llm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AI模型平台Cherry Studio开启MCP Filesystem服务</title>
    <link href="/2025/04/15/cherry-studio-mcp/"/>
    <url>/2025/04/15/cherry-studio-mcp/</url>
    
    <content type="html"><![CDATA[<h2 id="MCP-服务"><a href="#MCP-服务" class="headerlink" title="MCP 服务"></a>MCP 服务</h2><p>MCP全称是Model Context Protocol，是一个基于LLM(大语言模型)的协议，你可以理解为用户结合ai服务的http协议，通过这个协议你可以调用ai服务的接口，获取ai服务的返回结果。<br>再通俗点讲就是，通过实现该协议，你可以将自己的平台与ai服务进行对接，通过ai调用自己平台的接口，实现自己平台的ai化。</p><h2 id="Cherry-Studio"><a href="#Cherry-Studio" class="headerlink" title="Cherry Studio"></a>Cherry Studio</h2><p>Cherry Studio是一个基于MCP协议的ai服务平台，你可以理解为一个ai服务的后台管理系统，你可以通过该系统来管理你的ai服务。这个是国内开源的一个平台，不需要注册，非常方便。</p><p>Cherry studio可以通过 <a href="https://cherry-ai.com/">https://cherry-ai.com/</a> 进行下载</p><h2 id="配置ai-token"><a href="#配置ai-token" class="headerlink" title="配置ai token"></a>配置ai token</h2><p><img src="/images/cherry-studio-mcp/1.jpg" alt="配置Token"></p><p>Cherry Studio配置ai模型的方式非常方便, 你只需要到设置中找到对应的想要使用的模型，然后点击右侧的获取会自动跳转至该模型平台，获取到token后，粘贴到API密钥输入框内即可。</p><h2 id="配置MCP服务"><a href="#配置MCP服务" class="headerlink" title="配置MCP服务"></a>配置MCP服务</h2><p><img src="/images/cherry-studio-mcp/2.jpg" alt="配置MCP"></p><p>在Cherry Studio中，你可以通过点击左侧的MCP服务，来配置MCP服务。</p><p>我们这里以Cherry Studio内置的Filesystem服务为例，点击添加，即可添加一个Filesystem服务。</p><p><img src="/images/cherry-studio-mcp/3.jpg" alt="配置MCP"></p><p>还需要将自己想要控制的文件夹作为参数配置给MCP服务，如图所示。<br>这样，我们就配置好了一个MCP服务。</p><h2 id="开启MCP服务"><a href="#开启MCP服务" class="headerlink" title="开启MCP服务"></a>开启MCP服务</h2><p>当配置完MCP服务以后，我们切换到AI对话窗口，开启需要使用的MCP服务：<br><img src="/images/cherry-studio-mcp/4.jpg" alt="测试"></p><p>并且我们可以预设一段话，方便AI更能清晰的理解我们的需求，例如:</p><blockquote><p>你是一个智能机器人，拥有我的文件夹操作权限，我需要你帮助我操作文件夹</p></blockquote><p>这样，我们就可以通过AI对话窗口来控制我们的文件夹了。</p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p><img src="/images/cherry-studio-mcp/5.jpg" alt="测试"></p><p>如上所示，ai已经能够访问我们的文件夹了，并且可以执行我们的指令了。当然具体有哪些指令可以操作，就需要我们去 相应的 MCP 服务中去查看了。如果有些特殊的需求，我们可以自己实现一个 MCP 服务。这就是我接下来将要研究的内容了。</p><h2 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h2><p>想要了解更多关于MCP的内容，可以参考以下链接：</p><ul><li><a href="https://mcp.so/">mcp服务</a></li><li><a href="https://github.com/CherryHQ/cherry-studio">cherry studio</a></li><li><a href="https://modelcontextprotocol.io/">mcp协议</a></li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>cherry studio</tag>
      
      <tag>mcp</tag>
      
      <tag>deepseek</tag>
      
      <tag>ai</tag>
      
      <tag>llm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>修复 HBuilder 在 Mac M 系列芯片上的兼容性问题</title>
    <link href="/2025/04/14/fix-hbuilder-arm-issue/"/>
    <url>/2025/04/14/fix-hbuilder-arm-issue/</url>
    
    <content type="html"><![CDATA[<h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>当在Mac OS（M系列芯片）上使用HBuilder时，可能会遇到以下错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Error: Cannot find module <span class="hljs-string">&#x27;@rollup/rollup-darwin-x64&#x27;</span><br></code></pre></td></tr></table></figure><p>这是因为运行时依赖以下两个x64架构的包：</p><ul><li>@esbuild&#x2F;darwin-x64</li><li>@rollup&#x2F;rollup-darwin-x64</li></ul><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>需要手动安装对应的x64版本包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install @esbuild/darwin-x64@0.20.2 @rollup/rollup-darwin-x64@4.29.1 --save-dev --force<br></code></pre></td></tr></table></figure><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ol><li>–save-dev (-D) 表示作为开发依赖安装</li><li>–force (-f) 强制安装，覆盖可能存在的冲突</li><li>指定版本号是为了确保兼容性</li></ol><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>如果后续更新HBuilder版本，可能需要重新检查这些依赖包的版本兼容性。</p>]]></content>
    
    
    
    <tags>
      
      <tag>HBuilder</tag>
      
      <tag>Mac</tag>
      
      <tag>M系列芯片</tag>
      
      <tag>ARM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginx 域名配置 https 访问</title>
    <link href="/2025/02/24/nginx-ssl/"/>
    <url>/2025/02/24/nginx-ssl/</url>
    
    <content type="html"><![CDATA[<h2 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h2><ol><li>检查 安装的nginx是否支持ssl</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">nginx -V<br><br>nginx version: nginx/1.26.1<br>built by gcc 4.8.5 20150623 (Red Hat 4.8.5-44) (GCC)<br>built with OpenSSL 1.0.2k-fips  26 Jan 2017<br>TLS SNI support enabled<br>configure arguments: --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-compat --with-file-aio --with-threads --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-mail --with-mail_ssl_module --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-cc-opt=&#x27;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -m64 -mtune=generic -fPIC&#x27; --with-ld-opt=&#x27;-Wl,-z,relro -Wl,-z,now -pie&#x27;<br></code></pre></td></tr></table></figure><p><code>nginx</code> 配置参数中，有 <code>--with-http_ssl_module</code> 字样，说明nginx支持ssl, 否则需要重新编译nginx。</p><h2 id="二、申请ssl证书"><a href="#二、申请ssl证书" class="headerlink" title="二、申请ssl证书"></a>二、申请ssl证书</h2><ol><li><p>访问阿里云，购买ssl证书。如果是个人的网站，完全可以使用免费的证书使用。</p><p> <img src="/../images/nginx-ssl/1.jpg" alt="1"></p></li><li><p>下载证书。</p><p> <img src="/../images/nginx-ssl/2.jpg" alt="2"></p></li><li><p>上传证书。</p><p> 将下载下来的证书压缩包通过<code>scp</code>上传至服务器。</p></li></ol><h2 id="三、配置nginx"><a href="#三、配置nginx" class="headerlink" title="三、配置nginx"></a>三、配置nginx</h2><ol><li><p>解压证书压缩包。</p><p> 新建一个用于存放证书的文件夹， 例如 <code>/etc/nginx/ssl </code>。将证书压缩包解压至<code>/etc/nginx/ssl</code>目录下。证书中包含<code>nginx</code>所需的<code>ssl</code>证书和<code>ssl</code>密钥。<code>yourdomain.com.pem</code> 是证书文件，<code>yourdomain.com.key</code> 是密钥文件。</p></li><li><p>修改nginx配置文件。</p><p> 在<code>/etc/nginx/conf.d/default.conf</code>文件中添加以下配置：</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs conf">server &#123;<br>    listen 443 ssl; # 443端口是默认的https端口 并开启ssl<br>    server_name blog.yourdomain.com;<br><br>    ssl_certificate /etc/nginx/ssl/yourdomain.com.pem; # 证书地址<br>    ssl_certificate_key /etc/nginx/ssl/yourdomain.com.key; # 密钥地址<br><br>    ssl_protocols TLSv1.2 TLSv1.3;  # 支持的协议版本<br>    ssl_ciphers HIGH:!aNULL:!MD5;  # 加密套件<br>    ssl_prefer_server_ciphers on;  # 优先使用服务器的加密套件<br><br>    ## 反向代理至本地服务<br>    location / &#123;<br>        proxy_pass http://127.0.0.1:8080;<br>        proxy_set_header Host $host;<br>        proxy_set_header X-Real-IP $remote_addr;<br>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>    &#125;<br>&#125; <br><br></code></pre></td></tr></table></figure></li></ol><h2 id="四、测试"><a href="#四、测试" class="headerlink" title="四、测试"></a>四、测试</h2><ol><li><p>重启nginx。</p> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nginx -s reload<br></code></pre></td></tr></table></figure></li><li><p>测试。<br> 访问<code>https://blog.yourdomain.com</code>， 如果可以访问到页面，说明配置成功。</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>nginx</tag>
      
      <tag>https. ssl</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo 主题使用 Injector 添加鼠标点击特效</title>
    <link href="/2025/02/19/hexo-inject/"/>
    <url>/2025/02/19/hexo-inject/</url>
    
    <content type="html"><![CDATA[<h2 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h2><p>使用<code>Hexo</code>搭建了自己的的博客，并且配置了主题，看到了别人博客上的点击特效，就比较心动，试着研究了一下，怎么给自己的网站添加特效。</p><p>但是很多内容说的都是老版本的用法，我自己研究了下新版本的用法，本文章使用的相关版本:</p><table><thead><tr><th>依赖</th><th>版本号</th></tr></thead><tbody><tr><td>Hexo</td><td>6.3.0</td></tr><tr><td>hexo-theme-fluid</td><td>1.9.8</td></tr></tbody></table><h2 id="1-动效脚本"><a href="#1-动效脚本" class="headerlink" title="1. 动效脚本"></a>1. 动效脚本</h2><p>首先需要在<code>source</code>文件下新建一个<code>js</code>文件夹，用于存放动效脚本, 下面是我找到的可用的爆炸特效的完整脚本代码:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">clickEffect</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">let</span> balls = [];<br>  <span class="hljs-keyword">let</span> longPressed = <span class="hljs-literal">false</span>;<br>  <span class="hljs-keyword">let</span> longPress;<br>  <span class="hljs-keyword">let</span> multiplier = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">let</span> width, height;<br>  <span class="hljs-keyword">let</span> origin;<br>  <span class="hljs-keyword">let</span> normal;<br>  <span class="hljs-keyword">let</span> ctx;<br>  <span class="hljs-keyword">const</span> colours = [<span class="hljs-string">&quot;#F73859&quot;</span>, <span class="hljs-string">&quot;#14FFEC&quot;</span>, <span class="hljs-string">&quot;#00E0FF&quot;</span>, <span class="hljs-string">&quot;#FF99FE&quot;</span>, <span class="hljs-string">&quot;#FAF15D&quot;</span>];<br>  <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;canvas&quot;</span>);<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(canvas);<br>  canvas.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;style&quot;</span>, <span class="hljs-string">&quot;width: 100%; height: 100%; top: 0; left: 0; z-index: 99999; position: fixed; pointer-events: none;&quot;</span>);<br>  <span class="hljs-keyword">const</span> pointer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;span&quot;</span>);<br>  pointer.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&quot;pointer&quot;</span>);<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(pointer);<br> <br>  <span class="hljs-keyword">if</span> (canvas.<span class="hljs-property">getContext</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">addEventListener</span>) &#123;<br>    ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&quot;2d&quot;</span>);<br>    <span class="hljs-title function_">updateSize</span>();<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, updateSize, <span class="hljs-literal">false</span>);<br>    <span class="hljs-title function_">loop</span>();<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;mousedown&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) &#123;<br>      <span class="hljs-title function_">pushBalls</span>(<span class="hljs-title function_">randBetween</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>), e.<span class="hljs-property">clientX</span>, e.<span class="hljs-property">clientY</span>);<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&quot;is-pressed&quot;</span>);<br>      longPress = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&quot;is-longpress&quot;</span>);<br>        longPressed = <span class="hljs-literal">true</span>;<br>      &#125;, <span class="hljs-number">500</span>);<br>    &#125;, <span class="hljs-literal">false</span>);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;mouseup&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) &#123;<br>      <span class="hljs-built_in">clearInterval</span>(longPress);<br>      <span class="hljs-keyword">if</span> (longPressed == <span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&quot;is-longpress&quot;</span>);<br>        <span class="hljs-title function_">pushBalls</span>(<span class="hljs-title function_">randBetween</span>(<span class="hljs-number">50</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(multiplier), <span class="hljs-number">100</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(multiplier)), e.<span class="hljs-property">clientX</span>, e.<span class="hljs-property">clientY</span>);<br>        longPressed = <span class="hljs-literal">false</span>;<br>      &#125;<br>      <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&quot;is-pressed&quot;</span>);<br>    &#125;, <span class="hljs-literal">false</span>);<br>    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;mousemove&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) &#123;<br>      <span class="hljs-keyword">let</span> x = e.<span class="hljs-property">clientX</span>;<br>      <span class="hljs-keyword">let</span> y = e.<span class="hljs-property">clientY</span>;<br>      pointer.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = y + <span class="hljs-string">&quot;px&quot;</span>;<br>      pointer.<span class="hljs-property">style</span>.<span class="hljs-property">left</span> = x + <span class="hljs-string">&quot;px&quot;</span>;<br>    &#125;, <span class="hljs-literal">false</span>);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;canvas or addEventListener is unsupported!&quot;</span>);<br>  &#125;<br> <br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateSize</span>(<span class="hljs-params"></span>) &#123;<br>    canvas.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> * <span class="hljs-number">2</span>;<br>    canvas.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> * <span class="hljs-number">2</span>;<br>    canvas.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> + <span class="hljs-string">&#x27;px&#x27;</span>;<br>    canvas.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> + <span class="hljs-string">&#x27;px&#x27;</span>;<br>    ctx.<span class="hljs-title function_">scale</span>(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>);<br>    width = (canvas.<span class="hljs-property">width</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>);<br>    height = (canvas.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);<br>    origin = &#123;<br>      <span class="hljs-attr">x</span>: width / <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">y</span>: height / <span class="hljs-number">2</span><br>    &#125;;<br>    normal = &#123;<br>      <span class="hljs-attr">x</span>: width / <span class="hljs-number">2</span>,<br>      <span class="hljs-attr">y</span>: height / <span class="hljs-number">2</span><br>    &#125;;<br>  &#125;<br>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Ball</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x = origin.x, y = origin.y</span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> = x;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> = y;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">angle</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>();<br>      <span class="hljs-keyword">if</span> (longPressed == <span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">multiplier</span> = <span class="hljs-title function_">randBetween</span>(<span class="hljs-number">14</span> + multiplier, <span class="hljs-number">15</span> + multiplier);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">multiplier</span> = <span class="hljs-title function_">randBetween</span>(<span class="hljs-number">6</span>, <span class="hljs-number">12</span>);<br>      &#125;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">vx</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">multiplier</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0.5</span>) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">angle</span>);<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">vy</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">multiplier</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">0.5</span>) * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">angle</span>);<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">r</span> = <span class="hljs-title function_">randBetween</span>(<span class="hljs-number">8</span>, <span class="hljs-number">12</span>) + <span class="hljs-number">3</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>();<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = colours[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * colours.<span class="hljs-property">length</span>)];<br>    &#125;<br>    <span class="hljs-title function_">update</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> += <span class="hljs-variable language_">this</span>.<span class="hljs-property">vx</span> - normal.<span class="hljs-property">x</span>;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> += <span class="hljs-variable language_">this</span>.<span class="hljs-property">vy</span> - normal.<span class="hljs-property">y</span>;<br>      normal.<span class="hljs-property">x</span> = -<span class="hljs-number">2</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">angle</span>);<br>      normal.<span class="hljs-property">y</span> = -<span class="hljs-number">2</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">angle</span>);<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">r</span> -= <span class="hljs-number">0.3</span>;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">vx</span> *= <span class="hljs-number">0.9</span>;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">vy</span> *= <span class="hljs-number">0.9</span>;<br>    &#125;<br>  &#125;<br> <br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">pushBalls</span>(<span class="hljs-params">count = <span class="hljs-number">1</span>, x = origin.x, y = origin.y</span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) &#123;<br>      balls.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Ball</span>(x, y));<br>    &#125;<br>  &#125;<br> <br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">randBetween</span>(<span class="hljs-params">min, max</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * max) + min;<br>  &#125;<br> <br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">loop</span>(<span class="hljs-params"></span>) &#123;<br>    ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&quot;rgba(255, 255, 255, 0)&quot;</span>;<br>    ctx.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.<span class="hljs-property">width</span>, canvas.<span class="hljs-property">height</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; balls.<span class="hljs-property">length</span>; i++) &#123;<br>      <span class="hljs-keyword">let</span> b = balls[i];<br>      <span class="hljs-keyword">if</span> (b.<span class="hljs-property">r</span> &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">continue</span>;<br>      ctx.<span class="hljs-property">fillStyle</span> = b.<span class="hljs-property">color</span>;<br>      ctx.<span class="hljs-title function_">beginPath</span>();<br>      ctx.<span class="hljs-title function_">arc</span>(b.<span class="hljs-property">x</span>, b.<span class="hljs-property">y</span>, b.<span class="hljs-property">r</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>, <span class="hljs-literal">false</span>);<br>      ctx.<span class="hljs-title function_">fill</span>();<br>      b.<span class="hljs-title function_">update</span>();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (longPressed == <span class="hljs-literal">true</span>) &#123;<br>      multiplier += <span class="hljs-number">0.2</span>;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!longPressed &amp;&amp; multiplier &gt;= <span class="hljs-number">0</span>) &#123;<br>      multiplier -= <span class="hljs-number">0.4</span>;<br>    &#125;<br>    <span class="hljs-title function_">removeBall</span>();<br>    <span class="hljs-title function_">requestAnimationFrame</span>(loop);<br>  &#125;<br> <br>  <span class="hljs-keyword">function</span> <span class="hljs-title function_">removeBall</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; balls.<span class="hljs-property">length</span>; i++) &#123;<br>      <span class="hljs-keyword">let</span> b = balls[i];<br>      <span class="hljs-keyword">if</span> (b.<span class="hljs-property">x</span> + b.<span class="hljs-property">r</span> &lt; <span class="hljs-number">0</span> || b.<span class="hljs-property">x</span> - b.<span class="hljs-property">r</span> &gt; width || b.<span class="hljs-property">y</span> + b.<span class="hljs-property">r</span> &lt; <span class="hljs-number">0</span> || b.<span class="hljs-property">y</span> - b.<span class="hljs-property">r</span> &gt; height || b.<span class="hljs-property">r</span> &lt; <span class="hljs-number">0</span>) &#123;<br>        balls.<span class="hljs-title function_">splice</span>(i, <span class="hljs-number">1</span>);<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><span class="hljs-title function_">clickEffect</span>();<br><br></code></pre></td></tr></table></figure><p>新建一个 <code>source/js/explosion.js</code> 文件，将上面的代码粘进去即可</p><h2 id="2-注入脚本"><a href="#2-注入脚本" class="headerlink" title="2. 注入脚本"></a>2. 注入脚本</h2><p>在博客项目的根目录下新建一个 <code>scripts</code> 文件夹， 文件夹名称要确保正确，<code>hexo</code> 编译时会根据目录名称运行添加的脚本</p><p>在 <code>scripts</code> 文件夹下新建一个<code>js</code>文件, 例如 <code>cursor.js</code>,并向其中添加代码:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">hexo.<span class="hljs-property">extend</span>.<span class="hljs-property">injector</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">&#x27;body_end&#x27;</span>, <span class="hljs-string">`</span><br><span class="hljs-string">    &lt;script src=&quot;/js/explosion.js&quot;&gt;&lt;/script&gt;</span><br><span class="hljs-string">`</span>)<br></code></pre></td></tr></table></figure><h3 id="Hexo-injector"><a href="#Hexo-injector" class="headerlink" title="Hexo injector"></a><code>Hexo injector</code></h3><p>简单介绍下<code>hexo.extend.injector.register(entry, value, to);</code></p><hr><p><strong><code>entry &lt;string&gt;</code></strong></p><p>在 HTML 中的注入代码的位置。</p><p>支持这些值：</p><ul><li>head_begin: 注入在 <head> 之后（默认）</li><li>head_end: 注入在 </head> 之前</li><li>body_begin: 注入在 <body> 之后</li><li>body_end: 注入在 </body> 之前</li></ul><hr><p><strong><code>value &lt;string&gt; | &lt;Function&gt;</code></strong></p><p>需要注入的代码片段。也就是将上面创建的<code>js</code>脚本导入。</p><hr><p><strong><code>to &lt;string&gt;</code></strong></p><p>哪些页面会被注入代码</p><ul><li>default: 注入到每个页面（默认值）</li><li>home: 只注入到主页</li><li>post: 只注入到文章页面</li><li>page: 只注入到独立页面</li><li>archive: 只注入到归档页面</li><li>category: 只注入到分类页面</li><li>tag: 只注入到标签页面</li><li>或是其他自定义 <code>layout</code> 名称</li></ul>]]></content>
    
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>fluid</tag>
      
      <tag>injector</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>docker-compose部署的nginx服务绑定域名</title>
    <link href="/2025/02/08/nginx-domain/"/>
    <url>/2025/02/08/nginx-domain/</url>
    
    <content type="html"><![CDATA[<h2 id="准备域名"><a href="#准备域名" class="headerlink" title="准备域名"></a>准备域名</h2><p>首先我们需要去购买一个域名，可以去阿里云进行购买，购买的时候需要实名认证，然后等待域名解析，一般在十几分钟至个把小时。解析成功之后可以自己先测试一下是否解析成功能否通过DNS ping通，ping通之后就可以进行下一步了。</p><h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2><p>我们以阿里云为例，购买成功之后就可以进行解析了，与服务器绑定。</p><p>进入控制台, 找到自己拥有的域名列表，找到需要解析的域名，点击:</p><p><img src="/images/nginx-domain/1.jpg" alt="1"></p><p><img src="/images/nginx-domain/2.jpg" alt="2"></p><p><img src="/images/nginx-domain/3.jpg" alt="3"></p><p><code>主机记录</code> 指的是子域名的名称, 默认的主域名是 <code>www.domain.com</code>, 而子域名就指的是 <code>blog.domain.com</code>,  我们先添加子域名 <code>blog</code> 作为博客地址。</p><p><code>记录值</code> 指的是你拥有的 服务器的 ip地址，以后访问你的域名就会指向到该 ip地址的服务器。</p><p>其他的填默认内容就好，不做修改。</p><p>到此为止，我们就准备好了一个名为 <code>blog.domain.com</code> 的域名。</p><h2 id="nginx-配置"><a href="#nginx-配置" class="headerlink" title="nginx 配置"></a>nginx 配置</h2><p>首先我们的前提条件是，我们已经通过<code>docker-compose</code>部署了一个nginx服务，并且可以通过服务器的ip以及对应的端口号进行访问。</p><p>如果想要通过域名去访问的话我们需要在服务器上起一个<code>nginx</code>服务，并通过反向代理的方式将通过域名访问的请求转发至服务器本机的服务地址。</p><p>假设主机的web服务端口是 <code>8080</code>, 那主机的访问地址就是 <code>http://127.0.0.1:8080</code></p><p>当然需要在主机安装 <code>nginx</code>， 安装完成之后 执行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">nginx -t<br><br>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok<br>nginx: configuration file /etc/nginx/nginx.conf test is successful<br></code></pre></td></tr></table></figure><p>可以找到默认的<code>nginx</code> 默认的配置文件 <code>/etc/nginx/nginx.conf</code></p><p>本说明基于<code>nginx 1.26.1</code>, 所以它的默认配置文件拆分在 <code>/etc/nginx/conf.d/default.conf</code> 文件中</p><p>修改 <code>/etc/nginx/conf.d/default.conf</code> 文件内容</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs conf">server &#123;<br>    listen 80;<br>    # 输入自己刚才解析的域名地址<br>    server_name blog.domain.com;<br><br>    location / &#123;<br>        # 讲访问转发到主机部署的服务地址<br>        proxy_pass http://127.0.0.1:8080;<br>        proxy_set_header Host $host;<br>        proxy_set_header X-Real-IP $remote_addr;<br>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>也就是将通过域名访问的请求转发至本机部署的服务地址上, 至此即可通过 <code>blog.domain.com</code> 域名访问到自己部署的 web 服务</p>]]></content>
    
    
    
    <tags>
      
      <tag>docker-compose</tag>
      
      <tag>nginx</tag>
      
      <tag>docker</tag>
      
      <tag>域名</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用docker-compose 搭建nginx服务</title>
    <link href="/2025/01/27/docker-compose-nginx/"/>
    <url>/2025/01/27/docker-compose-nginx/</url>
    
    <content type="html"><![CDATA[<h2 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a>安装docker-compose</h2><p>Linux 上我们可以从 Github 上下载它的二进制包来使用，最新发行的版本地址：<a href="https://github.com/docker/compose/releases%E3%80%82">https://github.com/docker/compose/releases。</a></p><p>运行以下命令以下载 Docker Compose 的当前稳定版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -L &quot;https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><p>Docker Compose 存放在 GitHub，不太稳定。</p><p>你可以也通过执行下面的命令，高速安装 Docker Compose:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -L https://get.daocloud.io/docker/compose/releases/download/v2.4.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><p>将可执行权限应用于二进制文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod +x /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><p>创建软链：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose<br></code></pre></td></tr></table></figure><p>测试是否安装成功：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose version<br></code></pre></td></tr></table></figure><h2 id="创建项目文件夹"><a href="#创建项目文件夹" class="headerlink" title="创建项目文件夹"></a>创建项目文件夹</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir /data/blog<br></code></pre></td></tr></table></figure><p>在<code>/data</code> 目录下创建blog文件夹，用于存放nginx项目以及docker-compose配置文件</p><h2 id="创建docker-compose-yaml-配置文件"><a href="#创建docker-compose-yaml-配置文件" class="headerlink" title="创建docker-compose.yaml 配置文件"></a>创建docker-compose.yaml 配置文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tee docker-compose.yaml &lt;&lt;EOF<br></code></pre></td></tr></table></figure><p><code>tee</code> 指令是将输入内容写入到文件中</p><p><code>&lt;&lt;EOF</code> 文件开头，是 <code>end of file</code> 的缩写，加<code>&lt;&lt;</code>表示文件开头, 输入内容结尾加  <code>EOF</code> 表示文件内容到此结束</p><p>上面的命令执行完之后会进入输入模式，输入以下内容即可:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span> <span class="hljs-comment">#指定版本</span><br><span class="hljs-attr">services:</span>    <span class="hljs-comment">#服务根节点</span><br>  <span class="hljs-attr">nginx:</span>   <span class="hljs-comment">#jenkins服务/其他服务（web服务/nginx服务等）</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:1.22</span>  <span class="hljs-comment">#nginx镜像，如果镜像容器没有会去自动拉取</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">nginx</span>       <span class="hljs-comment">#容器的名称</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>             <span class="hljs-comment">#跟随docker的启动而启动</span><br>    <span class="hljs-attr">volumes:</span>                    <span class="hljs-comment">#挂载卷命令</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./conf/nginx.conf:/etc/nginx/nginx.conf</span>              <span class="hljs-comment">#映射配置文件入口文件</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./html:/usr/share/nginx/html</span>                         <span class="hljs-comment">#静态资源根目录挂载</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./logs:/var/log/nginx</span>                                <span class="hljs-comment">#日志文件挂载</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./conf.d:/etc/nginx/conf.d</span> <span class="hljs-comment">#映射配置文件</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">80</span><span class="hljs-string">:80</span>    <span class="hljs-comment">#宿主主机端口80 映射到 容器端口80</span><br><span class="hljs-string">EOF</span><br></code></pre></td></tr></table></figure><h2 id="创建-nginx-相关的配置文件夹"><a href="#创建-nginx-相关的配置文件夹" class="headerlink" title="创建 nginx 相关的配置文件夹"></a>创建 nginx 相关的配置文件夹</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p ./&#123;conf,logs,html,conf.d&#125;<br></code></pre></td></tr></table></figure><p><code>conf</code> 文件夹用于存放nginx web服务的基础配置</p><p><code>logs</code> 文件夹用于存放日志</p><p><code>html</code> 文件夹用于存放web项目打包后的文件</p><p><code>conf.d</code> 文件夹用于存放web项目对应的nginx配置文件</p><h2 id="创建基础配置文件"><a href="#创建基础配置文件" class="headerlink" title="创建基础配置文件"></a>创建基础配置文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tee ./conf/nginx.conf &lt;&lt;&#x27;EOF&#x27;<br></code></pre></td></tr></table></figure><p>输入以下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs conf">user  nginx;<br>worker_processes  auto;<br><br>error_log  /var/log/nginx/error.log notice;<br>pid        /var/run/nginx.pid;<br><br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br><br><br>http &#123;<br>    include       /etc/nginx/mime.types;<br>    default_type  application/octet-stream;<br><br>    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;<br>                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;<br>                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;<br><br>    access_log  /var/log/nginx/access.log  main;<br><br>    sendfile        on;<br>    #tcp_nopush     on;<br><br>    keepalive_timeout  65;<br><br>    #gzip  on;<br><br>    include /etc/nginx/conf.d/*.conf;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="创建项目入口文件"><a href="#创建项目入口文件" class="headerlink" title="创建项目入口文件"></a>创建项目入口文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tee ./html/index.html &lt;&lt;&#x27;EOF&#x27;<br></code></pre></td></tr></table></figure><p>输入以下内容:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Welcome to nginx!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-tag">html</span> &#123; <span class="hljs-attribute">color</span>-scheme: light dark; &#125;</span><br><span class="language-css"><span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">width</span>: <span class="hljs-number">35em</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;</span><br><span class="language-css"><span class="hljs-attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Welcome to nginx!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>For online documentation and support please refer to<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://nginx.org/&quot;</span>&gt;</span>nginx.org<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>Commercial support is available at<br><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;http://nginx.com/&quot;</span>&gt;</span>nginx.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Thank you for using nginx.<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br>EOF<br></code></pre></td></tr></table></figure><h2 id="创建-html-50x-html-文件"><a href="#创建-html-50x-html-文件" class="headerlink" title="创建./html/50x.html 文件"></a>创建<code>./html/50x.html</code> 文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tee ./html/50x.html &lt;&lt;&#x27;EOF&#x27;<br></code></pre></td></tr></table></figure><p>输入以下内容:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Error<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span><br><span class="language-css"><span class="hljs-selector-tag">html</span> &#123; <span class="hljs-attribute">color</span>-scheme: light dark; &#125;</span><br><span class="language-css"><span class="hljs-selector-tag">body</span> &#123; <span class="hljs-attribute">width</span>: <span class="hljs-number">35em</span>; <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;</span><br><span class="language-css"><span class="hljs-attribute">font-family</span>: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>An error occurred.<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Sorry, the page you are looking for is currently unavailable.<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><br>Please try again later.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>If you are the system administrator of this resource then you should check<br>the error log for details.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>Faithfully yours, nginx.<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br>EOF<br></code></pre></td></tr></table></figure><h2 id="创建默认项目配置文件"><a href="#创建默认项目配置文件" class="headerlink" title="创建默认项目配置文件"></a>创建默认项目配置文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tee ./conf.d/default.conf &lt;&lt;&#x27;EOF&#x27;<br></code></pre></td></tr></table></figure><p>输入以下内容:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs conf">server &#123;<br>    listen       80;<br>    listen  [::]:80;<br>    server_name  localhost;<br><br>    #access_log  /var/log/nginx/host.access.log  main;<br><br>    location / &#123;<br>        root   /usr/share/nginx/html;<br>        index  index.html index.htm;<br>    &#125;<br><br>    #error_page  404              /404.html;<br><br>    # redirect server error pages to the static page /50x.html<br>    #<br>    error_page   500 502 503 504  /50x.html;<br>    location = /50x.html &#123;<br>        root   /usr/share/nginx/html;<br>    &#125;<br>&#125;<br>EOF<br></code></pre></td></tr></table></figure><h2 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose up -d<br></code></pre></td></tr></table></figure><p>查看服务是否启动:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker ps<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>docker-compose</tag>
      
      <tag>nginx</tag>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>服务器安装docker以及启用nginx服务</title>
    <link href="/2025/01/26/docker-nginx/"/>
    <url>/2025/01/26/docker-nginx/</url>
    
    <content type="html"><![CDATA[<h1 id="centOS7-安装docker以及通过docker启用一个nginx服务"><a href="#centOS7-安装docker以及通过docker启用一个nginx服务" class="headerlink" title="centOS7 安装docker以及通过docker启用一个nginx服务"></a>centOS7 安装docker以及通过docker启用一个nginx服务</h1><h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><ul><li>本文所有操作基于centOS7系统</li></ul><h3 id="安装包管理器"><a href="#安装包管理器" class="headerlink" title="安装包管理器"></a>安装包管理器</h3><p>服务器上的包管理器使用的是 <code>dnf</code>， 用于替换 <code>yum</code> 管理器<br>可以使用命令 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install dnf<br></code></pre></td></tr></table></figure><p>检测 <code>dnf</code> 是否安装成功 可以执行 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dnf --version<br></code></pre></td></tr></table></figure><h3 id="设置dnf仓库"><a href="#设置dnf仓库" class="headerlink" title="设置dnf仓库"></a>设置<code>dnf</code>仓库</h3><p>安装 dnf-plugins-core 包（提供管理 DNF 仓库的命令），并设置仓库。  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dnf -y install dnf-plugins-core<br></code></pre></td></tr></table></figure><p>官方镜像,比较慢 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure><p>可以执行以下命令换成清华大学的镜像源：清华大学镜像源 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sed -i &#x27;s+https://download.docker.com+https://mirrors.tuna.tsinghua.edu.cn/docker-ce+&#x27; /etc/yum.repos.d/docker-ce.repo<br></code></pre></td></tr></table></figure><h3 id="安装docker以及其他依赖"><a href="#安装docker以及其他依赖" class="headerlink" title="安装docker以及其他依赖"></a>安装docker以及其他依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin<br></code></pre></td></tr></table></figure><p>启动docker </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl start docker<br></code></pre></td></tr></table></figure><p>如果希望 Docker 在系统启动时也启动可以使用以下命令：  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo systemctl enable --now docker<br></code></pre></td></tr></table></figure><p>以上命令会配置 Docker 的 systemd 服务，在系统启动时自动启动 Docker。  </p><p>检测是否安装并启动成功:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run hello-world<br></code></pre></td></tr></table></figure><p>以上命令会自动从docker-hub下载一个用于测试的镜像，启动成功之后会自动停止。如果第一次没有成功可以再尝试一次</p><h2 id="卸载docker"><a href="#卸载docker" class="headerlink" title="卸载docker"></a>卸载docker</h2><p>删除安装包：  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum remove docker-ce<br></code></pre></td></tr></table></figure><p>删除镜像、容器、配置文件等内容：  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">rm -rf /var/lib/docker<br></code></pre></td></tr></table></figure><h2 id="修改docker-默认工作目录"><a href="#修改docker-默认工作目录" class="headerlink" title="修改docker 默认工作目录"></a>修改docker 默认工作目录</h2><p>查看默认docker工作目录:  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker info<br></code></pre></td></tr></table></figure><p>可以看到docker默认工作目录是 <code>/var/lib/docker</code>,因为是系统盘所以不建议在此目录下存储docker相关内容</p><p>可以通过docker 配置文件修改</p><p>新建<code>/data/docker-workspace</code> 文件夹，并将默认docker目录修改为此目录 </p><p>通过修改 <code>/etc/docker/daemon.json</code>，没有该文件则新建一个, 并在其中添加</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;data-root&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/data/docker-workspace&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>然后重启docker:  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl stop docker.service<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl start docker<br></code></pre></td></tr></table></figure><p>查看是否已修改:    </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker info<br></code></pre></td></tr></table></figure><h2 id="其他docker常用命令"><a href="#其他docker常用命令" class="headerlink" title="其他docker常用命令"></a>其他docker常用命令</h2><p>查看运行中的服务:  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker ps -a<br></code></pre></td></tr></table></figure><p>-a 表示查看运行中以及停止中的服务</p><p>查看已安装的docker镜像:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker images<br></code></pre></td></tr></table></figure><p>搜索docker hub 上已存在的镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search [镜像名称]<br></code></pre></td></tr></table></figure><h2 id="安装docker-nginx镜像"><a href="#安装docker-nginx镜像" class="headerlink" title="安装docker nginx镜像"></a>安装docker nginx镜像</h2><p>搜索可用的镜像:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search nginx<br></code></pre></td></tr></table></figure><p>会看到第一个是官方的镜像源，这里我们就使用官方的就好</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull nginx<br></code></pre></td></tr></table></figure><p>查看已安装的镜像:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker images<br></code></pre></td></tr></table></figure><p>可以看到nginx镜像已装</p><h2 id="启动docker-nginx-服务"><a href="#启动docker-nginx-服务" class="headerlink" title="启动docker nginx 服务"></a>启动docker nginx 服务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run --name docker-nginx-test -p 8081:80 -d nginx<br></code></pre></td></tr></table></figure><p><code>docker-nginx-test</code> 指的是启动的服务的名称</p><p><code>8081</code> 指的是宿主机的开放端口,也就是本台服务器的开放端口.</p><blockquote><p>注意的是，需要先将防火墙关闭,可以通过以下命令查看防火墙状态</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">firewall-cmd --state<br></code></pre></td></tr></table></figure><p><code>80</code> 指的是启动的docker nginx服务对应的端口号, 也就是将启动的nginx镜像的80端口映射到宿主机的8081端口</p><p><code>-d</code> 指的是服务启动后在后台一直运行</p><p><code>nginx</code>指的是使用已安装镜像中的 nginx镜像</p><p>查看是否已启动成功:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker ps<br></code></pre></td></tr></table></figure><p>可以看到 <code>docker-nginx-test</code> 已在列表中</p><h2 id="访问docker-nginx-test容器内部"><a href="#访问docker-nginx-test容器内部" class="headerlink" title="访问docker-nginx-test容器内部"></a>访问docker-nginx-test容器内部</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec -it docker-nginx-test /bin/bash<br></code></pre></td></tr></table></figure><blockquote><p>这条命令将会在当前窗口开启一个 <code>docker-nginx-test</code> 容器的命令行输入界面，即可以操作该容器</p></blockquote><p>如果我们需要修改容器内的文件，则还需要单独安装vim</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">apt-get update<br>apt-get install vim -y<br></code></pre></td></tr></table></figure><p><code>-y</code> 指的是该命令执行中的所有操作默认输入 <code>y</code></p><blockquote><p>检测vim是否已安V装</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim --version<br></code></pre></td></tr></table></figure><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>通过访问 <code>[ip地址或者域名]:[端口号]</code> 即可访问到部署的nginx默认页面</p>]]></content>
    
    
    
    <tags>
      
      <tag>nginx</tag>
      
      <tag>docker</tag>
      
      <tag>centOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>shell自动化构建部署脚本</title>
    <link href="/2024/11/08/auto-build/"/>
    <url>/2024/11/08/auto-build/</url>
    
    <content type="html"><![CDATA[<h1 id="使用shell脚本自动化打包部署前端项目"><a href="#使用shell脚本自动化打包部署前端项目" class="headerlink" title="使用shell脚本自动化打包部署前端项目"></a>使用shell脚本自动化打包部署前端项目</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh</span><br><span class="hljs-comment"># 使用sh作为解释器  </span><br><span class="hljs-built_in">set</span> -e <span class="hljs-comment"># 当脚本执行出现错误立即退出</span><br><br><span class="hljs-comment"># 设置当脚本退出时打印异常信息</span><br><span class="hljs-built_in">trap</span> <span class="hljs-string">&#x27;echo &quot;退出: $?&quot;&#x27;</span> EXIT<br><br><span class="hljs-comment"># 获取当前时间</span><br>CURRENT_TIME=`<span class="hljs-built_in">date</span> <span class="hljs-string">&quot;+%Y%m%d%H%M&quot;</span>`<br><span class="hljs-comment"># 获取当前文件夹名称</span><br>SHELL_FOLDER=$(<span class="hljs-built_in">basename</span> $(<span class="hljs-built_in">pwd</span>))<br><span class="hljs-comment"># 使用文件夹名称以及当前时间作为压缩包名称</span><br>FILE_NAME=<span class="hljs-string">&quot;<span class="hljs-variable">$SHELL_FOLDER</span>-<span class="hljs-variable">$CURRENT_TIME</span>.zip&quot;</span><br><br><span class="hljs-comment"># 打包后的文件夹</span><br>FOLDER=<span class="hljs-string">&quot;dist&quot;</span> <br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;开始打包&quot;</span><br>npm run build<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;打包完成, 开始压缩文件&quot;</span><br><br><span class="hljs-comment"># 进入到dist文件目录内进行打包</span><br><span class="hljs-comment"># $(echo $(cd $FOLDER;ls)) 是获取文件夹下的所有文件</span><br>FILES=$(<span class="hljs-built_in">echo</span> $(<span class="hljs-built_in">cd</span> <span class="hljs-variable">$FOLDER</span>;<span class="hljs-built_in">ls</span>))<br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$FILES</span><br><br><span class="hljs-comment"># 跳转至打包后的文件目录进行压缩</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$FOLDER</span><br>zip -r <span class="hljs-variable">$FILE_NAME</span> <span class="hljs-variable">$FILES</span><br><br><span class="hljs-comment"># 移到项目根目录</span><br><span class="hljs-built_in">mv</span> <span class="hljs-variable">$FILE_NAME</span> ../<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;文件名为:<span class="hljs-variable">$FILE_NAME</span>&quot;</span><br><br><span class="hljs-comment"># 因为压缩的时候跳转到了dist目录内，所以需要跳转至上一层目录</span><br><span class="hljs-built_in">cd</span> ../<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;上传打包文件至服务器...&quot;</span><br><span class="hljs-comment"># 上传压缩包至服务器指定目录下</span><br>scp <span class="hljs-variable">$FILE_NAME</span> [服务器]:/www/wwwroot/home<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;上传完成，开始解压...&quot;</span><br><br><span class="hljs-comment"># 注意，unzip -o 是指覆盖原文件, 传递的文件只能是具体文件名</span><br><span class="hljs-comment"># 需要先cd到需要解压文件的目录下,再执行解压操作，否则会解压出问题</span><br><span class="hljs-comment"># 下面命令时远程操作服务器命令，分别是跳转至指定文件夹，然后解压对应文件，最后删除压缩包</span><br>ssh [服务器] <span class="hljs-string">&quot;cd /www/wwwroot/home &amp;&amp; unzip -o <span class="hljs-variable">$FILE_NAME</span> &amp;&amp; rm <span class="hljs-variable">$FILE_NAME</span>&quot;</span><br><br><span class="hljs-built_in">rm</span> <span class="hljs-variable">$FILE_NAME</span><br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;更新完成,请刷新网页查看效果&quot;</span><br><br></code></pre></td></tr></table></figure><h3 id="代码中的-服务器-是指服务器地址，最好是配置ssh免密登录，并在ssh的config文件中配置别名，方便连接使用"><a href="#代码中的-服务器-是指服务器地址，最好是配置ssh免密登录，并在ssh的config文件中配置别名，方便连接使用" class="headerlink" title="代码中的&#96;[服务器]是指服务器地址，最好是配置ssh免密登录，并在ssh的config文件中配置别名，方便连接使用"></a>代码中的&#96;[服务器]是指服务器地址，最好是配置ssh免密登录，并在ssh的config文件中配置别名，方便连接使用</h3><p>如下配置好之后代码中的<code>[服务器]</code>就可以替换为 [服务器代称]</p><h3 id="在-ssh-config-中进行配置"><a href="#在-ssh-config-中进行配置" class="headerlink" title="在 ~/.ssh/config 中进行配置"></a>在 <code>~/.ssh/config</code> 中进行配置</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Host</span><span class="hljs-meta"> [服务器代称]</span><br><span class="hljs-attribute">HostName</span><span class="hljs-meta"> [服务器ip]</span><br><span class="hljs-attribute">Port</span><span class="hljs-meta"> [服务器连接端口号]</span><br><span class="hljs-attribute">User</span><span class="hljs-meta"> [服务器用户名]</span><br><span class="hljs-attribute">IdentityFile</span><span class="hljs-meta"> [密钥路径]</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>build</tag>
      
      <tag>ssh</tag>
      
      <tag>scp</tag>
      
      <tag>zip</tag>
      
      <tag>unzip</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>xlsx-js</title>
    <link href="/2024/08/28/xlsx-js/"/>
    <url>/2024/08/28/xlsx-js/</url>
    
    <content type="html"><![CDATA[<h1 id="nodejs解析Excel表格"><a href="#nodejs解析Excel表格" class="headerlink" title="nodejs解析Excel表格"></a>nodejs解析Excel表格</h1><h3 id="解析excel可以说是工作中非常常用的一个功能，就简单叙述我工作中对excel文件进行解析的一个步骤吧"><a href="#解析excel可以说是工作中非常常用的一个功能，就简单叙述我工作中对excel文件进行解析的一个步骤吧" class="headerlink" title="解析excel可以说是工作中非常常用的一个功能，就简单叙述我工作中对excel文件进行解析的一个步骤吧"></a>解析excel可以说是工作中非常常用的一个功能，就简单叙述我工作中对excel文件进行解析的一个步骤吧</h3><ol><li><p>初始化项目，因为是一个简单的脚本，我们先创建一个文件夹存放js文件的, 再新建<code>index.js</code>, 然后执行<code>npm init</code>, 会自动生成<code>package.json</code>, 再执行安装<code>npm install xlsx</code>, 我们就可以开始解析excel文件了</p></li><li><p>以下就是解析excel文件并写入文件的简单示例代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> dayjs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;dayjs&#x27;</span>)<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">XLSX</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;xlsx&#x27;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);<br><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><br><span class="hljs-comment">// 替换为你的xlsx文件路径</span><br><span class="hljs-keyword">const</span> workbookPath = <span class="hljs-string">&#x27;/path/to/file&#x27;</span>;<br><br><span class="hljs-comment">// 读取xlsx文件  cellDates 表示时间类型的数据转换为时间格式，默认四展示1970年至时间日期的天数</span><br><span class="hljs-keyword">const</span> workbook = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-title function_">readFile</span>(workbookPath, &#123; <span class="hljs-attr">cellDates</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">dateNF</span>: <span class="hljs-string">&#x27;YYYY&quot;年&quot;MM&quot;月&quot;DD&#x27;</span> &#125;);<br><br><span class="hljs-comment">// 假设我们想要读取第一个工作表</span><br><span class="hljs-keyword">const</span> firstSheetName = workbook.<span class="hljs-property">SheetNames</span>[<span class="hljs-number">0</span>];<br><span class="hljs-keyword">const</span> worksheet = workbook.<span class="hljs-property">Sheets</span>[firstSheetName];<br><br><span class="hljs-comment">// 使用xlsx库的工具函数将工作表的数据转换为json对象数组</span><br><span class="hljs-comment">// 如果设置 raw: false, xlsx的时间格式会按照dateNF显示，但是数字类型会被转换为科学计数法显示</span><br><span class="hljs-comment">// 所以还是对时间格式使用dayjs直接转换</span><br><span class="hljs-comment">// header:1 表示第一行是标题行 将其去除掉</span><br><span class="hljs-comment">// reverse 是将数组倒序排列</span><br><span class="hljs-keyword">let</span> data = <span class="hljs-variable constant_">XLSX</span>.<span class="hljs-property">utils</span>.<span class="hljs-title function_">sheet_to_json</span>(worksheet, &#123; <span class="hljs-attr">header</span>:<span class="hljs-number">1</span>  &#125;).<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">reverse</span>();<br><span class="hljs-comment">// 指定文件路径</span><br><span class="hljs-keyword">const</span> filePath = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;data.json&#x27;</span>); <span class="hljs-comment">// __dirname是当前执行脚本所在的目录</span><br><br><span class="hljs-comment">// 2 表示多少个空格缩进</span><br><span class="hljs-keyword">const</span> jsonData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>);<br><span class="hljs-comment">// 写入文件</span><br>fs.<span class="hljs-title function_">writeFile</span>(filePath, jsonData, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;写入文件时发生错误:&#x27;</span>, err);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;JSON数据已成功写入文件&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure></li><li><p>需要注意的是，xlsx解析时间格式的数据时默认会返回1970年1月1日至今的天数,如果你想将其格式化，可以设置在readFile时设置<br><code>XLSX.readFile(workbookPath, &#123; cellDates: true, dateNF: &#39;YYYY&quot;年&quot;MM&quot;月&quot;DD&#39; &#125;);</code> dataNF属性，想要其生效，还需要在<br><code>XLSX.utils.sheet_to_json()</code>发放中的第二个配置参数中设置 <code>&#123; raw: false &#125;</code>, 但是大数字类型会被转换为科学计数法显示<br>所以想定义自己需要的时间格式，还是获取到时间之后使用dayjs进行转换，但是xlsx读取的时间数据会比获取到的时间少一天，需要处理一下<br>例如：<code>date: dayjs(_item[5]).add(1, &#39;days&#39;).format(&#39;YYYY年MM月DD日&#39;)</code></p></li><li><p>最后写完之后，将代码中的文件路径修改，终端跳转至当前目录，然后在命令行中执行<code>node index.js</code>即可运行</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>nodejs</tag>
      
      <tag>xlsx</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>playwright</title>
    <link href="/2024/05/14/playwright/"/>
    <url>/2024/05/14/playwright/</url>
    
    <content type="html"><![CDATA[<h1 id="微软超强爬虫工具，可用于Web页面自动化测试工具-—-Playwright"><a href="#微软超强爬虫工具，可用于Web页面自动化测试工具-—-Playwright" class="headerlink" title="微软超强爬虫工具，可用于Web页面自动化测试工具 — Playwright"></a>微软超强爬虫工具，可用于Web页面自动化测试工具 — Playwright</h1><h3 id="Playwright是微软在2020年初开源的新一代自动化测试工具。它的功能和Selenium、Pyppeteer等工具类似，可以驱动浏览器进行各种自动化操作。Playwright支持当前所有的主流浏览器，包括Chrome、Edge、Firefox、Safari等，并且支持浏览器有头和无头模式。此外，Playwright的安装和配置过程简单，会自动安装对应的浏览器和驱动，不需要额外配置WebDriver等。"><a href="#Playwright是微软在2020年初开源的新一代自动化测试工具。它的功能和Selenium、Pyppeteer等工具类似，可以驱动浏览器进行各种自动化操作。Playwright支持当前所有的主流浏览器，包括Chrome、Edge、Firefox、Safari等，并且支持浏览器有头和无头模式。此外，Playwright的安装和配置过程简单，会自动安装对应的浏览器和驱动，不需要额外配置WebDriver等。" class="headerlink" title="Playwright是微软在2020年初开源的新一代自动化测试工具。它的功能和Selenium、Pyppeteer等工具类似，可以驱动浏览器进行各种自动化操作。Playwright支持当前所有的主流浏览器，包括Chrome、Edge、Firefox、Safari等，并且支持浏览器有头和无头模式。此外，Playwright的安装和配置过程简单，会自动安装对应的浏览器和驱动，不需要额外配置WebDriver等。"></a>Playwright是微软在2020年初开源的新一代自动化测试工具。它的功能和Selenium、Pyppeteer等工具类似，可以驱动浏览器进行各种自动化操作。Playwright支持当前所有的主流浏览器，包括Chrome、Edge、Firefox、Safari等，并且支持浏览器有头和无头模式。此外，Playwright的安装和配置过程简单，会自动安装对应的浏览器和驱动，不需要额外配置WebDriver等。</h3><h3 id="Playwright支持多种编程语言，包括JavaScript、TypeScript、Python和Java，这使得开发人员可以使用他们喜欢的语言来编写自动化测试。"><a href="#Playwright支持多种编程语言，包括JavaScript、TypeScript、Python和Java，这使得开发人员可以使用他们喜欢的语言来编写自动化测试。" class="headerlink" title="Playwright支持多种编程语言，包括JavaScript、TypeScript、Python和Java，这使得开发人员可以使用他们喜欢的语言来编写自动化测试。"></a>Playwright支持多种编程语言，包括JavaScript、TypeScript、Python和Java，这使得开发人员可以使用他们喜欢的语言来编写自动化测试。</h3><h3 id="我是用的是JavaScript版本，主要介绍基于node的playwright的使用"><a href="#我是用的是JavaScript版本，主要介绍基于node的playwright的使用" class="headerlink" title="我是用的是JavaScript版本，主要介绍基于node的playwright的使用"></a>我是用的是JavaScript版本，主要介绍基于node的playwright的使用</h3><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1. 安装"></a>1. 安装</h3><pre><code class="hljs">可以通过使用npm来安装playwrightnpm install playwright -g将playwright安装在全局环境下，我们就可以直接使用playwright命令进行相关操作</code></pre><h3 id="2-功能介绍"><a href="#2-功能介绍" class="headerlink" title="2. 功能介绍"></a>2. 功能介绍</h3><pre><code class="hljs">  Usage: playwright [options] [command]  Options:    -V, --version                          output the version number    -h, --help                             display help for command  Commands:    open [options] [url]                   open page in browser specified via -b,                                          --browser    codegen [options] [url]                open page and generate code for user actions    install [options] [browser...]         ensure browsers necessary for this version of                                          Playwright are installed    install-deps [options] [browser...]    install dependencies necessary to run browsers                                          (will ask for sudo permissions)    cr [options] [url]                     open page in Chromium    ff [options] [url]                     open page in Firefox    wk [options] [url]                     open page in WebKit    screenshot [options] &lt;url&gt; &lt;filename&gt;  capture a page screenshot    pdf [options] &lt;url&gt; &lt;filename&gt;         save page as pdf    show-trace [options] [trace...]        show trace viewer    help [command]                         display help for command</code></pre><h3 id="3-自动代码生成指令"><a href="#3-自动代码生成指令" class="headerlink" title="3. 自动代码生成指令"></a>3. 自动代码生成指令</h3><pre><code class="hljs">  playwright codegen --target javascript -o &#39;playwright-baidu.js&#39; -b chromium https://www.baidu.com   // --target 生成脚本的语言，可选python、java、javascript等  // -o output输出脚本文件的名称  // -b 使用的浏览器内核,包含chromium、firefox、safari等</code></pre><h3 id="4-示例"><a href="#4-示例" class="headerlink" title="4. 示例"></a>4. 示例</h3><p><img src="/images/playwright/playwright-baidu.gif" alt="示例"></p><pre><code class="hljs">如图所示, 当在浏览器执行相关操作时，代码记录器会对应的生成相关代码，但是代码不是完全准确无误的，如果是实际使用脚本代码，还需要进行检查和修改，也可以添加自己需要代码才能完成的操作，总之很大的省去了很多时间和精力.</code></pre>]]></content>
    
    
    
    <tags>
      
      <tag>node</tag>
      
      <tag>playwright</tag>
      
      <tag>web自动化测试</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>uni-app 接入推送</title>
    <link href="/2023/12/21/uni-app-push/"/>
    <url>/2023/12/21/uni-app-push/</url>
    
    <content type="html"><![CDATA[<h3 id="uni-app-移动端app介入消息推送-本文只介绍安卓版本"><a href="#uni-app-移动端app介入消息推送-本文只介绍安卓版本" class="headerlink" title="uni-app 移动端app介入消息推送(本文只介绍安卓版本)"></a>uni-app 移动端app介入消息推送(本文只介绍安卓版本)</h3><ol><li><p>首先需要在<code>manifest.json</code>文件中的<code>App模块配置</code> 选中 <code>Push(消息推送)</code>, 离线推送需要对应厂商平台的密钥和key，作者并没有申请下来，所以暂时只针对在线推送</p><p><img src="/images/uni-app-push/uni-app-push-01.png" alt="天地图Key"></p></li><li><p>接着需要点击右侧的<code>申请开通</code>按钮, 此时会打开uni-app的配置推送应用的界面</p><p><img src="/images/uni-app-push/uni-app-push-02.png" alt="天地图Key"></p><ul><li><code>APPID</code> 可以在uni-app的<code>manifest.json</code>文件的基础配置模块看到</li><li><code>包名</code> 是打包app时命名的应用名称(建议测试版、正式版各打一个，使用不同的包名)</li><li><code>Android应用签名</code> 需要在应用管理内进行配置, 打包时使用的密钥文件内包含, 可以点击 <code>包名在“应用详情”中“各平台信息”管理，点击前往</code> 进行配置, uni-app 界面内都有详细的说明</li><li><code>关联服务空间</code>  需要在uniCloud中新建一个自己的云服务空间, 我这里申请的是阿里云免费的服务空间, 后续的推送管理端也需要该云空间填完这些信息提交修改即可</li></ul></li><li><p>完成上面这些步骤基本就已经配置完成了，当然<code>manifest.json</code>修改完成之后需要重新打包，记得包名要保持一致.完成了app相关配置还需要管理后台进行消息的发送<br>这时需要新建一个uni-admin 模板的项目,选择<code>文件&gt;新建&gt;项目&gt;un-app&gt;uni-admin</code>, 新建一个uni-admin 模板的项目,并添加<code>uni-push-admin</code>插件进项目中<br>这是一个web应用，管理uni-app应用的.</p></li><li><p>新的<code>uni-admin</code>以及添加<code>uni-push-admin</code> 完成之后, 启动项目时记得选中 <code>连接云端函数</code>.</p><p><img src="/images/uni-app-push/uni-app-push-03.png" alt="天地图Key"></p></li><li><p>项目启动之后需要先注册一个管理员账号, 注册完成登录,项目是这个样子的</p><p><img src="/images/uni-app-push/uni-app-push-04.png" alt="天地图Key"></p><p>项目添加并配置了<code>uni-push-admin</code>，但是看不到<code>推送管理</code>的菜单栏, 需要在<code>系统管理</code>下的<code>菜单管理进行添加</code></p></li><li><p>进入<code>推送管理 &gt; 消息推送</code>, 可以进行测试发送了</p><p><img src="/images/uni-app-push/uni-app-push-05.png" alt="天地图Key"></p><ul><li>如果<code>选择应用</code>中没有自己的应用，则需要在<code>系统管理 &gt; 应用管理</code>中进行添加</li><li>因为只开启了在线推送，所以需要将 <code>强制通知栏消息</code> 打开, 并且应用在设备上处于开启状态才会收到推送消息</li><li>接着填入必填信息即可进行推送消息的发送了</li></ul></li><li><p>小程序内的订阅消息需要审核，则需要单独配置，且需要接入后端服务。总的来说, uni-app的文档还是挺详细的，接入时候也不算麻烦，文章内具体提到的内容也算是我没有注意到的点，花费了些许时间.</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>uni-app</tag>
      
      <tag>push</tag>
      
      <tag>notification</tag>
      
      <tag>uni-app消息推送</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GeoServer发布tif格式的图层</title>
    <link href="/2023/10/31/geo-server/"/>
    <url>/2023/10/31/geo-server/</url>
    
    <content type="html"><![CDATA[<h2 id="GeoServer支持使用TIF图片作为空间数据的一种格式，可以通过上传、配置和调整参数等方式来使用TIF图片，并与地图和其他数据进行集成和发布。"><a href="#GeoServer支持使用TIF图片作为空间数据的一种格式，可以通过上传、配置和调整参数等方式来使用TIF图片，并与地图和其他数据进行集成和发布。" class="headerlink" title="GeoServer支持使用TIF图片作为空间数据的一种格式，可以通过上传、配置和调整参数等方式来使用TIF图片，并与地图和其他数据进行集成和发布。"></a>GeoServer支持使用TIF图片作为空间数据的一种格式，可以通过上传、配置和调整参数等方式来使用TIF图片，并与地图和其他数据进行集成和发布。</h2><h2 id="遥感图导出则为tif格式的，就可以上传至GeoServer进行发布，作为图层展示在地图上。"><a href="#遥感图导出则为tif格式的，就可以上传至GeoServer进行发布，作为图层展示在地图上。" class="headerlink" title="遥感图导出则为tif格式的，就可以上传至GeoServer进行发布，作为图层展示在地图上。"></a>遥感图导出则为tif格式的，就可以上传至GeoServer进行发布，作为图层展示在地图上。</h2><h2 id="1-首先，点击存储仓库，添加新的存储"><a href="#1-首先，点击存储仓库，添加新的存储" class="headerlink" title="1. 首先，点击存储仓库，添加新的存储"></a>1. 首先，点击存储仓库，添加新的存储</h2><p><img src="/images/geo_server/buzhou1.png" alt="步骤1"></p><p><img src="/images/geo_server/buzhou2.png" alt="步骤2"></p><h2 id="2-选择栅格数据源下的GeoTIFF"><a href="#2-选择栅格数据源下的GeoTIFF" class="headerlink" title="2. 选择栅格数据源下的GeoTIFF"></a>2. 选择栅格数据源下的GeoTIFF</h2><p><img src="/images/geo_server/buzhou3.png" alt="步骤3"></p><h2 id="3-为新图层命名并选择对应的tif图片"><a href="#3-为新图层命名并选择对应的tif图片" class="headerlink" title="3. 为新图层命名并选择对应的tif图片"></a>3. 为新图层命名并选择对应的tif图片</h2><p><img src="/images/geo_server/buzhou4.png" alt="步骤4"></p><h2 id="4-保存之后点击发布"><a href="#4-保存之后点击发布" class="headerlink" title="4. 保存之后点击发布"></a>4. 保存之后点击发布</h2><p><img src="/images/geo_server/buzhou5.png" alt="步骤5"></p><h2 id="5-发布页可以调整相关配置，比较特殊的地方在于Input-Transparent-Color，过滤掉图片的背景。如果tif图片有白色的背景就可以填入‘FFFFFF’过滤掉白色背景，否则图层会有一个背景框显示在地图上"><a href="#5-发布页可以调整相关配置，比较特殊的地方在于Input-Transparent-Color，过滤掉图片的背景。如果tif图片有白色的背景就可以填入‘FFFFFF’过滤掉白色背景，否则图层会有一个背景框显示在地图上" class="headerlink" title="5. 发布页可以调整相关配置，比较特殊的地方在于Input Transparent Color，过滤掉图片的背景。如果tif图片有白色的背景就可以填入‘FFFFFF’过滤掉白色背景，否则图层会有一个背景框显示在地图上"></a>5. 发布页可以调整相关配置，比较特殊的地方在于Input Transparent Color，过滤掉图片的背景。如果tif图片有白色的背景就可以填入‘FFFFFF’过滤掉白色背景，否则图层会有一个背景框显示在地图上</h2><p><img src="/images/geo_server/buzhou6.png" alt="步骤6"></p><h2 id="6-发布图层之后，接下来为图层切片缓存"><a href="#6-发布图层之后，接下来为图层切片缓存" class="headerlink" title="6. 发布图层之后，接下来为图层切片缓存"></a>6. 发布图层之后，接下来为图层切片缓存</h2><p><img src="/images/geo_server/buzhou7.png" alt="步骤7"></p><p><img src="/images/geo_server/buzhou8.png" alt="步骤8"></p><h2 id="7-zoom-start和zoom-stop根据地图的缩放控制来修改，缓存对应zoom级别的切片"><a href="#7-zoom-start和zoom-stop根据地图的缩放控制来修改，缓存对应zoom级别的切片" class="headerlink" title="7. zoom start和zoom stop根据地图的缩放控制来修改，缓存对应zoom级别的切片"></a>7. zoom start和zoom stop根据地图的缩放控制来修改，缓存对应zoom级别的切片</h2><p><img src="/images/geo_server/buzhou9.png" alt="步骤9"></p><h2 id="8-完成上述步骤即可进行预览"><a href="#8-完成上述步骤即可进行预览" class="headerlink" title="8. 完成上述步骤即可进行预览"></a>8. 完成上述步骤即可进行预览</h2><p><img src="/images/geo_server/buzhou10.png" alt="步骤10"></p><p><img src="/images/geo_server/buzhou11.png" alt="步骤11"></p><p><img src="/images/geo_server/buzhou12.png" alt="步骤12"></p>]]></content>
    
    
    
    <tags>
      
      <tag>GeoServer</tag>
      
      <tag>tif</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Vue中使用天地图</title>
    <link href="/2023/09/14/vue-tianditu/"/>
    <url>/2023/09/14/vue-tianditu/</url>
    
    <content type="html"><![CDATA[<h3 id="Vue3中简单使用天地图的示例"><a href="#Vue3中简单使用天地图的示例" class="headerlink" title="Vue3中简单使用天地图的示例"></a>Vue3中简单使用天地图的示例</h3><ol><li><p>首先是需要到天地图官网去注册账号并申请一个密钥，用于加载天地图的js文件。<br>创建并生成一个key<br> <img src="/images/tianditu_key.png" alt="天地图Key"></p></li><li><p>回到编辑器，首先需要添加一个div，让其能作为天地图的展示容器</p> <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;map&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;map&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br></code></pre></td></tr></table></figure><p> 需要为其设置宽高，否则地图无法显示</p></li><li><p>这里我们动态加载天地图的js，先实现一个动态加载js的方法</p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-params">url: string</span>) &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> script = globalThis.<span class="hljs-property">document</span>?.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;script&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!script) <span class="hljs-title function_">resolve</span>();<br>    script.<span class="hljs-property">src</span> = url;<br>    script.<span class="hljs-property">type</span> = <span class="hljs-string">&quot;text/javascript&quot;</span>;<br>    script.<span class="hljs-property">async</span> = <span class="hljs-literal">true</span>;<br>    script.<span class="hljs-property">defer</span> = <span class="hljs-literal">true</span>;<br>    script.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>();<br>    script.<span class="hljs-property">onerror</span> = <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> <span class="hljs-title function_">resolve</span>();<br>    globalThis.<span class="hljs-property">document</span>?.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(script);<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p> 该方法放在工具类中，加载任何动态脚本使用</p></li><li><p>接着就是初始化地图, 其中的v是指版本号，这里使用4.0版本，将v替换成4.0即可.<br>tk就是注册天地图账号时控制台中新增的应用密钥,将其替换为你注册的即可.<br>js加载成功之后会在全局window对象下挂载一个T对象，其就是天地图对象.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 加载天地图js, </span><br><span class="hljs-keyword">await</span> <span class="hljs-title function_">loadScript</span>(<span class="hljs-string">`https://api.tianditu.gov.cn/api?v=<span class="hljs-subst">$&#123;v&#125;</span>&amp;tk=<span class="hljs-subst">$&#123;tk&#125;</span>`</span>);<br><span class="hljs-comment">// 实例化天地图，</span><br><span class="hljs-comment">// 参数 ‘map’ 即对应div的id</span><br><span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">T</span>.<span class="hljs-title function_">map</span>(<span class="hljs-string">&#x27;map&#x27;</span>, &#123;<br>     <span class="hljs-attr">center</span>: [<span class="hljs-number">116.397428</span>, <span class="hljs-number">39.90923</span>], <span class="hljs-comment">// 中心点坐标  </span><br>     <span class="hljs-attr">zoom</span>: <span class="hljs-number">13</span>, <span class="hljs-comment">// 缩放级别  </span><br>     <span class="hljs-attr">roam</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启鼠标缩放和平移交互</span><br>     <span class="hljs-attr">zoomControl</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启缩放控件  </span><br>     <span class="hljs-attr">scaleControl</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启比例尺控件  </span><br>     <span class="hljs-attr">dragging</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启拖拽漫游  </span><br>     <span class="hljs-attr">navigation</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启地图平移和缩放控件  </span><br>&#125;);<br><span class="hljs-comment">// 添加矢量地图图层</span><br><span class="hljs-keyword">const</span> layer = <span class="hljs-keyword">new</span> T.<span class="hljs-title class_">TileLayer</span>(<span class="hljs-string">`https://t0.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&amp;REQUEST=GetTile&amp;VERSION=1.0.0&amp;LAYER=img&amp;STYLE=default&amp;TILEMATRIXSET=w&amp;FORMAT=tiles&amp;TILEMATRIX=&#123;z&#125;&amp;TILEROW=&#123;y&#125;&amp;TILECOL=&#123;x&#125;&amp;tk=<span class="hljs-subst">$&#123;tk&#125;</span>`</span>)<br>map.<span class="hljs-title function_">addLayer</span>(layer)<br></code></pre></td></tr></table></figure><p>到这里，就可以看到天地图的卫星地图显示在页面上了</p></li><li><p>如果要使用到CarTrack，则需要单独引入d3、D3SvgOverlay、CarTrack</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">CarTrackScripts</span> = [<br>   <span class="hljs-string">&quot;https://cdn.bootcss.com/d3/3.5.17/d3.min.js&quot;</span>,<br>   <span class="hljs-string">&quot;https://tianditu.lztl.cn/api/js4.0/opensource/openlibrary/D3SvgOverlay.min.js&quot;</span>,<br>   <span class="hljs-string">&quot;https://tianditu.lztl.cn/api/js4.0/opensource/openlibrary/CarTrack.min.js&quot;</span><br>]<br><span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<br> <span class="hljs-title function_">loadScript</span>(<span class="hljs-title class_">CarTrackScripts</span>[<span class="hljs-number">0</span>]), <span class="hljs-title function_">loadScript</span>(<span class="hljs-title class_">CarTrackScripts</span>[<span class="hljs-number">1</span>]), <span class="hljs-title function_">loadScript</span>(<span class="hljs-title class_">CarTrackScripts</span>[<span class="hljs-number">2</span>])<br>])<br><span class="hljs-keyword">const</span> <span class="hljs-attr">opt</span>: T.<span class="hljs-property">CarOverlayOptions</span> = &#123;<br>   <span class="hljs-attr">interval</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// 小车移动的间隔 ms</span><br>   <span class="hljs-attr">speed</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 小车移动的速度</span><br>   <span class="hljs-attr">dynamicLine</span>: <span class="hljs-literal">true</span>,<br>   <span class="hljs-attr">carstyle</span>: &#123; <span class="hljs-comment">// 移动小车图标样式</span><br>     <span class="hljs-attr">display</span>: <span class="hljs-literal">true</span>,<br>     <span class="hljs-attr">iconUrl</span>: <span class="hljs-string">&#x27;car.png&#x27;</span>, <span class="hljs-comment">// car图标</span><br>     <span class="hljs-attr">width</span>: <span class="hljs-number">10</span>,<br>     <span class="hljs-attr">height</span>: <span class="hljs-number">10</span><br>   &#125;,<br>   <span class="hljs-attr">polylinestyle</span>: &#123; <span class="hljs-attr">display</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;red&#x27;</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">opacity</span>: <span class="hljs-number">1</span>, &#125;, <span class="hljs-comment">// 移动轨迹路线样式</span><br>   <span class="hljs-title class_">Datas</span>: props.<span class="hljs-property">trackDatas</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">pos</span>) =&gt;</span> <span class="hljs-title function_">toLngLat</span>(pos)),<br>   <span class="hljs-attr">passOneNode</span>: handleCarMove <span class="hljs-comment">// 小车移动时触发的回调函数，返回Lnglat以及index</span><br>&#125;<br><span class="hljs-comment">// 初始化CarTrack对象，参数map为上一步创建的window.T.map对象实例</span><br><span class="hljs-keyword">const</span> carTrack = <span class="hljs-keyword">new</span> T.<span class="hljs-title class_">CarTrack</span>(map, opt)<br> <br>carTrack.<span class="hljs-title function_">start</span>() <span class="hljs-comment">// 开始移动</span><br>carTrack.<span class="hljs-title function_">pause</span>() <span class="hljs-comment">// 暂停移动</span><br>carTrack.<span class="hljs-title function_">resume</span>() <span class="hljs-comment">// 继续移动</span><br>carTrack.<span class="hljs-title function_">stop</span>() <span class="hljs-comment">// 停止移动</span><br>carTrack.<span class="hljs-title function_">clear</span>() <span class="hljs-comment">// 清除移动轨迹</span><br></code></pre></td></tr></table></figure></li><li><p>添加天地图控制类组件, map为天地图对象的实例</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> ctrlMapType = <span class="hljs-keyword">new</span> T.<span class="hljs-property">Control</span>.<span class="hljs-title class_">MapType</span>(&#123;<br> <span class="hljs-attr">mapTypes</span>: [&#123;<br>   <span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;地图&#x27;</span>,<br>   <span class="hljs-string">&#x27;icon&#x27;</span>: <span class="hljs-string">&#x27;https://api.tianditu.gov.cn/v4.0/image/map/maptype/vector.png&#x27;</span>,<br>   <span class="hljs-string">&#x27;layer&#x27;</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">TMAP_NORMAL_MAP</span><br> &#125;, &#123;<br>   <span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;卫星&#x27;</span>,<br>   <span class="hljs-string">&#x27;icon&#x27;</span>: <span class="hljs-string">&#x27;https://api.tianditu.gov.cn/v4.0/image/map/maptype/satellite.png&#x27;</span>,<br>   <span class="hljs-string">&#x27;layer&#x27;</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">TMAP_SATELLITE_MAP</span><br> &#125;, &#123;<br>   <span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;卫星混合&#x27;</span>,<br>   <span class="hljs-string">&#x27;https&#x27;</span>: <span class="hljs-string">&#x27;api.tianditu.gov.cn/v4.0/image/map/maptype/satellitepoi.png&#x27;</span>,<br>   <span class="hljs-string">&#x27;layer&#x27;</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">TMAP_HYBRID_MAP</span><br> &#125;, &#123;<br>   <span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;地形&#x27;</span>,<br>   <span class="hljs-string">&#x27;icon&#x27;</span>: <span class="hljs-string">&#x27;https://api.tianditu.gov.cn/v4.0/image/map/maptype/terrain.png&#x27;</span>,<br>   <span class="hljs-string">&#x27;layer&#x27;</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">TMAP_TERRAIN_MAP</span><br> &#125;, &#123;<br>   <span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;地形混合&#x27;</span>,<br>   <span class="hljs-string">&#x27;icon&#x27;</span>: <span class="hljs-string">&#x27;https://api.tianditu.gov.cn/v4.0/image/map/maptype/terrainpoi.png&#x27;</span>,<br>   <span class="hljs-string">&#x27;layer&#x27;</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">TMAP_TERRAIN_HYBRID_MAP</span><br> &#125;]<br>&#125;);<br><span class="hljs-comment">// 添加地图类型选择控件</span><br>map.<span class="hljs-title function_">addControl</span>(ctrlMapType)<br></code></pre></td></tr></table></figure></li><li><p>天地图还有很多工具可以使用，具体可以参考天地图官网api. </p><p><a href="http://lbs.tianditu.gov.cn/api/js4.0/class.html">天地图Api4.0类参考</a></p><p><a href="http://lbs.tianditu.gov.cn/api/js4.0/class.html">http://lbs.tianditu.gov.cn/api/js4.0/class.html</a></p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>vue</tag>
      
      <tag>天地图</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VsCode快速生成Vue3默认用户片段</title>
    <link href="/2023/08/24/vue3-init-md/"/>
    <url>/2023/08/24/vue3-init-md/</url>
    
    <content type="html"><![CDATA[<h4 id="使用VsCode开发Vue项目的时候，有个Vue-Snippets的插件，其中的VueInit命令可以默认生成一段Vue文件的基础模板"><a href="#使用VsCode开发Vue项目的时候，有个Vue-Snippets的插件，其中的VueInit命令可以默认生成一段Vue文件的基础模板" class="headerlink" title="使用VsCode开发Vue项目的时候，有个Vue Snippets的插件，其中的VueInit命令可以默认生成一段Vue文件的基础模板"></a>使用VsCode开发Vue项目的时候，有个Vue Snippets的插件，其中的VueInit命令可以默认生成一段Vue文件的基础模板</h4><h4 id="但是和自己的使用习惯不太一致，而且和Vue3也不是很搭配"><a href="#但是和自己的使用习惯不太一致，而且和Vue3也不是很搭配" class="headerlink" title="但是和自己的使用习惯不太一致，而且和Vue3也不是很搭配"></a>但是和自己的使用习惯不太一致，而且和Vue3也不是很搭配</h4><h4 id="所以就想着自己创建一个命令，可以符合自己的预期-然后就研究了一下"><a href="#所以就想着自己创建一个命令，可以符合自己的预期-然后就研究了一下" class="headerlink" title="所以就想着自己创建一个命令，可以符合自己的预期, 然后就研究了一下"></a>所以就想着自己创建一个命令，可以符合自己的预期, 然后就研究了一下</h4><ol><li><h3 id="首先是VsCode中按下-cmd-shift-p-键，打开VsCode的配置搜索框，输入Config-Use-Snippets-选中并点击"><a href="#首先是VsCode中按下-cmd-shift-p-键，打开VsCode的配置搜索框，输入Config-Use-Snippets-选中并点击" class="headerlink" title="首先是VsCode中按下 cmd + shift + p 键，打开VsCode的配置搜索框，输入Config Use Snippets, 选中并点击"></a>首先是VsCode中按下 <code>cmd + shift + p</code> 键，打开VsCode的配置搜索框，输入<code>Config Use Snippets</code>, 选中并点击</h3></li><li><h3 id="点击之后会出现让你选择修改或新建一个snippet-这里我们选择新建一个全局的-global-输入框输入要创建的用户片段的名称之后回车就可以"><a href="#点击之后会出现让你选择修改或新建一个snippet-这里我们选择新建一个全局的-global-输入框输入要创建的用户片段的名称之后回车就可以" class="headerlink" title="点击之后会出现让你选择修改或新建一个snippet, 这里我们选择新建一个全局的 global, 输入框输入要创建的用户片段的名称之后回车就可以"></a>点击之后会出现让你选择修改或新建一个<code>snippet</code>, 这里我们选择新建一个全局的 <code>global</code>, 输入框输入要创建的用户片段的名称之后回车就可以</h3></li><li><h3 id="创建成功之后会出现其配置文件，这是我修改过后的"><a href="#创建成功之后会出现其配置文件，这是我修改过后的" class="headerlink" title="创建成功之后会出现其配置文件，这是我修改过后的:"></a>创建成功之后会出现其配置文件，这是我修改过后的:</h3> <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;Init Vue3 template&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;prefix&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Vue3Init&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;body&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;&lt;template&gt;&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;  &lt;div&gt;&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;    &quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;  &lt;/div&gt;&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;&lt;/template&gt;&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;&lt;script lang=\&quot;ts\&quot; setup&gt;&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;defineOptions(&#123; name: \&quot;$&#123;TM_DIRECTORY/(.*\\/)([^\\/]+)/$&#123;2:/capitalize&#125;/&#125;\&quot; &#125;)&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;  &quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;&lt;/script&gt;&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;&lt;style lang=\&quot;scss\&quot; scoped&gt;&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;  &quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-string">&quot;&lt;/style&gt;&quot;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Init Vue3 Template By Default&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p> <code>Init Vue3 template</code> 模板名称</p><p> <code>scope</code> 模板命令生效的范围 “” 表示所有文件都生效, 可选 ‘javascript, typescript, vue, html’等等等</p><p> <code>prefix</code> 使用该模板时需要敲击的命令, 例如在新文件中敲下 Vue3Init 就会生成该模板</p><p> <code>body</code> 使用<code>Vue3Init</code> 命令户生成的内容</p><p> <code>description</code> 描述信息</p></li><li><h3 id="defineOptions说明"><a href="#defineOptions说明" class="headerlink" title="defineOptions说明:"></a>defineOptions说明:</h3><h4 id="TM-DIRECTORY-2-capitalize-其中这段代码的意思是使用正则取当前文件目录名称"><a href="#TM-DIRECTORY-2-capitalize-其中这段代码的意思是使用正则取当前文件目录名称" class="headerlink" title="${TM_DIRECTORY/(.*\\/)([^\\/]+)/${2:/capitalize}/} 其中这段代码的意思是使用正则取当前文件目录名称"></a><code>$&#123;TM_DIRECTORY/(.*\\/)([^\\/]+)/$&#123;2:/capitalize&#125;/&#125;</code> 其中这段代码的意思是使用正则取当前文件目录名称</h4><h4 id="并将其首字母大写，因为我的vue项目的文件目录结构是-fileName-index-vue-所以需要将其转换为FileName用于组件的名称"><a href="#并将其首字母大写，因为我的vue项目的文件目录结构是-fileName-index-vue-所以需要将其转换为FileName用于组件的名称" class="headerlink" title="并将其首字母大写，因为我的vue项目的文件目录结构是/fileName/index.vue, 所以需要将其转换为FileName用于组件的名称"></a>并将其首字母大写，因为我的vue项目的文件目录结构是<code>/fileName/index.vue</code>, 所以需要将其转换为<code>FileName</code>用于组件的名称</h4></li><li><h3 id="VsCode的一些内置变量"><a href="#VsCode的一些内置变量" class="headerlink" title="VsCode的一些内置变量:"></a>VsCode的一些内置变量:</h3><p> ${TM_DIRECTORY}：当前文件的目录路径。</p><p> ${TM_FILEPATH}：当前文件的完整路径，包括文件名。</p><p> ${TM_FILENAME}：当前文件的完整文件名（包括扩展名）。</p><p> ${TM_FILENAME_BASE}：当前文件的基本文件名（不包括扩展名）。</p><p> ${TM_SELECTED_TEXT}：选定的文本内容（如果有选定的文本）。</p><p> ${TM_CURRENT_LINE}：当前所在行的内容。</p><p> ${TM_CURRENT_WORD}：当前光标所在位置的单词。</p><p> ${TM_LINE_INDEX}：当前行的索引（从0开始）。</p><p> ${TM_LINE_NUMBER}：当前行的行号（从1开始）。</p><p> ${TM_SOFT_TABS}：当前文件是否使用软制表符。</p><p> ${TM_TAB_SIZE}：当前文件的制表符大小（空格数）。</p><p> ${TM_FULLNAME}：当前用户的完整名称。</p><p> ${CLIPBOARD}：剪贴板的内容。</p></li></ol>]]></content>
    
    
    
    <tags>
      
      <tag>vscode</tag>
      
      <tag>vue3</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ssh配置快捷连接服务器</title>
    <link href="/2023/08/21/ssh-default-md/"/>
    <url>/2023/08/21/ssh-default-md/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">Host myserver<br>    HostName [ip_address] # 服务器ip地址<br>    User [user_name] # 服务器登录的账户名称<br>    IdentityFile ~/.ssh/id_rsa # ssh生成的密钥文件地址<br>    PreferredAuthentications publickey<br>    AddKeysToAgent yes<br><br></code></pre></td></tr></table></figure><p><code>PreferredAuthentications</code> 是一个用于配置 SSH 客户端首选身份验证方式的选项。它允许你指定客户端在连接远程服务器时首选的身份验证方式顺序。SSH 支持多种身份验证方式，如密码、公钥、GSSAPI 等。</p><p>如果需要同时支持多种身份验证方式，可以使用逗号分隔它们：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">PreferredAuthentications publickey,password<br></code></pre></td></tr></table></figure><p><code>AddKeysToAgent</code> 是一个用于配置 SSH 客户端是否将密钥添加到 SSH 代理（如 ssh-agent）中的选项。SSH 代理可以管理你的私钥，允许你在登录后只需要输入一次密码即可在整个会话中使用私钥。</p><p>默认情况下，SSH 客户端不会自动将密钥添加到代理中。如果你想在每次登录时将密钥添加到代理，可以在 SSH 配置文件中添加以下行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">AddKeysToAgent <span class="hljs-built_in">yes</span><br></code></pre></td></tr></table></figure><p>这样，在登录时会提示你输入私钥的密码，并将私钥添加到代理中，以后不再需要重复输入密码。</p><p>还有ssh配置github、gitee、gitlab连接的示例:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">Default gitHub user Self</span><br>Host github.com<br>  HostName github.com<br>  User [stanlee1226@gmail.com] # email<br>  PreferredAuthentications publickey<br>  IdentityFile ~/.ssh/id_rsa.github<br>  AddKeysToAgent yes<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">Add gitee user</span><br>Host gitee.com<br>  HostName gitee.com<br>  User [stanlee1226@gmail.com] #email<br>  PreferredAuthentications publickey<br>  IdentityFile ~/.ssh/id_rsa.gitee<br>  AddKeysToAgent yes<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">Add gitlab user</span><br>Host git@[ip_address]<br>  HostName [ip_address]<br>  Port [port]<br>  User [account]<br>  PreferredAuthentications publickey<br>  IdentityFile ~/.ssh/id_rsa.gitlab<br>  AddKeysToAgent yes<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>ssh</tag>
      
      <tag>github</tag>
      
      <tag>gitlab</tag>
      
      <tag>gitee</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用ssh免密连接服务器</title>
    <link href="/2023/08/09/ssh-connect-service/"/>
    <url>/2023/08/09/ssh-connect-service/</url>
    
    <content type="html"><![CDATA[<ol><li><p>首先需要生成ssh密钥，类似于连接github、gitee的ssh密钥。<br>密钥文件默认生成在 ~&#x2F;.ssh&#x2F; 文件夹下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-keygen -t rsa -f [file_name]<br><span class="hljs-meta prompt_"># </span><span class="language-bash">-t 指定加密方式, 有rsa 和 dsa, 通常默认使用rsa就好</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">-f 指定生成密钥文件的名称, 默认生成的是id_rsa, 但是可能会有多个密钥文件</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">所以需要指定一个名称, 例如 id_rsa.[server_name]</span><br><br></code></pre></td></tr></table></figure></li><li><p>执行<code>ssk-keygen</code>之后，会出现</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">Generating public/private rsa key pair.<br>Enter passphrase (empty for no passphrase):<br>Enter same passphrase again:<br>Your identification has been saved in id_rsa.[server_name]<br>Your public key has been saved in id_rsa.[server_name].pub<br>The key fingerprint is:<br><span class="hljs-meta prompt_"># </span><span class="language-bash">这里是提示输入使用密钥文件时的密码，可以设置为空，直接回车就是</span><br></code></pre></td></tr></table></figure></li><li><p>文件生成之后，需要修改其权限，避免服务器验证密钥无法读取</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo chmod 600 ~/.ssh/id_rsa.[server_name] ~/.ssh/id_rsa.[server_name].pub<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">600 表示文件拥有者对该文件有读写的权限，其他用户无权限</span><br></code></pre></td></tr></table></figure></li><li><p>密钥文件生成且权限修改之后将.pub后缀的公钥文件上传至服务器.<br>上传成功之后, 会在服务器的<code>~/.ssh/authorized_keys</code> 文件中添加一条公钥记录<br>如果后续验证失败可以看看该文件内的内容是否有冲突</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh-copy-id -i ~/.ssh/id_rsa.[server_name].pub -p [port] [name]@[server_ip]<br><span class="hljs-meta prompt_"># </span><span class="language-bash">-i 指定要上传的公钥文件</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">-p 服务器开放端口号</span><br></code></pre></td></tr></table></figure></li><li><p>配置完成之后可以开始免密连接服务器了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh -i ~/.ssh/id_rsa.[server_name] -p [port] [name]@[server_ip]<br><span class="hljs-meta prompt_"># </span><span class="language-bash">-i 指定连接服务器时使用的私钥文件</span><br></code></pre></td></tr></table></figure></li></ol><p>ok， 至此最基础的ssh免密连接服务器就完成了</p>]]></content>
    
    
    
    <tags>
      
      <tag>ssh</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>nginx 部署 vue应用 server基本配置</title>
    <link href="/2023/08/04/nginx-veu-server-md/"/>
    <url>/2023/08/04/nginx-veu-server-md/</url>
    
    <content type="html"><![CDATA[<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>  <span class="hljs-attribute">listen</span>   <span class="hljs-number">18080</span>; <span class="hljs-comment"># 监听的端口号,需要在防火墙中开启</span><br>  <span class="hljs-attribute">server_name</span>  _; <span class="hljs-comment"># server_name指令配置为_，则表示该虚拟主机将接受所有域名和主机名的请求。</span><br><br>  <span class="hljs-section">location</span> / &#123; <span class="hljs-comment"># 用于匹配对根目录的请求</span><br>    <span class="hljs-attribute">root</span> /usr/share/nginx/dist; <span class="hljs-comment"># 项目build之后存放的文件夹</span><br>    <span class="hljs-attribute">try_files</span> <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ /index.html; <span class="hljs-comment"># 指令用于尝试请求的文件或目录，如果找不到，则返回 index.html</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>nginx</tag>
      
      <tag>vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>git操作常用命令说明</title>
    <link href="/2023/08/02/git-operation-md/"/>
    <url>/2023/08/02/git-operation-md/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git status<br></code></pre></td></tr></table></figure><p>查看当前git目录下文件的修改情况</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git diff &#123;file&#125;<br></code></pre></td></tr></table></figure><p>查看文件修改了什么内容， 不指定文件默认显示全部修改过的文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout . / &#123;file&#125;<br></code></pre></td></tr></table></figure><p>撤回修改，当为 . 时， 撤销所有的修改，除了新添加的文件。当指定文件时只撤销该文件的修改</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git checkout -b &#123;branch_name&#125;<br></code></pre></td></tr></table></figure><p>新建一个分支, 当没有 -b 时，指定分支名则为切换分支</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git pull<br></code></pre></td></tr></table></figure><p>拉取远程仓库最新代码到当前分支</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git push<br></code></pre></td></tr></table></figure><p>推送当前分支commit到远程分支</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git rebase &#123;branch_name&#125;<br></code></pre></td></tr></table></figure><p>同步分支代码时建议使用，会保持commit记录干净整洁<br>使当前仓库的commit与指定分支进行同步，只会更新当前分支的commit，与主分支无关<br>当出现冲突时，会进入到rebase进度, git status会发现有修改了的文件，其中有冲突，并将冲突解决<br>解决之后使用<code>git add .</code>  然后 <code>git rebase --continue</code>继续rebase.<br>直到分支正常切换到当前分支下。如果中途不想继续rebase可以使用<code>git rebase --abort</code>中断rebase操作</p>]]></content>
    
    
    
    <tags>
      
      <tag>git</tag>
      
      <tag>rebase</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>使用canvas绘制扇形</title>
    <link href="/2023/08/02/canvas-arc-md/"/>
    <url>/2023/08/02/canvas-arc-md/</url>
    
    <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;box&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;500&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;500&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">     <span class="hljs-keyword">const</span> colors = [</span><br><span class="language-javascript">      <span class="hljs-string">&quot;red&quot;</span>, <span class="hljs-comment">// 浅灰色</span></span><br><span class="language-javascript">      <span class="hljs-string">&quot;#FAFAD2&quot;</span>, <span class="hljs-comment">// 浅黄色</span></span><br><span class="language-javascript">      <span class="hljs-string">&quot;#9ACD32&quot;</span>, <span class="hljs-comment">// 浅绿色</span></span><br><span class="language-javascript">      <span class="hljs-string">&quot;#FFE4B5&quot;</span>, <span class="hljs-comment">// 浅粉色</span></span><br><span class="language-javascript">      <span class="hljs-string">&quot;#FFFACD&quot;</span>, <span class="hljs-comment">// 浅黄粉色</span></span><br><span class="language-javascript">      <span class="hljs-string">&quot;#B2DFEE&quot;</span>, <span class="hljs-comment">// 浅蓝色</span></span><br><span class="language-javascript">      <span class="hljs-string">&quot;#E1BEE7&quot;</span>, <span class="hljs-comment">// 浅蓝绿色</span></span><br><span class="language-javascript">      <span class="hljs-string">&quot;#F8BBD0&quot;</span>, <span class="hljs-comment">// 浅橙色</span></span><br><span class="language-javascript">      <span class="hljs-string">&quot;#19CAAD&quot;</span>, <span class="hljs-comment">// 浅橙红色</span></span><br><span class="language-javascript">      <span class="hljs-string">&quot;#FFDEAD&quot;</span>, <span class="hljs-comment">// 浅黄棕色</span></span><br><span class="language-javascript">    ];</span><br><span class="language-javascript">    <span class="hljs-comment">/**</span></span><br><span class="hljs-comment"><span class="language-javascript">     *获取扇形的中心点 </span></span><br><span class="hljs-comment"><span class="language-javascript">     * center &#123; x, y &#125; </span></span><br><span class="hljs-comment"><span class="language-javascript">     * radius 半径</span></span><br><span class="hljs-comment"><span class="language-javascript">     * startAngle 开始角度</span></span><br><span class="hljs-comment"><span class="language-javascript">     * endAngle 结束角度</span></span><br><span class="hljs-comment"><span class="language-javascript">     */</span></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">getArcMidpoint</span>(<span class="hljs-params">center, radius, startAngle, endAngle</span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> x = center.<span class="hljs-property">x</span> + radius * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">cos</span>((startAngle + endAngle) / <span class="hljs-number">2</span>);</span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> y = center.<span class="hljs-property">y</span> + radius * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sin</span>((startAngle + endAngle) / <span class="hljs-number">2</span>);</span><br><span class="language-javascript">      <span class="hljs-keyword">return</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-attr">x</span>: x,</span><br><span class="language-javascript">        <span class="hljs-attr">y</span>: y</span><br><span class="language-javascript">      &#125;;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript">    <span class="hljs-comment">// 绘制扇形</span></span><br><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderArc</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">      <span class="hljs-comment">// 默认画十个扇形组成一个圆</span></span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> length = <span class="hljs-number">10</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;box&#x27;</span>);</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">&#x27;2d&#x27;</span>);</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> x = canvas.<span class="hljs-property">width</span> * <span class="hljs-number">.5</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> y = canvas.<span class="hljs-property">height</span> * <span class="hljs-number">.5</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">const</span> radius = canvas.<span class="hljs-property">width</span> * <span class="hljs-number">.5</span>;</span><br><span class="language-javascript">      <span class="hljs-comment">// 第一个扇形的开始度数为垂直方向，-90度再减去扇形的一半度数</span></span><br><span class="language-javascript">      <span class="hljs-keyword">let</span> beginAngel = -(<span class="hljs-number">90</span> + (<span class="hljs-number">360</span> / length) / <span class="hljs-number">2</span>) * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>;i&lt; length;i+=<span class="hljs-number">1</span>) &#123;</span><br><span class="language-javascript">        ctx.<span class="hljs-title function_">beginPath</span>();</span><br><span class="language-javascript">        ctx.<span class="hljs-title function_">save</span>();</span><br><span class="language-javascript">        <span class="hljs-comment">// canvas的填充色</span></span><br><span class="language-javascript">        ctx.<span class="hljs-property">fillStyle</span> = colors[i];</span><br><span class="language-javascript">        <span class="hljs-comment">// 画笔转移到圆形中心位置，也就是起点</span></span><br><span class="language-javascript">        ctx.<span class="hljs-title function_">moveTo</span>(x, y);</span><br><span class="language-javascript">        <span class="hljs-comment">// 圆的总量为1, 每一个扇形就是 1/length, 乘以360是让其顺时针旋转</span></span><br><span class="language-javascript">        <span class="hljs-comment">// 其实arc最后一个参数设为true也是顺时针旋转</span></span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> tempAngle = <span class="hljs-number">1</span> / length * <span class="hljs-number">360</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>;</span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> endAngel = tempAngle + beginAngel;</span><br><span class="language-javascript">        ctx.<span class="hljs-title function_">arc</span>(x, y, radius, beginAngel, endAngel);</span><br><span class="language-javascript">        ctx.<span class="hljs-title function_">fill</span>();</span><br><span class="language-javascript">        <span class="hljs-comment">// 扇形绘制完成之后重置画笔</span></span><br><span class="language-javascript">        ctx.<span class="hljs-title function_">restore</span>();</span><br><span class="language-javascript">        ctx.<span class="hljs-title function_">save</span>();</span><br><span class="language-javascript">        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">&#x27;black&#x27;</span>;</span><br><span class="language-javascript">        ctx.<span class="hljs-property">font</span> = <span class="hljs-string">&#x27;50px Aria&#x27;</span>;</span><br><span class="language-javascript">        ctx.<span class="hljs-property">fontWeight</span> = <span class="hljs-string">&#x27;500&#x27;</span>;</span><br><span class="language-javascript">        <span class="hljs-comment">// 设置扇形中文字在扇形中心点上</span></span><br><span class="language-javascript">        <span class="hljs-keyword">const</span> point = <span class="hljs-title function_">getArcMidpoint</span>(&#123;x, y&#125;, <span class="hljs-number">200</span>, beginAngel, endAngel);</span><br><span class="language-javascript">        <span class="hljs-comment">// 绘制文字，x y坐标为必填</span></span><br><span class="language-javascript">        ctx.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;i + <span class="hljs-number">1</span>&#125;</span>`</span>, point.<span class="hljs-property">x</span> - <span class="hljs-number">10</span>, point.<span class="hljs-property">y</span> + <span class="hljs-number">10</span>);</span><br><span class="language-javascript">        ctx.<span class="hljs-title function_">restore</span>();</span><br><span class="language-javascript">        <span class="hljs-comment">// 下一个扇形的开始角度为上一个扇形的结束角度</span></span><br><span class="language-javascript">        beginAngel = endAngel;</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><br><span class="language-javascript">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/css&quot;</span>&gt;</span><span class="language-css"></span><br><span class="language-css">      <span class="hljs-selector-tag">body</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">display</span>: flex;</span><br><span class="language-css">        <span class="hljs-attribute">align-items</span>: center;</span><br><span class="language-css">        <span class="hljs-attribute">justify-content</span>: center;</span><br><span class="language-css">        <span class="hljs-attribute">border</span>: none;</span><br><span class="language-css">        <span class="hljs-attribute">outline</span>: none;</span><br><span class="language-css">      &#125;</span><br><span class="language-css">      <span class="hljs-selector-class">.outer</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">0</span> <span class="hljs-number">200px</span> <span class="hljs-number">200px</span> <span class="hljs-number">0</span>;</span><br><span class="language-css">        <span class="hljs-attribute">background-color</span>: blue;</span><br><span class="language-css">        <span class="hljs-comment">/* overflow: hidden; */</span></span><br><span class="language-css">      &#125;</span><br><span class="language-css">      <span class="hljs-selector-class">.inner</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">width</span>: <span class="hljs-number">200px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(-<span class="hljs-number">200px</span>) <span class="hljs-built_in">rotate</span>(<span class="hljs-number">72deg</span>);</span><br><span class="language-css">        <span class="hljs-attribute">background-color</span>: lightgray;</span><br><span class="language-css">        <span class="hljs-attribute">transform-origin</span>: right center;</span><br><span class="language-css">        <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.5</span>; </span><br><span class="language-css">      &#125;</span><br><span class="language-css">      <span class="hljs-selector-class">.inner</span> <span class="hljs-selector-tag">span</span> &#123;</span><br><span class="language-css">        <span class="hljs-attribute">color</span>: white;</span><br><span class="language-css">        <span class="hljs-attribute">font-size</span>: <span class="hljs-number">50px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;</span><br><span class="language-css">        <span class="hljs-attribute">position</span>: absolute;</span><br><span class="language-css">        <span class="hljs-comment">/* left: 110px;</span></span><br><span class="hljs-comment"><span class="language-css">        top : 10px; */</span></span><br><span class="language-css">        <span class="hljs-attribute">left</span>: <span class="hljs-number">60px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">top</span>: <span class="hljs-number">10px</span>;</span><br><span class="language-css">        <span class="hljs-attribute">transform-origin</span>: center center;</span><br><span class="language-css">        <span class="hljs-attribute">background-color</span>: green;</span><br><span class="language-css">        <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(-<span class="hljs-number">36deg</span>);</span><br><span class="language-css">      &#125;</span><br><span class="language-css">  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>canvas</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>服务器操作常用命令</title>
    <link href="/2023/08/02/service-operation-md/"/>
    <url>/2023/08/02/service-operation-md/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh -p &#123;port&#125; &#123;name&#125;@&#123;ip_address&#125;<br></code></pre></td></tr></table></figure><p>回车之后输入服务器密码</p><p>安装nginx 可以使用 linux系统自带的yum包管理器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">find / -name &#123;package_name&#125;<br></code></pre></td></tr></table></figure><p>可以查看包所在位置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">firewall-cmd —list-ports<br></code></pre></td></tr></table></figure><p>查看所有开放端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">firewall-cmd —permanent —zone=public —add-port=&#123;port&#125;/tcp <br><span class="hljs-meta prompt_">#</span><span class="language-bash">命令含义：</span><br>   --zone #作用域<br>   --add-port=1935/tcp  #添加端口，格式为：端口/通讯协议<br>   --permanent  #永久生效，没有此参数重启后失效<br></code></pre></td></tr></table></figure><p>添加新的端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">firewall-cmd —reload<br></code></pre></td></tr></table></figure><p>重启防火墙，添加新的端口后必须需要重启</p><p>netstat 该工具需要通过yum安装，可以查看机器的网络连接状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat -anp #查看所有网络连接 <br>netstat -lnp #查看端口连接<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nginx -s stop<br></code></pre></td></tr></table></figure><p>停止nginx所有服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nginx -s reload<br></code></pre></td></tr></table></figure><p>重新加载nginx服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nginx -c /etc/nginx/nginx.conf<br></code></pre></td></tr></table></figure><p>使用指定配置文件启动nginx</p><p>nginx.conf文件有修改，需要先stop nginx服务，然后重新启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">scp -r -P &#123;port&#125; &#123;dir&#125; &#123;name&#125;@&#123;ip_address&#125;:&#123;dir&#125;<br></code></pre></td></tr></table></figure><p>该命令可以将本机上的文件夹上传至服务器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps aux |grep nginx<br></code></pre></td></tr></table></figure><p>该命令查看所有包含有nginx字样的运行服务</p>]]></content>
    
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
